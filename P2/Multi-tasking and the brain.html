<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>P2 ‚Äì Multi-tasking and the brain</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
      }
      #timer {
        position: fixed;
        top: 12px;
        right: 12px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 16px;
        font-weight: 600;
        color: #0066cc;
        z-index: 1000;
      }
      .shell {
        display: flex;
        height: 100vh;
        width: 100%;
      }
      .pane {
        background: #fff;
        overflow: auto;
        padding: 24px;
      }
      #left {
        flex: 0 0 50%;
        border-right: 1px solid #ddd;
      }
      #right {
        flex: 1 1 auto;
        background: #fafafa;
      }
      #divider {
        flex: 0 0 5px;
        background: #ddd;
        cursor: ew-resize;
      }
      #divider:hover {
        background: #999;
      }
      h2,
      h3,
      h4 {
        margin: 0 0 12px;
        color: #333;
      }
      h2 {
        font-size: 20px;
      }
      h3 {
        font-size: 18px;
        color: #0066cc;
      }
      h4 {
        font-size: 15px;
        font-weight: 600;
        margin-top: 20px;
      }
      #left p {
        margin: 0 0 14px;
        line-height: 1.7;
        text-align: justify;
      }
      .group {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .group h4 {
        margin-top: 0;
        color: #0066cc;
      }
      .group p {
        margin: 8px 0;
        font-size: 14px;
        line-height: 1.6;
      }
      .flag-btn {
        position: absolute;
        left: 2px;
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ddd;
        cursor: pointer;
        z-index: 10;
      }
      .flag-btn:hover {
        background: #999;
      }
      .flag-btn.active {
        background: #ff5722;
      }
      .group ol {
        margin-left: 20px;
      }
      .group ol li {
        margin: 12px 0;
        font-size: 14px;
        line-height: 1.6;
        position: relative;
      }
      .group ol li label {
        display: inline-block;
        margin-right: 8px;
      }
      input[type="text"] {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 14px;
        width: 160px;
        background: #fdfdfd;
      }
      input[type="text"]:focus {
        border-color: #0066cc;
        outline: none;
        background: #fff;
      }
      .bottom-bar {
        display: flex;
        gap: 10px;
        margin-top: 16px;
      }
      button {
        padding: 10px 20px;
        border: 1px solid #999;
        border-radius: 6px;
        background: #fff;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #f0f0f0;
      }
      .btn-primary {
        background: #0066cc;
        color: #fff;
        border-color: #0066cc;
      }
      .btn-primary:hover {
        background: #0052a3;
      }
      .btn-danger {
        background: #dc3545;
        color: #fff;
        border-color: #dc3545;
      }
      .btn-danger:hover {
        background: #c82333;
      }
      .hl {
        background: #fff59d;
        cursor: pointer;
      }
      .hl:hover {
        background: #ffeb3b;
      }
      .note {
        background: #b3d9ff;
        cursor: pointer;
      }
      .note:hover {
        background: #99ccff;
      }
      #selbar {
        position: fixed;
        display: none;
        z-index: 2000;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 8px;
        gap: 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        flex-direction: column;
        min-width: 120px;
      }
      #selbar button {
        background: #fff;
        color: #666;
        border: none;
        padding: 3px 0px;
        cursor: pointer;
        font-size: 14px;
        text-align: center;
        border-radius: 4px;
      }
      #selbar button:hover {
        background: #f5f5f5;
        color: #333;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 3000;
        align-items: center;
        justify-content: center;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: #fff;
        border-radius: 8px;
        padding: 24px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }
      .modal-header h2 {
        font-size: 28px;
        color: #333;
        margin: 0;
      }
      .modal-close {
        font-size: 32px;
        cursor: pointer;
        color: #999;
        line-height: 1;
      }
      .modal-close:hover {
        color: #333;
      }
      .result-summary {
        text-align: center;
        padding: 20px;
        background: #f0f0f0;
        margin-bottom: 16px;
        border-radius: 6px;
      }
      .result-score {
        font-size: 36px;
        font-weight: 600;
        color: #0066cc;
      }
      .result-item {
        padding: 10px;
        margin: 8px 0;
        border-left: 3px solid #ddd;
        background: #f9f9f9;
        font-size: 13px;
      }
      .result-item.correct {
        border-left-color: #28a745;
        background: #e8f5e9;
      }
      .result-item.incorrect {
        border-left-color: #dc3545;
        background: #ffebee;
      }
      .wrong-item {
        background: #fff3e0;
        padding: 16px;
        margin: 8px 0;
        border-radius: 8px;
        border-left: 4px solid #ff9800;
        display: flex;
        justify-content: space-between;
        align-items: start;
      }
      .wrong-item-content {
        flex: 1;
      }
      .btn-delete {
        background: #dc3545;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        margin-left: 12px;
      }
      .btn-delete:hover {
        background: #c82333;
      }
      .modal-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      .headings-box {
        background: #f9f9f9;
        padding: 12px;
        border: 1px solid #eee;
        border-radius: 4px;
        margin-bottom: 12px;
      }
      .headings-box h5 {
        margin: 0 0 8px;
        font-size: 14px;
        color: #333;
      }
      .headings-box ol {
        margin-left: 20px;
        font-size: 13px;
        line-height: 1.4;
      }
    </style>
  </head>
  <body>
    <div id="timer">00:00</div>
    <div class="shell">
      <section class="pane" id="left">
        <h2>READING PASSAGE 2</h2>
        <p>
          You should spend about 20 minutes on Questions 14‚Äì26, which are based
          on Reading Passage 2 below.
        </p>
        <h3>Multi-tasking and the brain</h3>
        <p>
          <strong>A</strong> Do you think you're a master of multi-tasking?
          Think again. Unless you are one of the three percent of super-taskers
          in the population, research shows that your brain isn't capable of
          paying close attention to more than one complex task at a time.
          Researchers who study attention say that effective multi-tasking is
          beyond most of us. Psychiatrist Edward M Hallowell even describes
          multi-tasking as 'a mythical activity in which people believe they can
          perform two or more tasks simultaneously as effectively as they can
          perform one'.
        </p>
        <p>
          <strong>B</strong> It is true that you can check your email while
          eating your lunch, or listen to music while walking. But innate
          activities like walking, chewing, and breathing do not require you to
          pay attention, whereas activities such as reading, tapping out a text
          message, or driving a car do require attention. Why is paying
          attention to two things at once difficult? 'The brain can perform
          simultaneous tasks, but attention has capacity limitations,' says
          Associate Professor Paul E Dux, a cognitive neuroscientist at the
          University of Queensland in Australia. When you do only one thing at a
          time, you're better at that task than when you're doing multiple
          things concurrently.
        </p>
        <p>
          Take the classic multi-tasking scenario of talking on a mobile phone
          while driving - an ill-advised activity that many people believe they
          have mastered. When David Strayer, Professor of Psychology at the
          University of Utah in the US, and his team observed 56,000 drivers as
          they approached an intersection, the majority of drivers who were
          talking on their phone failed to stop in accordance with traffic laws.
          And it did not matter if the driver was using a handheld or hands-free
          device. Even with both eyes on the road and both hands on the wheel,
          drivers' performance was impaired. Strayer's research shows that
          performance deteriorates drastically when attention is split between
          tasks: more mistakes are made and it takes longer to complete each
          activity.
        </p>
        <p>
          <strong>C</strong> The prefrontal cortex is the brain region
          responsible for choosing what to pay attention to, and for
          coordinating inputs from other brain areas. By scanning the prefrontal
          cortex of people while they multi-tasked, scientists at the French
          Institute of Health and Medical Research in Paris (INSERM) found that
          when people focused on a single thing, the right and left sides of the
          prefrontal cortex work together. But when people attempt to perform
          two things at once, the sides work independently. Neuroscientist
          Etienne Koechlin says his study demonstrates that while the brain can
          switch back and forth between two tasks, we might be in great trouble
          when we try to juggle more than two tasks, simply because we have only
          two frontal lobes'.
        </p>
        <p>
          <strong>D</strong> To the question of whether there is a difference
          between the sexes, Koechlin's imaging studies uncovered no differences
          in the ability to switch between tasks in the prefrontal cortices of
          men or women. But other researchers studying real life scenarios such
          as finding lost keys, believe there might be some truth to the claim
          that women are superior multi-taskers. Women have a much better
          strategy for finding the keys, whereas men tend to jump to it and be
          far less organised and thorough. 'It's as if they don't stop to
          reflect and plan for a moment,' says Professor Keith Laws from the
          University of Hertfordshire in England. But while the ability to
          develop strategies for coping with the numerous tasks in everyday life
          could give women an advantage, 'nobody can juggle two, never mind
          three, "complex" tasks at the same time.'
        </p>
        <p>
          <strong>E</strong> However, David Strayer's research uncovered that
          some rare people possess extraordinary multi-tasking ability. These
          so-called 'super-taskers' exhibit different patterns of brain activity
          when multi-tasking compared to ordinary people: they show less
          activity in the prefrontal cortex during multi-tasking, suggesting
          their brains are functioning with a high level of efficiency. Strayer
          thinks that pilots of high-performance aircraft, high-end chefs who
          can cook several meals at the same time to perfection, and elite
          doctors in hospital emergency rooms might all be more likely to be
          super-taskers. "All other things being equal, we suspect that
          super-taskers will rise to a top position in any occupation that
          places a high demand on juggling various tasks that demand attention
          at the same time.'
        </p>
        <p>
          <strong>F</strong> The ability to multi-task probably comes down to
          the DNA you inherit from your parents to a large extent, says Strayer.
          'You are either born with the neural structure that allows you to
          overcome the usual multi-tasking challenges, or you aren't.
          Super-taskers' brains are doing something we can't do.' All in all,
          these findings may have very real consequences on our lives.
        </p>
      </section>
      <div id="divider"></div>
      <section class="pane" id="right">
        <h3>Questions</h3>
        <div class="group">
          <h4>Questions 14‚Äì19</h4>
          <p>Reading Passage 2 has six sections, A‚ÄìF.</p>
          <p>
            Choose the correct heading for each section from the list of
            headings below.
          </p>
          <div class="headings-box">
            <h5>List of Headings</h5>
            <ol type="i">
              <li>Professions in which super-taskers are likely to be found</li>
              <li>The effects of multi-tasking on neurological structure</li>
              <li>
                A distinction between situations when people can and can‚Äôt
                multi-task
              </li>
              <li>Real multi-tasking is nearly impossible</li>
              <li>Multi-tasking and gender</li>
              <li>
                The neurological reasons for struggling to manage more things
              </li>
              <li>The ability to multi-task is determined by people‚Äôs genes</li>
              <li>Gender and the structure of the brain</li>
            </ol>
          </div>
          <ol start="14">
            <li>
              <span class="flag-btn" data-q="q14" style="left: -20px"></span
              >Section A<br />
              <label><input type="radio" name="q14" value="i" /> i</label>
              <label><input type="radio" name="q14" value="ii" /> ii</label>
              <label><input type="radio" name="q14" value="iii" /> iii</label>
              <label><input type="radio" name="q14" value="iv" /> iv</label>
              <label><input type="radio" name="q14" value="v" /> v</label>
              <label><input type="radio" name="q14" value="vi" /> vi</label>
              <label><input type="radio" name="q14" value="vii" /> vii</label>
              <label><input type="radio" name="q14" value="viii" /> viii</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q15" style="left: -20px"></span
              >Section B<br />
              <label><input type="radio" name="q15" value="i" /> i</label>
              <label><input type="radio" name="q15" value="ii" /> ii</label>
              <label><input type="radio" name="q15" value="iii" /> iii</label>
              <label><input type="radio" name="q15" value="iv" /> iv</label>
              <label><input type="radio" name="q15" value="v" /> v</label>
              <label><input type="radio" name="q15" value="vi" /> vi</label>
              <label><input type="radio" name="q15" value="vii" /> vii</label>
              <label><input type="radio" name="q15" value="viii" /> viii</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q16" style="left: -20px"></span
              >Section C<br />
              <label><input type="radio" name="q16" value="i" /> i</label>
              <label><input type="radio" name="q16" value="ii" /> ii</label>
              <label><input type="radio" name="q16" value="iii" /> iii</label>
              <label><input type="radio" name="q16" value="iv" /> iv</label>
              <label><input type="radio" name="q16" value="v" /> v</label>
              <label><input type="radio" name="q16" value="vi" /> vi</label>
              <label><input type="radio" name="q16" value="vii" /> vii</label>
              <label><input type="radio" name="q16" value="viii" /> viii</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q17" style="left: -20px"></span
              >Section D<br />
              <label><input type="radio" name="q17" value="i" /> i</label>
              <label><input type="radio" name="q17" value="ii" /> ii</label>
              <label><input type="radio" name="q17" value="iii" /> iii</label>
              <label><input type="radio" name="q17" value="iv" /> iv</label>
              <label><input type="radio" name="q17" value="v" /> v</label>
              <label><input type="radio" name="q17" value="vi" /> vi</label>
              <label><input type="radio" name="q17" value="vii" /> vii</label>
              <label><input type="radio" name="q17" value="viii" /> viii</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q18" style="left: -20px"></span
              >Section E<br />
              <label><input type="radio" name="q18" value="i" /> i</label>
              <label><input type="radio" name="q18" value="ii" /> ii</label>
              <label><input type="radio" name="q18" value="iii" /> iii</label>
              <label><input type="radio" name="q18" value="iv" /> iv</label>
              <label><input type="radio" name="q18" value="v" /> v</label>
              <label><input type="radio" name="q18" value="vi" /> vi</label>
              <label><input type="radio" name="q18" value="vii" /> vii</label>
              <label><input type="radio" name="q18" value="viii" /> viii</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q19" style="left: -20px"></span
              >Section F<br />
              <label><input type="radio" name="q19" value="i" /> i</label>
              <label><input type="radio" name="q19" value="ii" /> ii</label>
              <label><input type="radio" name="q19" value="iii" /> iii</label>
              <label><input type="radio" name="q19" value="iv" /> iv</label>
              <label><input type="radio" name="q19" value="v" /> v</label>
              <label><input type="radio" name="q19" value="vi" /> vi</label>
              <label><input type="radio" name="q19" value="vii" /> vii</label>
              <label><input type="radio" name="q19" value="viii" /> viii</label>
            </li>
          </ol>
        </div>
        <div class="group">
          <h4>Questions 20‚Äì23</h4>
          <p>
            Match each statement with the correct researcher,
            <strong>A‚ÄìE</strong>.
          </p>
          <div class="headings-box">
            <h5>List of Researchers</h5>
            <div style="margin-left: 10px">
              <strong>A</strong> Edward M Hallowell<br />
              <strong>B</strong> Paul E Dux<br />
              <strong>C</strong> David Strayer<br />
              <strong>D</strong> Etienne Koechlin<br />
              <strong>E</strong> Keith Laws
            </div>
          </div>
          <ol start="20">
            <li>
              <span class="flag-btn" data-q="q20" style="left: -20px"></span>The
              brain of a good multi-tasker works differently from other
              people‚Äôs.<br />
              <label><input type="radio" name="q20" value="A" /> A</label>
              <label><input type="radio" name="q20" value="B" /> B</label>
              <label><input type="radio" name="q20" value="C" /> C</label>
              <label><input type="radio" name="q20" value="D" /> D</label>
              <label><input type="radio" name="q20" value="E" /> E</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q21" style="left: -20px"></span>The
              rate of error is considerably higher when people multi-task.<br />
              <label><input type="radio" name="q21" value="A" /> A</label>
              <label><input type="radio" name="q21" value="B" /> B</label>
              <label><input type="radio" name="q21" value="C" /> C</label>
              <label><input type="radio" name="q21" value="D" /> D</label>
              <label><input type="radio" name="q21" value="E" /> E</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q22" style="left: -20px"></span
              >People are mistaken in their assumption that they can
              multi-task.<br />
              <label><input type="radio" name="q22" value="A" /> A</label>
              <label><input type="radio" name="q22" value="B" /> B</label>
              <label><input type="radio" name="q22" value="C" /> C</label>
              <label><input type="radio" name="q22" value="D" /> D</label>
              <label><input type="radio" name="q22" value="E" /> E</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q23" style="left: -20px"></span>One
              gender does not seem to pause to consider before taking action.<br />
              <label><input type="radio" name="q23" value="A" /> A</label>
              <label><input type="radio" name="q23" value="B" /> B</label>
              <label><input type="radio" name="q23" value="C" /> C</label>
              <label><input type="radio" name="q23" value="D" /> D</label>
              <label><input type="radio" name="q23" value="E" /> E</label>
            </li>
          </ol>
        </div>
        <div class="group">
          <h4>Questions 24‚Äì26</h4>
          <p>
            Complete the summary below. Choose
            <strong>ONE WORD ONLY</strong> from the passage.
          </p>
          <div
            style="
              background: #f9f9f9;
              padding: 15px;
              border-radius: 4px;
              line-height: 2;
            "
          >
            <strong>Super-taskers</strong><br />
            Super-taskers are those of us who possess special multi-tasking
            ability. They can be found in all professions. People who are
            pilots, chefs and doctors are often super-taskers, and super-taskers
            are most likely to achieve a <strong>24</strong>
            <span
              class="flag-btn"
              data-q="q24"
              style="
                left: inherit;
                display: inline-block;
                position: relative;
                vertical-align: middle;
                margin-left: 5px;
              "
            ></span>
            <input type="text" name="q24" /> that is high on the career
            ladder.<br />
            Super-taskers typically have to undertake many tasks simultaneously
            that need their <strong>25</strong>
            <span
              class="flag-btn"
              data-q="q25"
              style="
                left: inherit;
                display: inline-block;
                position: relative;
                vertical-align: middle;
                margin-left: 5px;
              "
            ></span>
            <input type="text" name="q25" />.<br />
            Genes play an important role in having this capability: these people
            have a special brain <strong>26</strong>
            <span
              class="flag-btn"
              data-q="q26"
              style="
                left: inherit;
                display: inline-block;
                position: relative;
                vertical-align: middle;
                margin-left: 5px;
              "
            ></span>
            <input type="text" name="q26" />, which helps them do what we
            cannot.
          </div>
        </div>
        <div class="bottom-bar">
          <button class="btn-primary" onclick="submitAnswers()">Êèê‰∫§</button>
          <button onclick="resetForm()">ÈáçÁΩÆ</button>
          <button onclick="openWrongBook()">Êú¨ÁØáÈîôÈ¢ò</button>
        </div>
      </section>
    </div>
    <div id="selbar">
      <button id="btnNote">Note</button>
      <button id="btnHL">Highlight</button>
      <button id="btnUH" style="display: none">Clear Highlight</button>
    </div>
    <div class="modal" id="resultModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÊàêÁª©</h2>
          <span class="modal-close" onclick="closeModal('resultModal')">√ó</span>
        </div>
        <div id="resultContent"></div>
        <button
          class="btn-primary"
          style="width: 100%; margin-top: 16px"
          onclick="addWrongToBook()"
        >
          Âä†ÂÖ•ÈîôÈ¢òÊú¨
        </button>
      </div>
    </div>
    <div class="modal" id="wrongBookModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Êú¨ÁØáÈîôÈ¢ò</h2>
          <span class="modal-close" onclick="closeModal('wrongBookModal')"
            >√ó</span
          >
        </div>
        <div id="wrongBookContent"></div>
      </div>
    </div>
    <div class="modal" id="resetModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÈáçÁΩÆÁªÉ‰π†</h2>
          <span class="modal-close" onclick="closeModal('resetModal')">√ó</span>
        </div>
        <div style="margin: 16px 0">
          <label style="display: block; margin-bottom: 10px"
            ><input type="radio" name="resetType" value="answers" checked />
            Âè™Ê∏ÖÁ©∫Á≠îÊ°à</label
          >
          <label style="display: block"
            ><input type="radio" name="resetType" value="all" />
            Ê∏ÖÁ©∫Á≠îÊ°àÂíåÊ†áËÆ∞</label
          >
        </div>
        <button
          class="btn-primary"
          style="width: 100%"
          onclick="confirmReset()"
        >
          Á°ÆÂÆö
        </button>
      </div>
    </div>
    <script>
      const PAPER_ID = "P2_MULTITASKING";
      let t = 0;
      const timerEl = document.getElementById("timer");
      setInterval(() => {
        t++;
        timerEl.textContent =
          String(Math.floor(t / 60)).padStart(2, "0") +
          ":" +
          String(t % 60).padStart(2, "0");
      }, 1000);
      const divider = document.getElementById("divider"),
        left = document.getElementById("left"),
        right = document.getElementById("right");
      let dragging = false;
      divider.onmousedown = () => {
        dragging = true;
        document.body.style.cursor = "ew-resize";
      };
      window.onmousemove = (e) => {
        if (!dragging) return;
        const c = document.querySelector(".shell").getBoundingClientRect();
        let x = e.clientX - c.left;
        x = Math.max(280, Math.min(c.width - 280, x));
        left.style.flex = "0 0 " + x + "px";
        right.style.flex = "1 1 auto";
      };
      window.onmouseup = () => {
        dragging = false;
        document.body.style.cursor = "";
      };
      const selbar = document.getElementById("selbar"),
        btnHL = document.getElementById("btnHL"),
        btnUH = document.getElementById("btnUH"),
        btnNote = document.getElementById("btnNote");
      let lastRange = null,
        currentHlNode = null;
      function posSelbar(r) {
        selbar.style.display = "flex";
        const t = window.scrollY + r.top - selbar.offsetHeight - 8;
        const l =
          window.scrollX + r.left + r.width / 2 - selbar.offsetWidth / 2;
        selbar.style.top = (t > 0 ? t : window.scrollY + r.bottom + 8) + "px";
        selbar.style.left = Math.max(8, l) + "px";
      }
      function updSel() {
        const s = window.getSelection();
        if (!s || s.rangeCount === 0 || s.isCollapsed) {
          if (!currentHlNode) selbar.style.display = "none";
          return;
        }
        const r = s.getRangeAt(0);
        lastRange = r.cloneRange();
        currentHlNode = null;
        btnNote.style.display = "block";
        btnHL.style.display = "block";
        btnUH.style.display = "none";
        posSelbar(r.getBoundingClientRect());
      }
      left.onmouseup = updSel;
      right.onmouseup = updSel;
      document.onselectionchange = () => {
        const s = window.getSelection();
        if ((!s || s.rangeCount === 0 || s.isCollapsed) && !currentHlNode)
          selbar.style.display = "none";
      };
      document.addEventListener(
        "click",
        (e) => {
          if (
            e.target.classList &&
            (e.target.classList.contains("hl") ||
              e.target.classList.contains("note"))
          ) {
            currentHlNode = e.target;
            lastRange = null;
            btnNote.style.display = "none";
            btnHL.style.display = "none";
            btnUH.style.display = "block";
            posSelbar(e.target.getBoundingClientRect());
            const s = window.getSelection();
            if (s) s.removeAllRanges();
          }
        },
        true
      );
      btnHL.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "hl";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "hl";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnNote.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "note";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "note";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnUH.onclick = () => {
        if (currentHlNode) {
          const p = currentHlNode.parentNode;
          while (currentHlNode.firstChild)
            p.insertBefore(currentHlNode.firstChild, currentHlNode);
          p.removeChild(currentHlNode);
          p.normalize();
          currentHlNode = null;
          selbar.style.display = "none";
          saveHighlights();
        } else if (lastRange) {
          const sR = lastRange.getBoundingClientRect();
          const w = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_ELEMENT
          );
          const tr = [];
          while (w.nextNode()) {
            const n = w.currentNode;
            if (
              n.classList &&
              (n.classList.contains("hl") || n.classList.contains("note"))
            ) {
              const r = n.getBoundingClientRect();
              if (
                !(
                  r.right < sR.left ||
                  r.left > sR.right ||
                  r.bottom < sR.top ||
                  r.top > sR.bottom
                )
              )
                tr.push(n);
            }
          }
          tr.forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          selbar.style.display = "none";
          saveHighlights();
        }
      };
      document.querySelectorAll(".flag-btn").forEach((btn) => {
        btn.onclick = (e) => {
          e.stopPropagation();
          btn.classList.toggle("active");
          saveFlags();
        };
      });
      const answerKey = {
        q14: "iv",
        q15: "iii",
        q16: "vi",
        q17: "v",
        q18: "i",
        q19: "vii",
        q20: "C",
        q21: "C",
        q22: "A",
        q23: "E",
        q24: "position",
        q25: "attention",
        q26: "structure",
      };
      let lastResults = [];
      function saveAnswers() {
        const data = {};
        Object.keys(answerKey).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) data[q] = radio.value;
          else if (text) data[q] = text.value;
        });
        localStorage.setItem(`${PAPER_ID}_answers`, JSON.stringify(data));
      }
      function loadAnswers() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_answers`) || "{}"
        );
        Object.keys(data).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][value="${data[q]}"]`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) radio.checked = true;
          else if (text) text.value = data[q];
        });
      }
      function saveFlags() {
        const flags = [...document.querySelectorAll(".flag-btn.active")].map(
          (b) => b.dataset.q
        );
        localStorage.setItem(`${PAPER_ID}_flags`, JSON.stringify(flags));
      }
      function loadFlags() {
        const flags = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_flags`) || "[]"
        );
        flags.forEach((q) =>
          document.querySelector(`[data-q="${q}"]`)?.classList.add("active")
        );
      }
      function saveHighlights() {
        const highlights = { left: [], right: [] };
        document
          .querySelectorAll("#left .hl, #left .note")
          .forEach((el, idx) => {
            highlights.left.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        document
          .querySelectorAll("#right .hl, #right .note")
          .forEach((el, idx) => {
            highlights.right.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        localStorage.setItem(
          `${PAPER_ID}_highlights`,
          JSON.stringify(highlights)
        );
      }
      function loadHighlights() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_highlights`) ||
            '{"left":[],"right":[]}'
        );
        const restore = (pane, items) => {
          if (!items || items.length === 0) return;
          items.forEach((item) => {
            const walker = document.createTreeWalker(
              pane,
              NodeFilter.SHOW_TEXT
            );
            let node;
            while ((node = walker.nextNode())) {
              if (node.textContent.includes(item.text)) {
                const span = document.createElement("span");
                span.className = item.type;
                const parent = node.parentNode;
                const text = node.textContent;
                const idx = text.indexOf(item.text);
                if (idx >= 0) {
                  const before = text.substring(0, idx);
                  const match = text.substring(idx, idx + item.text.length);
                  const after = text.substring(idx + item.text.length);
                  parent.insertBefore(document.createTextNode(before), node);
                  span.textContent = match;
                  parent.insertBefore(span, node);
                  parent.insertBefore(document.createTextNode(after), node);
                  parent.removeChild(node);
                  break;
                }
              }
            }
          });
        };
        restore(left, data.left);
        restore(right, data.right);
      }
      document.querySelectorAll("input").forEach((inp) => {
        inp.addEventListener("change", saveAnswers);
        if (inp.type === "text") inp.addEventListener("input", saveAnswers);
      });
      document.addEventListener("DOMContentLoaded", () => {
        loadAnswers();
        loadFlags();
        loadHighlights();
      });
      function submitAnswers() {
        const res = [];
        let cor = 0;
        Object.keys(answerKey).forEach((q) => {
          let uA = "";
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) uA = radio.value;
          else if (text) uA = text.value.trim();
          const cA = answerKey[q];
          const iC = uA.toLowerCase() === cA.toLowerCase();
          if (iC) cor++;
          res.push({ id: q, userAns: uA, correctAns: cA, isCorrect: iC });
        });
        lastResults = res;
        const tot = Object.keys(answerKey).length;
        const pct = ((cor / tot) * 100).toFixed(1);
        localStorage.setItem(`ielts_score_${PAPER_ID}`, `${cor}/${tot}`);
        document.getElementById(
          "resultContent"
        ).innerHTML = `<div class="result-summary"><div class="result-score">${cor} / ${tot}</div><div style="margin-top:8px;font-size:18px;">${pct}%</div></div>${res
          .map(
            (r) =>
              `<div class="result-item ${
                r.isCorrect ? "correct" : "incorrect"
              }"><div><strong>${r.id}</strong> ${
                r.isCorrect ? "‚úì" : "‚úó"
              }</div><div>‰Ω†ÁöÑÁ≠îÊ°à: ${r.userAns || "(Êú™‰ΩúÁ≠î)"}</div>${
                !r.isCorrect ? `<div>Ê≠£Á°ÆÁ≠îÊ°à: ${r.correctAns}</div>` : ""
              }</div>`
          )
          .join("")}`;
        document.getElementById("resultModal").classList.add("active");
      }
      function resetForm() {
        document.getElementById("resetModal").classList.add("active");
      }
      function confirmReset() {
        const tp = document.querySelector(
          'input[name="resetType"]:checked'
        ).value;
        document.querySelectorAll("input").forEach((i) => {
          if (i.type === "radio") i.checked = false;
          if (i.type === "text") i.value = "";
        });
        localStorage.removeItem(`${PAPER_ID}_answers`);
        if (tp === "all") {
          document.querySelectorAll(".hl").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document.querySelectorAll(".note").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document
            .querySelectorAll(".flag-btn")
            .forEach((b) => b.classList.remove("active"));
          localStorage.removeItem(`${PAPER_ID}_highlights`);
          localStorage.removeItem(`${PAPER_ID}_flags`);
        }
        closeModal("resetModal");
      }
      function addWrongToBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const wr = lastResults.filter((r) => !r.isCorrect);
        wr.forEach((r) => {
          const en = {
            paperId: PAPER_ID,
            title: "Multi-tasking and the brain",
            questionId: r.id,
            correctAnswer: r.correctAns,
            myAnswer: r.userAns || "(Êú™‰ΩúÁ≠î)",
            date: new Date().toISOString().split("T")[0],
          };
          const ix = wb.findIndex(
            (i) => i.paperId === en.paperId && i.questionId === en.questionId
          );
          if (ix >= 0) wb[ix] = en;
          else wb.push(en);
        });
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        alert(`Â∑≤Ê∑ªÂä† ${wr.length} ÈÅìÈîôÈ¢ò`);
        closeModal("resultModal");
      }
      function deleteWrongItem(pId, qId) {
        if (!confirm("Á°ÆÂÆöÂà†Èô§ËøôÈÅìÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => !(i.paperId === pId && i.questionId === qId));
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function clearCurrentWrongBook() {
        if (!confirm("Á°ÆÂÆöÊ∏ÖÁ©∫Êú¨ÁØáÊâÄÊúâÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => i.paperId !== PAPER_ID);
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function openWrongBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const cu = wb.filter((i) => i.paperId === PAPER_ID);
        const ct = document.getElementById("wrongBookContent");
        if (cu.length === 0)
          ct.innerHTML =
            '<div style="text-align:center;padding:40px;color:#666;">ÊöÇÊó†ÈîôÈ¢ò</div>';
        else
          ct.innerHTML = `<div class="modal-actions"><button class="btn-danger" onclick="clearCurrentWrongBook()" stylewidth:100%;">üóëÔ∏è Ê∏ÖÁ©∫Êú¨ÁØáÈîôÈ¢ò</button></div>${cu
            .map(
              (i) =>
                `<div class="wrong-item"><div class="wrong-item-content"><div style="font-weight:600;margin-bottom:8px;">${i.questionId}</div><div style="font-size:13px;color:#666;"><div>‚úì Ê≠£Á°Æ: ${i.correctAnswer}</div><div style="color:#d32f2f;">‚úó ÊàëÁöÑ: ${i.myAnswer}</div></div></div><button class="btn-delete" onclick="deleteWrongItem('${i.paperId}','${i.questionId}')">Âà†Èô§</button></div>`
            )
            .join("")}`;
        document.getElementById("wrongBookModal").classList.add("active");
      }
      function closeModal(id) {
        document.getElementById(id).classList.remove("active");
      }
    </script>
  </body>
</html>
