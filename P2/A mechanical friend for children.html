<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>P2 ‚Äì A mechanical friend for children</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
      }
      #timer {
        position: fixed;
        top: 12px;
        right: 12px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 16px;
        font-weight: 600;
        color: #0066cc;
        z-index: 1000;
      }
      .shell {
        display: flex;
        height: 100vh;
        width: 100%;
      }
      .pane {
        background: #fff;
        overflow: auto;
        padding: 24px;
      }
      #left {
        flex: 0 0 50%;
        border-right: 1px solid #ddd;
      }
      #right {
        flex: 1 1 auto;
        background: #fafafa;
      }
      #divider {
        flex: 0 0 5px;
        background: #ddd;
        cursor: ew-resize;
      }
      #divider:hover {
        background: #999;
      }
      h2,
      h3,
      h4 {
        margin: 0 0 12px;
        color: #333;
      }
      h2 {
        font-size: 20px;
      }
      h3 {
        font-size: 18px;
        color: #0066cc;
      }
      h4 {
        font-size: 15px;
        font-weight: 600;
        margin-top: 20px;
      }
      #left p {
        margin: 0 0 14px;
        line-height: 1.7;
        text-align: justify;
      }
      .group {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .group h4 {
        margin-top: 0;
        color: #0066cc;
      }
      .group p {
        margin: 8px 0;
        font-size: 14px;
        line-height: 1.6;
      }
      .flag-btn {
        position: absolute;
        left: 2px;
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ddd;
        cursor: pointer;
        z-index: 10;
      }
      .flag-btn:hover {
        background: #999;
      }
      .flag-btn.active {
        background: #ff5722;
      }
      .group ol {
        margin-left: 20px;
      }
      .group ol li {
        margin: 12px 0;
        font-size: 14px;
        line-height: 1.6;
        position: relative;
      }
      .group ol li label {
        display: inline-block;
        margin-right: 8px;
      }
      input[type="text"] {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 14px;
        width: 160px;
        background: #fdfdfd;
      }
      input[type="text"]:focus {
        border-color: #0066cc;
        outline: none;
        background: #fff;
      }
      .bottom-bar {
        display: flex;
        gap: 10px;
        margin-top: 16px;
      }
      button {
        padding: 10px 20px;
        border: 1px solid #999;
        border-radius: 6px;
        background: #fff;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #f0f0f0;
      }
      .btn-primary {
        background: #0066cc;
        color: #fff;
        border-color: #0066cc;
      }
      .btn-primary:hover {
        background: #0052a3;
      }
      .btn-danger {
        background: #dc3545;
        color: #fff;
        border-color: #dc3545;
      }
      .btn-danger:hover {
        background: #c82333;
      }
      .hl {
        background: #fff59d;
        cursor: pointer;
      }
      .hl:hover {
        background: #ffeb3b;
      }
      .note {
        background: #b3d9ff;
        cursor: pointer;
      }
      .note:hover {
        background: #99ccff;
      }
      #selbar {
        position: fixed;
        display: none;
        z-index: 2000;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 8px;
        gap: 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        flex-direction: column;
        min-width: 120px;
      }
      #selbar button {
        background: #fff;
        color: #666;
        border: none;
        padding: 3px 0px;
        cursor: pointer;
        font-size: 14px;
        text-align: center;
        border-radius: 4px;
      }
      #selbar button:hover {
        background: #f5f5f5;
        color: #333;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 3000;
        align-items: center;
        justify-content: center;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: #fff;
        border-radius: 8px;
        padding: 24px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }
      .modal-header h2 {
        font-size: 28px;
        color: #333;
        margin: 0;
      }
      .modal-close {
        font-size: 32px;
        cursor: pointer;
        color: #999;
        line-height: 1;
      }
      .modal-close:hover {
        color: #333;
      }
      .result-summary {
        text-align: center;
        padding: 20px;
        background: #f0f0f0;
        margin-bottom: 16px;
        border-radius: 6px;
      }
      .result-score {
        font-size: 36px;
        font-weight: 600;
        color: #0066cc;
      }
      .result-item {
        padding: 10px;
        margin: 8px 0;
        border-left: 3px solid #ddd;
        background: #f9f9f9;
        font-size: 13px;
      }
      .result-item.correct {
        border-left-color: #28a745;
        background: #e8f5e9;
      }
      .result-item.incorrect {
        border-left-color: #dc3545;
        background: #ffebee;
      }
      .wrong-item {
        background: #fff3e0;
        padding: 16px;
        margin: 8px 0;
        border-radius: 8px;
        border-left: 4px solid #ff9800;
        display: flex;
        justify-content: space-between;
        align-items: start;
      }
      .wrong-item-content {
        flex: 1;
      }
      .btn-delete {
        background: #dc3545;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        margin-left: 12px;
      }
      .btn-delete:hover {
        background: #c82333;
      }
      .modal-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      .headings-box {
        background: #f9f9f9;
        padding: 12px;
        border: 1px solid #eee;
        border-radius: 4px;
        margin-bottom: 12px;
      }
      .headings-box h5 {
        margin: 0 0 8px;
        font-size: 14px;
        color: #333;
      }
    </style>
  </head>
  <body>
    <div id="timer">00:00</div>
    <div class="shell">
      <section class="pane" id="left">
        <h2>READING PASSAGE 2</h2>
        <p>
          You should spend about 20 minutes on Questions 14‚Äì26, which are based
          on Reading Passage 2 below.
        </p>
        <h3>A mechanical friend for children</h3>
        <p>
          <strong>A</strong> The development of robots that interact socially
          with people and assist them in everyday life has been an elusive goal
          of modern science. Despite impressive advances in the mechanical
          aspects of this problem, producing robots that bond and socialize with
          people for sustained periods of time has proven difficult. The most
          successful robots so far have been storytellers, but they have only
          been able to maintain human interest for a limited time and typically
          rely on the robot telling stories that change over time. In practice,
          commercially available robots seldom cross the 10-hour barrier (i.e.,
          individual users tend to spend less than a combined total of 10 hours
          with the robots before losing interest). This observation is in sharp
          contrast to the long-term interactions and bonding that commonly
          develop between humans and their pets.
        </p>
        <p>
          <strong>B</strong> In a recent study, researchers from the Institute
          for Neural Computation in California introduced a state-of-the-art
          social robot into a classroom of 18-to-24-month-olds for five months
          as a way of studying human/robot interactions. The researchers,
          including Fumihide Tanaka and Javier R. Movellan, introduced a
          toddler-sized humanoid robot into a classroom at a childhood education
          center. One of the QRIO series of robots, the 58 cm machine, was
          originally developed by Sony. ‚ÄòChildren of toddler age were chosen
          because they have no preconceived notions of robots,‚Äô according to
          Tanaka. One of the goals of the study was to establish whether it was
          possible for social robots to maintain the interest of children beyond
          the 10-hour barrier.
        </p>
        <p>
          <strong>C</strong> The researchers sent instructions to the robot
          about every two minutes to do things like giggle, dance, sit down,
          fall down, or walk in a certain direction. The 45 sessions were
          videotaped, and interactions between toddlers and the robot were later
          analyzed. The results showed that the quality of those interactions
          improved steadily over 27 sessions. The interactions deteriorated
          quickly over the next 15 sessions, when the robot was ordered to
          behave in a more limited, predictable manner. Finally, the human/robot
          relations improved in the last three sessions, after the robot had
          been instructed to display its full range of behaviors.
        </p>
        <p>
          <strong>D</strong> ‚ÄòInitially, the children treated the robot very
          differently from the way they treated each other,‚Äô Tanaka said. ‚ÄòEarly
          in the study, some children cried when QRIO fell. But a month into the
          study, the toddlers helped QRIO stand up by pushing its back or
          pulling its hands.‚Äô ‚ÄòThe most important aspect of interaction was
          touch,‚Äô Tanaka said. ‚ÄòAt first, the toddlers would touch the robot on
          its face, but later on they would touch it only on its hands and arms,
          like they would with other humans. Another robot-like toy named Robby,
          which resembled QRIO but did not move, was used as a control in the
          study. While hugging of QRIO increased, hugging of Robby decreased
          throughout the study. Furthermore, when QRIO laid down on the floor,
          caretaking behaviors were frequently observed toward QRIO but seldom
          toward Robby.‚Äô
        </p>
        <p>
          <strong>E</strong> The study concluded that after 45 days of immersion
          in a childcare center over a period of five months, long-term bonding
          and socialization occurred between toddlers and a state-of-the-art
          social robot. Overall, the interaction between children and the robot
          improved over time and the children progressively treated it more as a
          peer than a plaything. ‚ÄòTo my knowledge, this is the first long-term
          study of this sort,‚Äô said Ronald Arkin, a roboticist at the Georgia
          Institute of Technology in the US.
        </p>
        <p>
          <strong>F</strong> Tanaka and Movellan are now developing autonomous
          robots for the toddler classroom. ‚ÄòIt could have great potential in
          educational settings, assisting teachers and enriching the classroom
          environment,‚Äô Tanaka said. The researchers hope that more advanced
          versions of robots like QRIO could become personalized tutors to
          assist teachers in classrooms. A robotic tutor could react on the spot
          to social cues and approximate social skills like facial expression
          and eye gaze, they said. ‚ÄòIt is becoming clear that, to achieve this
          goal, we are going to endow machines with something similar to
          emotion, not just traditional forms of intelligence,‚Äô said Movellan.
        </p>
        <p>
          <strong>G</strong> Associate Professor David Powers, an expert in
          artificial intelligence and cognitive science at Flinders University
          in South Australia, commented, ‚ÄòIn this study, it is clearly
          demonstrated that a limited range of robot behaviors, however
          impressive, is nowhere near as important to human/robot interaction as
          being able to make appropriate responses from a broad repertoire of
          behaviors.‚Äô Ronald Arkin was not surprised by the affection
          demonstrated by the toddlers toward the robot. ‚ÄòHumans have a
          tremendous propensity to bond with artifacts, whether it be a car, a
          doll, or a robot,‚Äô he said. But he also cautioned that researchers do
          not yet understand the consequences of increased human/robot
          interaction. ‚ÄòStudying how robots and humans work together can give us
          insight into whether this is a good thing or a bad thing for society,‚Äô
          Arkin said. ‚ÄòWe need to find out what the consequences are of
          introducing a robot into a cadre of children. How will that enhance,
          or potentially interfere with, their social development? Do we really
          understand the long-term impact of having a robot as a childhood
          friend?‚Äô
        </p>
      </section>
      <div id="divider"></div>
      <section class="pane" id="right">
        <h3>Questions</h3>
        <div class="group">
          <h4>Questions 14‚Äì18</h4>
          <p>Reading Passage 2 has seven paragraphs, A‚ÄìG.</p>
          <p>Which paragraph contains the following information?</p>
          <ol start="14">
            <li>
              <span class="flag-btn" data-q="q14" style="left: -20px"></span>a
              comparison of children‚Äôs reactions towards different robots<br />
              <label><input type="radio" name="q14" value="A" /> A</label>
              <label><input type="radio" name="q14" value="B" /> B</label>
              <label><input type="radio" name="q14" value="C" /> C</label>
              <label><input type="radio" name="q14" value="D" /> D</label>
              <label><input type="radio" name="q14" value="E" /> E</label>
              <label><input type="radio" name="q14" value="F" /> F</label>
              <label><input type="radio" name="q14" value="G" /> G</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q15" style="left: -20px"></span>a
              speculation about ways robots may be able to communicate<br />
              <label><input type="radio" name="q15" value="A" /> A</label>
              <label><input type="radio" name="q15" value="B" /> B</label>
              <label><input type="radio" name="q15" value="C" /> C</label>
              <label><input type="radio" name="q15" value="D" /> D</label>
              <label><input type="radio" name="q15" value="E" /> E</label>
              <label><input type="radio" name="q15" value="F" /> F</label>
              <label><input type="radio" name="q15" value="G" /> G</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q16" style="left: -20px"></span>a
              description of changes in the way the children physically handled
              a robot<br />
              <label><input type="radio" name="q16" value="A" /> A</label>
              <label><input type="radio" name="q16" value="B" /> B</label>
              <label><input type="radio" name="q16" value="C" /> C</label>
              <label><input type="radio" name="q16" value="D" /> D</label>
              <label><input type="radio" name="q16" value="E" /> E</label>
              <label><input type="radio" name="q16" value="F" /> F</label>
              <label><input type="radio" name="q16" value="G" /> G</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q17" style="left: -20px"></span>a
              comparison between people‚Äôs connections with animals and their
              connections with robots<br />
              <label><input type="radio" name="q17" value="A" /> A</label>
              <label><input type="radio" name="q17" value="B" /> B</label>
              <label><input type="radio" name="q17" value="C" /> C</label>
              <label><input type="radio" name="q17" value="D" /> D</label>
              <label><input type="radio" name="q17" value="E" /> E</label>
              <label><input type="radio" name="q17" value="F" /> F</label>
              <label><input type="radio" name="q17" value="G" /> G</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q18" style="left: -20px"></span>an
              account of the way one robot was programmed<br />
              <label><input type="radio" name="q18" value="A" /> A</label>
              <label><input type="radio" name="q18" value="B" /> B</label>
              <label><input type="radio" name="q18" value="C" /> C</label>
              <label><input type="radio" name="q18" value="D" /> D</label>
              <label><input type="radio" name="q18" value="E" /> E</label>
              <label><input type="radio" name="q18" value="F" /> F</label>
              <label><input type="radio" name="q18" value="G" /> G</label>
            </li>
          </ol>
        </div>
        <div class="group">
          <h4>Questions 19‚Äì23</h4>
          <p>
            Match each statement with the correct person, <strong>A‚ÄìD</strong>.
          </p>
          <div class="headings-box">
            <h5>List of People</h5>
            <div style="margin-left: 10px">
              <strong>A</strong> Fumihide Tanaka<br />
              <strong>B</strong> Javier R. Movellan<br />
              <strong>C</strong> Ronald Arkin<br />
              <strong>D</strong> David Powers
            </div>
          </div>
          <ol start="19">
            <li>
              <span class="flag-btn" data-q="q19" style="left: -20px"></span>In
              future, robots will not only have to think, but also to show
              feelings.<br />
              <label><input type="radio" name="q19" value="A" /> A</label>
              <label><input type="radio" name="q19" value="B" /> B</label>
              <label><input type="radio" name="q19" value="C" /> C</label>
              <label><input type="radio" name="q19" value="D" /> D</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q20" style="left: -20px"></span>It
              is uncertain whether more contact between people and robots will
              be beneficial.<br />
              <label><input type="radio" name="q20" value="A" /> A</label>
              <label><input type="radio" name="q20" value="B" /> B</label>
              <label><input type="radio" name="q20" value="C" /> C</label>
              <label><input type="radio" name="q20" value="D" /> D</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q21" style="left: -20px"></span
              >Very young children have not yet developed ideas about robots.<br />
              <label><input type="radio" name="q21" value="A" /> A</label>
              <label><input type="radio" name="q21" value="B" /> B</label>
              <label><input type="radio" name="q21" value="C" /> C</label>
              <label><input type="radio" name="q21" value="D" /> D</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q22" style="left: -20px"></span
              >Robots need to perform a wide variety of actions for people to
              relate to them.<br />
              <label><input type="radio" name="q22" value="A" /> A</label>
              <label><input type="radio" name="q22" value="B" /> B</label>
              <label><input type="radio" name="q22" value="C" /> C</label>
              <label><input type="radio" name="q22" value="D" /> D</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q23" style="left: -20px"></span
              >Using robots as an aid in schools may have many benefits.<br />
              <label><input type="radio" name="q23" value="A" /> A</label>
              <label><input type="radio" name="q23" value="B" /> B</label>
              <label><input type="radio" name="q23" value="C" /> C</label>
              <label><input type="radio" name="q23" value="D" /> D</label>
            </li>
          </ol>
        </div>
        <div class="group">
          <h4>Questions 24‚Äì26</h4>
          <p>
            Complete the sentences below. Choose
            <strong>ONE WORD ONLY</strong> from the passage for each answer.
          </p>
          <ol start="24">
            <li>
              <span class="flag-btn" data-q="q24" style="left: -20px"></span
              >Until recently, robots that were best at holding people‚Äôs
              attention were those that acted as
              <input type="text" name="q24" />.
            </li>
            <li>
              <span class="flag-btn" data-q="q25" style="left: -20px"></span>The
              children responded to the QRIO robot as a friend or a
              <input type="text" name="q25" /> rather than as a toy.
            </li>
            <li>
              <span class="flag-btn" data-q="q26" style="left: -20px"></span
              >Arkin expected that the children would show
              <input type="text" name="q26" /> towards the QRIO robot.
            </li>
          </ol>
        </div>
        <div class="bottom-bar">
          <button class="btn-primary" onclick="submitAnswers()">Êèê‰∫§</button>
          <button onclick="resetForm()">ÈáçÁΩÆ</button>
          <button onclick="openWrongBook()">Êú¨ÁØáÈîôÈ¢ò</button>
        </div>
      </section>
    </div>
    <div id="selbar">
      <button id="btnNote">Note</button>
      <button id="btnHL">Highlight</button>
      <button id="btnUH" style="display: none">Clear Highlight</button>
    </div>
    <div class="modal" id="resultModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÊàêÁª©</h2>
          <span class="modal-close" onclick="closeModal('resultModal')">√ó</span>
        </div>
        <div id="resultContent"></div>
        <button
          class="btn-primary"
          style="width: 100%; margin-top: 16px"
          onclick="addWrongToBook()"
        >
          Âä†ÂÖ•ÈîôÈ¢òÊú¨
        </button>
      </div>
    </div>
    <div class="modal" id="wrongBookModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Êú¨ÁØáÈîôÈ¢ò</h2>
          <span class="modal-close" onclick="closeModal('wrongBookModal')"
            >√ó</span
          >
        </div>
        <div id="wrongBookContent"></div>
      </div>
    </div>
    <div class="modal" id="resetModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÈáçÁΩÆÁªÉ‰π†</h2>
          <span class="modal-close" onclick="closeModal('resetModal')">√ó</span>
        </div>
        <div style="margin: 16px 0">
          <label style="display: block; margin-bottom: 10px"
            ><input type="radio" name="resetType" value="answers" checked />
            Âè™Ê∏ÖÁ©∫Á≠îÊ°à</label
          >
          <label style="display: block"
            ><input type="radio" name="resetType" value="all" />
            Ê∏ÖÁ©∫Á≠îÊ°àÂíåÊ†áËÆ∞</label
          >
        </div>
        <button
          class="btn-primary"
          style="width: 100%"
          onclick="confirmReset()"
        >
          Á°ÆÂÆö
        </button>
      </div>
    </div>
    <script>
      const PAPER_ID = "P2_MECHANICAL_FRIEND";
      let t = 0;
      const timerEl = document.getElementById("timer");
      setInterval(() => {
        t++;
        timerEl.textContent =
          String(Math.floor(t / 60)).padStart(2, "0") +
          ":" +
          String(t % 60).padStart(2, "0");
      }, 1000);
      const divider = document.getElementById("divider"),
        left = document.getElementById("left"),
        right = document.getElementById("right");
      let dragging = false;
      divider.onmousedown = () => {
        dragging = true;
        document.body.style.cursor = "ew-resize";
      };
      window.onmousemove = (e) => {
        if (!dragging) return;
        const c = document.querySelector(".shell").getBoundingClientRect();
        let x = e.clientX - c.left;
        x = Math.max(280, Math.min(c.width - 280, x));
        left.style.flex = "0 0 " + x + "px";
        right.style.flex = "1 1 auto";
      };
      window.onmouseup = () => {
        dragging = false;
        document.body.style.cursor = "";
      };
      const selbar = document.getElementById("selbar"),
        btnHL = document.getElementById("btnHL"),
        btnUH = document.getElementById("btnUH"),
        btnNote = document.getElementById("btnNote");
      let lastRange = null,
        currentHlNode = null;
      function posSelbar(r) {
        selbar.style.display = "flex";
        const t = window.scrollY + r.top - selbar.offsetHeight - 8;
        const l =
          window.scrollX + r.left + r.width / 2 - selbar.offsetWidth / 2;
        selbar.style.top = (t > 0 ? t : window.scrollY + r.bottom + 8) + "px";
        selbar.style.left = Math.max(8, l) + "px";
      }
      function updSel() {
        const s = window.getSelection();
        if (!s || s.rangeCount === 0 || s.isCollapsed) {
          if (!currentHlNode) selbar.style.display = "none";
          return;
        }
        const r = s.getRangeAt(0);
        lastRange = r.cloneRange();
        currentHlNode = null;
        btnNote.style.display = "block";
        btnHL.style.display = "block";
        btnUH.style.display = "none";
        posSelbar(r.getBoundingClientRect());
      }
      left.onmouseup = updSel;
      right.onmouseup = updSel;
      document.onselectionchange = () => {
        const s = window.getSelection();
        if ((!s || s.rangeCount === 0 || s.isCollapsed) && !currentHlNode)
          selbar.style.display = "none";
      };
      document.addEventListener(
        "click",
        (e) => {
          if (
            e.target.classList &&
            (e.target.classList.contains("hl") ||
              e.target.classList.contains("note"))
          ) {
            currentHlNode = e.target;
            lastRange = null;
            btnNote.style.display = "none";
            btnHL.style.display = "none";
            btnUH.style.display = "block";
            posSelbar(e.target.getBoundingClientRect());
            const s = window.getSelection();
            if (s) s.removeAllRanges();
          }
        },
        true
      );
      btnHL.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "hl";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "hl";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnNote.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "note";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "note";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnUH.onclick = () => {
        if (currentHlNode) {
          const p = currentHlNode.parentNode;
          while (currentHlNode.firstChild)
            p.insertBefore(currentHlNode.firstChild, currentHlNode);
          p.removeChild(currentHlNode);
          p.normalize();
          currentHlNode = null;
          selbar.style.display = "none";
          saveHighlights();
        } else if (lastRange) {
          const sR = lastRange.getBoundingClientRect();
          const w = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_ELEMENT
          );
          const tr = [];
          while (w.nextNode()) {
            const n = w.currentNode;
            if (
              n.classList &&
              (n.classList.contains("hl") || n.classList.contains("note"))
            ) {
              const r = n.getBoundingClientRect();
              if (
                !(
                  r.right < sR.left ||
                  r.left > sR.right ||
                  r.bottom < sR.top ||
                  r.top > sR.bottom
                )
              )
                tr.push(n);
            }
          }
          tr.forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          selbar.style.display = "none";
          saveHighlights();
        }
      };
      document.querySelectorAll(".flag-btn").forEach((btn) => {
        btn.onclick = (e) => {
          e.stopPropagation();
          btn.classList.toggle("active");
          saveFlags();
        };
      });
      const answerKey = {
        q14: "D",
        q15: "F",
        q16: "D",
        q17: "A",
        q18: "C",
        q19: "B",
        q20: "C",
        q21: "A",
        q22: "D",
        q23: "A",
        q24: "storytellers",
        q25: "peer",
        q26: "affection",
      };
      let lastResults = [];
      function saveAnswers() {
        const data = {};
        Object.keys(answerKey).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) data[q] = radio.value;
          else if (text) data[q] = text.value;
        });
        localStorage.setItem(`${PAPER_ID}_answers`, JSON.stringify(data));
      }
      function loadAnswers() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_answers`) || "{}"
        );
        Object.keys(data).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][value="${data[q]}"]`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) radio.checked = true;
          else if (text) text.value = data[q];
        });
      }
      function saveFlags() {
        const flags = [...document.querySelectorAll(".flag-btn.active")].map(
          (b) => b.dataset.q
        );
        localStorage.setItem(`${PAPER_ID}_flags`, JSON.stringify(flags));
      }
      function loadFlags() {
        const flags = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_flags`) || "[]"
        );
        flags.forEach((q) =>
          document.querySelector(`[data-q="${q}"]`)?.classList.add("active")
        );
      }
      function saveHighlights() {
        const highlights = { left: [], right: [] };
        document
          .querySelectorAll("#left .hl, #left .note")
          .forEach((el, idx) => {
            highlights.left.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        document
          .querySelectorAll("#right .hl, #right .note")
          .forEach((el, idx) => {
            highlights.right.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        localStorage.setItem(
          `${PAPER_ID}_highlights`,
          JSON.stringify(highlights)
        );
      }
      function loadHighlights() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_highlights`) ||
            '{"left":[],"right":[]}'
        );
        const restore = (pane, items) => {
          if (!items || items.length === 0) return;
          items.forEach((item) => {
            const walker = document.createTreeWalker(
              pane,
              NodeFilter.SHOW_TEXT
            );
            let node;
            while ((node = walker.nextNode())) {
              if (node.textContent.includes(item.text)) {
                const span = document.createElement("span");
                span.className = item.type;
                const parent = node.parentNode;
                const text = node.textContent;
                const idx = text.indexOf(item.text);
                if (idx >= 0) {
                  const before = text.substring(0, idx);
                  const match = text.substring(idx, idx + item.text.length);
                  const after = text.substring(idx + item.text.length);
                  parent.insertBefore(document.createTextNode(before), node);
                  span.textContent = match;
                  parent.insertBefore(span, node);
                  parent.insertBefore(document.createTextNode(after), node);
                  parent.removeChild(node);
                  break;
                }
              }
            }
          });
        };
        restore(left, data.left);
        restore(right, data.right);
      }
      document.querySelectorAll("input").forEach((inp) => {
        inp.addEventListener("change", saveAnswers);
        if (inp.type === "text") inp.addEventListener("input", saveAnswers);
      });
      document.addEventListener("DOMContentLoaded", () => {
        loadAnswers();
        loadFlags();
        loadHighlights();
      });
      function submitAnswers() {
        const res = [];
        let cor = 0;
        Object.keys(answerKey).forEach((q) => {
          let uA = "";
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) uA = radio.value;
          else if (text) uA = text.value.trim();
          const cA = answerKey[q];
          const iC = uA.toLowerCase() === cA.toLowerCase();
          if (iC) cor++;
          res.push({ id: q, userAns: uA, correctAns: cA, isCorrect: iC });
        });
        lastResults = res;
        const tot = Object.keys(answerKey).length;
        const pct = ((cor / tot) * 100).toFixed(1);
        localStorage.setItem(`ielts_score_${PAPER_ID}`, `${cor}/${tot}`);
        document.getElementById(
          "resultContent"
        ).innerHTML = `<div class="result-summary"><div class="result-score">${cor} / ${tot}</div><div style="margin-top:8px;font-size:18px;">${pct}%</div></div>${res
          .map(
            (r) =>
              `<div class="result-item ${
                r.isCorrect ? "correct" : "incorrect"
              }"><div><strong>${r.id}</strong> ${
                r.isCorrect ? "‚úì" : "‚úó"
              }</div><div>‰Ω†ÁöÑÁ≠îÊ°à: ${r.userAns || "(Êú™‰ΩúÁ≠î)"}</div>${
                !r.isCorrect ? `<div>Ê≠£Á°ÆÁ≠îÊ°à: ${r.correctAns}</div>` : ""
              }</div>`
          )
          .join("")}`;
        document.getElementById("resultModal").classList.add("active");
      }
      function resetForm() {
        document.getElementById("resetModal").classList.add("active");
      }
      function confirmReset() {
        const tp = document.querySelector(
          'input[name="resetType"]:checked'
        ).value;
        document.querySelectorAll("input").forEach((i) => {
          if (i.type === "radio") i.checked = false;
          if (i.type === "text") i.value = "";
        });
        localStorage.removeItem(`${PAPER_ID}_answers`);
        if (tp === "all") {
          document.querySelectorAll(".hl").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document.querySelectorAll(".note").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document
            .querySelectorAll(".flag-btn")
            .forEach((b) => b.classList.remove("active"));
          localStorage.removeItem(`${PAPER_ID}_highlights`);
          localStorage.removeItem(`${PAPER_ID}_flags`);
        }
        closeModal("resetModal");
      }
      function addWrongToBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const wr = lastResults.filter((r) => !r.isCorrect);
        wr.forEach((r) => {
          const en = {
            paperId: PAPER_ID,
            title: "A mechanical friend for children",
            questionId: r.id,
            correctAnswer: r.correctAns,
            myAnswer: r.userAns || "(Êú™‰ΩúÁ≠î)",
            date: new Date().toISOString().split("T")[0],
          };
          const ix = wb.findIndex(
            (i) => i.paperId === en.paperId && i.questionId === en.questionId
          );
          if (ix >= 0) wb[ix] = en;
          else wb.push(en);
        });
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        alert(`Â∑≤Ê∑ªÂä† ${wr.length} ÈÅìÈîôÈ¢ò`);
        closeModal("resultModal");
      }
      function deleteWrongItem(pId, qId) {
        if (!confirm("Á°ÆÂÆöÂà†Èô§ËøôÈÅìÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => !(i.paperId === pId && i.questionId === qId));
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function clearCurrentWrongBook() {
        if (!confirm("Á°ÆÂÆöÊ∏ÖÁ©∫Êú¨ÁØáÊâÄÊúâÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => i.paperId !== PAPER_ID);
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function openWrongBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const cu = wb.filter((i) => i.paperId === PAPER_ID);
        const ct = document.getElementById("wrongBookContent");
        if (cu.length === 0)
          ct.innerHTML =
            '<div style="text-align:center;padding:40px;color:#666;">ÊöÇÊó†ÈîôÈ¢ò</div>';
        else
          ct.innerHTML = `<div class="modal-actions"><button class="btn-danger" onclick="clearCurrentWrongBook()" stylewidth:100%;">üóëÔ∏è Ê∏ÖÁ©∫Êú¨ÁØáÈîôÈ¢ò</button></div>${cu
            .map(
              (i) =>
                `<div class="wrong-item"><div class="wrong-item-content"><div style="font-weight:600;margin-bottom:8px;">${i.questionId}</div><div style="font-size:13px;color:#666;"><div>‚úì Ê≠£Á°Æ: ${i.correctAnswer}</div><div style="color:#d32f2f;">‚úó ÊàëÁöÑ: ${i.myAnswer}</div></div></div><button class="btn-delete" onclick="deleteWrongItem('${i.paperId}','${i.questionId}')">Âà†Èô§</button></div>`
            )
            .join("")}`;
        document.getElementById("wrongBookModal").classList.add("active");
      }
      function closeModal(id) {
        document.getElementById(id).classList.remove("active");
      }
    </script>
  </body>
</html>
