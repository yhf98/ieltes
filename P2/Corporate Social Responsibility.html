<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>P2 ‚Äì Corporate Social Responsibility</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  * { box-sizing: border-box; margin:0; padding:0; }
  html,body { height:100%; }
  body { font-family: Arial, sans-serif; background:#f5f5f5; }
  
  #timer { position:fixed; top:12px; right:12px; background:#fff; border:1px solid #ddd; border-radius:6px; padding:8px 12px; font-size:16px; font-weight:600; color:#0066cc; z-index:1000; }
  
  .shell { display:flex; height:100vh; width:100%; }
  .pane { background:#fff; overflow:auto; padding:24px; }
  #left { flex: 0 0 50%; border-right:1px solid #ddd; }
  #right { flex: 1 1 auto; background:#fafafa; }
  #divider { flex: 0 0 5px; background:#ddd; cursor: ew-resize; }
  #divider:hover { background:#999; }
  
  h2,h3,h4 { margin:0 0 12px; color:#333; }
  h2 { font-size:20px; }
  h3 { font-size:18px; color:#0066cc; }
  h4 { font-size:15px; font-weight:600; margin-top:20px; }
  
  #left p { margin: 0 0 14px; line-height: 1.7; text-align:justify; }
  .paragraph-label { font-weight:600; color:#0066cc; margin-right:8px; }
  
  .group { background:#fff; border:1px solid #ddd; border-radius:6px; padding:16px; margin-bottom:16px; }
  .group h4 { margin-top:0; color:#0066cc; }
  .group p { margin:8px 0; font-size:14px; line-height:1.6; }
  
  .headings { background:#f9f9f9; padding:12px; margin:12px 0; border-radius:4px; }
  .headings ul { margin-left:20px; list-style:none; }
  .headings li { margin:4px 0; font-size:13px; }
  .headings li::before { content:""; margin-right:4px; }
  
  table { border-collapse: collapse; width:100%; margin:12px 0; }
  th, td { border:1px solid #ddd; padding:6px; text-align:center; font-size:13px; position:relative; }
  th { background:#f5f5f5; font-weight:600; }
  
  .flag-btn { 
    position:absolute; 
    left:2px; 
    top:50%;
    transform:translateY(-50%);
    width:8px;
    height:8px;
    border-radius:50%;
    background:#ddd;
    cursor:pointer;
    z-index:10;
  }
  .flag-btn:hover { background:#999; }
  .flag-btn.active { background:#ff5722; }
  
  tr td:first-child { padding-left:16px; }
  
  .group ol { margin-left:20px; }
  .group ol li { margin:12px 0; font-size:14px; line-height:1.6; position:relative; }
  .group ol li label { display:inline-block; margin-right:8px; }
  
  .summary-text { line-height:1.8; font-size:14px; }
  .question-number { font-weight:600; color:#0066cc; }
  input.blank { 
    width:120px; 
    padding:4px 8px; 
    border:1px solid #ddd; 
    border-radius:4px; 
    font-size:13px; 
  }
  input.blank:focus { outline:none; border-color:#0066cc; }
  
  .company-option { display:flex; gap:8px; margin:8px 0; }
  .company-option label { cursor:pointer; }
  
  .bottom-bar { display:flex; gap:10px; margin-top:16px; }
  button { padding:10px 20px; border:1px solid #999; border-radius:6px; background:#fff; cursor:pointer; font-size:14px; }
  button:hover { background:#f0f0f0; }
  .btn-primary { background:#0066cc; color:#fff; border-color:#0066cc; }
  .btn-primary:hover { background:#0052a3; }
  .btn-danger { background:#dc3545; color:#fff; border-color:#dc3545; }
  .btn-danger:hover { background:#c82333; }
  
  .hl { background:#fff59d; cursor:pointer; }
  .hl:hover { background:#ffeb3b; }
  .note { background:#b3d9ff; cursor:pointer; }
  .note:hover { background:#99ccff; }
  
  #selbar { position:fixed; display:none; z-index:2000; background:#fff; border:1px solid #ddd; border-radius:8px; padding:8px; gap:0; box-shadow:0 2px 8px rgba(0,0,0,0.15); flex-direction:column; min-width:120px; }
  #selbar button { background:#fff; color:#666; border:none; padding:3px 0px; cursor:pointer; font-size:14px; text-align:center; border-radius:4px; }
  #selbar button:hover { background:#f5f5f5; color:#333; }
  
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:3000; align-items:center; justify-content:center; }
  .modal.active { display:flex; }
  .modal-content { background:#fff; border-radius:8px; padding:24px; max-width:600px; width:90%; max-height:80vh; overflow-y:auto; }
  
  .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
  .modal-header h2 { font-size: 28px; color: #333; margin: 0; }
  .modal-close { font-size: 32px; cursor: pointer; color: #999; line-height: 1; }
  .modal-close:hover { color: #333; }
  
  .result-summary { text-align:center; padding:20px; background:#f0f0f0; margin-bottom:16px; border-radius:6px; }
  .result-score { font-size:36px; font-weight:600; color:#0066cc; }
  .result-item { padding:10px; margin:8px 0; border-left:3px solid #ddd; background:#f9f9f9; font-size:13px; }
  .result-item.correct { border-left-color:#28a745; background:#e8f5e9; }
  .result-item.incorrect { border-left-color:#dc3545; background:#ffebee; }
  
  .wrong-item { background:#fff3e0; padding:16px; margin:8px 0; border-radius:8px; border-left:4px solid #ff9800; display:flex; justify-content:space-between; align-items:start; }
  .wrong-item-content { flex:1; }
  .btn-delete { background:#dc3545; color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:13px; margin-left:12px; }
  .btn-delete:hover { background:#c82333; }
  .modal-actions { display:flex; gap:10px; margin-bottom:20px; }
</style>
</head>
<body>
<div id="timer">00:00</div>

<div class="shell">
  <section class="pane" id="left">
    
<h2>READING PASSAGE 2</h2>
<p>You should spend about 20 minutes on Questions 14‚Äì26, which are based on Reading Passage 2 below.</p>
<h3>Corporate Social Responsibility</h3>

<h4>Paragraph A</h4>
<p>An excellent definition was developed in the 1980s by Norwegian Prime Minister Gro Harlem Brundtland and used by the World Business Council for Sustainable Development: "Meeting the needs of the present without compromising the ability of future generations to meet their own needs." Nowadays, governments and companies need to account for the social consequences of their actions. As a result, corporate social responsibility (CSR) has become a priority for business leaders around the world. When a well-run business applies its vast resources and expertise to social problems that it understands and in which it has a stake, it can have a greater impact than any other organisation. The notion of licence to operate derives from the fact that every company needs tacit or explicit permission from governments, communities, and numerous other stakeholders to justify CSR initiatives to improve a company's image, strengthen its brand, enliven morale and even raise the value of its stock.</p>

<h4>Paragraph B</h4>
<p>To advance CSR, we must root it in a broad understanding of the interrelationship between a corporation and society. Successful corporations need a healthy society. Education, health care, and equal opportunity are essential to a productive workforce. Safe products and working conditions not only attract customers but lower the internal costs of accidents. Efficient utilisation of land, water, energy, and other natural resources makes business more productive. Good government, the rule of law, and property rights are essential for efficiency and innovation. Strong regulatory standards protect both consumers and competitive companies from exploitation. Ultimately, a healthy society creates expanding demand for business, as more human needs are met and aspirations grow. Any business that pursues its ends at the expense of the society in which it operates will find its success to be illusory and ultimately temporary. At the same time, a healthy society needs successful companies. No social programme can rival the business sector when it comes to creating the jobs, wealth, and innovation that improve standards of living and social conditions over time.</p>

<h4>Paragraph C</h4>
<p>A company's impact on society also changes over time, as social standards evolve and science progresses. Asbestos, now understood as a serious health risk, was thought to be safe in the early 1900s, given the scientific knowledge then available. Evidence of its risks gradually mounted for more than 50 years before any company was held liable for the harms it can cause. Many firms that failed to anticipate the consequences of this evolving body of research have been bankrupted by the results. No longer can companies be content to monitor only the obvious social impacts of today. Without a careful process for identifying evolving social effects of tomorrow, firms may risk their very survival.</p>

<h4>Paragraph D</h4>
<p>No business can solve all of society's problems or bear the cost of doing so. Instead, each company must select issues that intersect with its particular business. Other social agendas are best left to those companies in other industries, NGOs, or government institutions that are better positioned to address them. The essential test that should guide CSR is not whether a cause is worthy but whether it presents an opportunity to create shared value ‚Äì that is, a meaningful benefit for society that is also valuable to the business. Each company can identify the particular set of societal problems that it is best equipped to help resolve and from which it can gain the greatest competitive benefit.</p>

<h4>Paragraph E</h4>
<p>The best corporate citizenship initiatives involve far more than writing a cheque: they specify clear, measurable goals and track results over time. A good example is General Electric's programme to adopt underperforming public high schools near several of its major U.S. facilities. The company contributes between $250,000 and $1 million over a five-year period to each school and makes in-kind donations as well. GE managers and employees take an active role by working with school administrators to assess needs and mentor or tutor students. In an independent study of ten schools in the programme between 1989 and 1999, nearly all showed significant improvement, while the graduation rate in four of the five worst-performing schools doubled from an average of 30% to 60%. Effective corporate citizenship initiatives such as this one create goodwill and improve relations with local governments and other important constituencies. What's more, GE's employees feel great pride in their participation. Their effect is inherently limited, however. No matter how beneficial the programme is, it remains incidental to the company's business, and the direct effect on GE's recruiting and retention is modest.</p>

<h4>Paragraph F</h4>
<p>Microsoft's Working Connections partnership with the American Association of Community Colleges (AACC) is a good example of a shared-value opportunity arising from investments in context. The shortage of information-technology workers is a significant constraint on Microsoft's growth; currently, there are more than 450,000 unfilled IT positions in the United States alone. Community colleges, with an enrolment of 11.6 million students, representing 45% of all U.S. undergraduates, could be a major solution. Microsoft recognises, however, that community colleges face special challenges: IT curricula are not standardised, technology used in classrooms is often outdated, and there are no systematic professional development programmes to keep faculty up to date. Microsoft's $50 million five-year initiative was aimed at all three problems. In addition to contributing money and products, Microsoft sent employee volunteers to colleges to assess needs, contribute to curriculum development, and create faculty-development institutes. Microsoft has achieved results that have benefited many communities while having a direct and potentially significant impact on the company.</p>

<h4>Paragraph G</h4>
<p>At the heart of any strategy is a unique value proposition: a set of needs a company can meet for its chosen customers that its competitors cannot. The most strategic CSR occurs when a company adds a social dimension to its value proposition, making social impact integral to the overall strategy. Consider Whole Foods Market, whose value proposition is to sell organic, natural, and healthy food products to customers who are passionate about food and the environment. The company's sourcing emphasises purchases from local farmers through each store's procurement process. Buyers screen out foods containing any of nearly 100 common ingredients that the company considers unhealthy or environmentally damaging. The same standards apply to products made internally. Whole Foods' commitment to natural and environmentally friendly operating practices extends well beyond sourcing. Stores are constructed using a minimum of virgin raw materials. Recently, the company purchased renewable wind-energy credits equal to 100% of its electricity use in all of its stores and facilities, the only Fortune 500 company to offset its electricity consumption entirely. Spoiled produce and biodegradable waste are trucked to regional centres for composting. Whole Foods' vehicles are being converted to run on biofuels. Even the cleaning products used in its stores are environmentally friendly. And through its philanthropy, the company has created the Animal Compassion Foundation to develop more natural and humane ways of raising farm animals. In short, nearly every aspect of the company's value chain reinforces the social dimensions of its value proposition, distinguishing Whole Foods from its competitors.</p>

  </section>

  <div id="divider" title="Drag to resize"></div>

  <section class="pane" id="right">
    <h3>Questions</h3>

    <div class="group">
      <h4>Questions 14‚Äì20</h4>
      <p>Reading Passage 2 has seven paragraphs, A‚ÄìG.</p>
      <p>Choose the correct heading for each paragraph from the list of headings below.</p>
      <p>Write the correct number, <strong>i‚Äìviii</strong>, in boxes <strong>14‚Äì20</strong> on your answer sheet.</p>

      <div class="headings">
        <p><strong>List of Headings</strong></p>
        <ul style="line-height:2;">
          <li>i &nbsp;&nbsp; How CSR may help one business to expand</li>
          <li>ii &nbsp;&nbsp; CSR in many aspects of a company's business</li>
          <li>iii &nbsp;&nbsp; A CSR initiative without a financial gain</li>
          <li>iv &nbsp;&nbsp; Lack of action by the state on social issues</li>
          <li>v &nbsp;&nbsp; Drivers or pressures motivate companies to address CSR</li>
          <li>vi &nbsp;&nbsp; The past illustrates businesses are responsible for future outcomes</li>
          <li>vii &nbsp;&nbsp; Companies applying CSR should be selective</li>
          <li>viii &nbsp;&nbsp; Reasons that business and society benefit each other</li>
        </ul>
      </div>

      <table>
        <tr>
          <th>Para</th>
          <th>i</th><th>ii</th><th>iii</th><th>iv</th><th>v</th><th>vi</th><th>vii</th><th>viii</th>
        </tr>
        <tr><td><span class="flag-btn" data-q="q14"></span>A</td><td><input type="radio" name="q14" value="i"></td><td><input type="radio" name="q14" value="ii"></td><td><input type="radio" name="q14" value="iii"></td><td><input type="radio" name="q14" value="iv"></td><td><input type="radio" name="q14" value="v"></td><td><input type="radio" name="q14" value="vi"></td><td><input type="radio" name="q14" value="vii"></td><td><input type="radio" name="q14" value="viii"></td></tr>
        <tr><td><span class="flag-btn" data-q="q15"></span>B</td><td><input type="radio" name="q15" value="i"></td><td><input type="radio" name="q15" value="ii"></td><td><input type="radio" name="q15" value="iii"></td><td><input type="radio" name="q15" value="iv"></td><td><input type="radio" name="q15" value="v"></td><td><input type="radio" name="q15" value="vi"></td><td><input type="radio" name="q15" value="vii"></td><td><input type="radio" name="q15" value="viii"></td></tr>
        <tr><td><span class="flag-btn" data-q="q16"></span>C</td><td><input type="radio" name="q16" value="i"></td><td><input type="radio" name="q16" value="ii"></td><td><input type="radio" name="q16" value="iii"></td><td><input type="radio" name="q16" value="iv"></td><td><input type="radio" name="q16" value="v"></td><td><input type="radio" name="q16" value="vi"></td><td><input type="radio" name="q16" value="vii"></td><td><input type="radio" name="q16" value="viii"></td></tr>
        <tr><td><span class="flag-btn" data-q="q17"></span>D</td><td><input type="radio" name="q17" value="i"></td><td><input type="radio" name="q17" value="ii"></td><td><input type="radio" name="q17" value="iii"></td><td><input type="radio" name="q17" value="iv"></td><td><input type="radio" name="q17" value="v"></td><td><input type="radio" name="q17" value="vi"></td><td><input type="radio" name="q17" value="vii"></td><td><input type="radio" name="q17" value="viii"></td></tr>
        <tr><td><span class="flag-btn" data-q="q18"></span>E</td><td><input type="radio" name="q18" value="i"></td><td><input type="radio" name="q18" value="ii"></td><td><input type="radio" name="q18" value="iii"></td><td><input type="radio" name="q18" value="iv"></td><td><input type="radio" name="q18" value="v"></td><td><input type="radio" name="q18" value="vi"></td><td><input type="radio" name="q18" value="vii"></td><td><input type="radio" name="q18" value="viii"></td></tr>
        <tr><td><span class="flag-btn" data-q="q19"></span>F</td><td><input type="radio" name="q19" value="i"></td><td><input type="radio" name="q19" value="ii"></td><td><input type="radio" name="q19" value="iii"></td><td><input type="radio" name="q19" value="iv"></td><td><input type="radio" name="q19" value="v"></td><td><input type="radio" name="q19" value="vi"></td><td><input type="radio" name="q19" value="vii"></td><td><input type="radio" name="q19" value="viii"></td></tr>
        <tr><td><span class="flag-btn" data-q="q20"></span>G</td><td><input type="radio" name="q20" value="i"></td><td><input type="radio" name="q20" value="ii"></td><td><input type="radio" name="q20" value="iii"></td><td><input type="radio" name="q20" value="iv"></td><td><input type="radio" name="q20" value="v"></td><td><input type="radio" name="q20" value="vi"></td><td><input type="radio" name="q20" value="vii"></td><td><input type="radio" name="q20" value="viii"></td></tr>
      </table>
    </div>

    <div class="group">
      <h4>Questions 21‚Äì22</h4>
      <p>Complete the summary below.</p>
      <p>Choose <strong>NO MORE THAN TWO WORDS</strong> from the passage for each answer.</p>
      <p>Write your answers in boxes <strong>21‚Äì22</strong> on your answer sheet.</p>
      
      <h4 style="margin-top:16px;">The implementation of CSR ‚Äì How?</h4>
      <p class="summary-text">
        Promotion of CSR requires the understanding of interdependence between business and society. Corporations' workers' productivity generally needs health care, education, and <span class="question-number">21</span> <input type="text" class="blank" id="q21" name="q21">. Restrictions imposed by government and companies both protect consumers from being treated unfairly. Improvement of the safety standard can reduce the <span class="question-number">22</span> <input type="text" class="blank" id="q22" name="q22"> of accidents in the workplace. Similarly, society becomes a pool of more human needs and aspirations.
      </p>
    </div>

    <div class="group">
      <h4>Questions 23‚Äì26</h4>
      <p>Look at the following opinions or deeds (Questions 23‚Äì26) and the list of companies below.</p>
      <p>Match each opinion or deed with the correct company, <strong>A, B or C</strong>.</p>
      <p>Write the correct letter, A, B or C, in boxes <strong>23‚Äì26</strong> on your answer sheet.</p>
      <p><strong>NB</strong> You may use any letter more than once.</p>
      
      <div class="headings">
        <p><strong>List of Companies</strong></p>
        <div style="line-height:2;">
          <div>A. General Electric</div>
          <div>B. Microsoft</div>
          <div>C. Whole Foods Market</div>
        </div>
      </div>

      <ol start="23">
        <li><span class="flag-btn" data-q="q23" style="left:-20px;"></span>Disposable waste<br>
          <div class="company-option">
            <label><input type="radio" name="q23" value="A"> A</label>
            <label><input type="radio" name="q23" value="B"> B</label>
            <label><input type="radio" name="q23" value="C"> C</label>
          </div>
        </li>
        <li><span class="flag-btn" data-q="q24" style="left:-20px;"></span>The way the company purchases its goods<br>
          <div class="company-option">
            <label><input type="radio" name="q24" value="A"> A</label>
            <label><input type="radio" name="q24" value="B"> B</label>
            <label><input type="radio" name="q24" value="C"> C</label>
          </div>
        </li>
        <li><span class="flag-btn" data-q="q25" style="left:-20px;"></span>Helping the under-developed<br>
          <div class="company-option">
            <label><input type="radio" name="q25" value="A"> A</label>
            <label><input type="radio" name="q25" value="B"> B</label>
            <label><input type="radio" name="q25" value="C"> C</label>
          </div>
        </li>
        <li><span class="flag-btn" data-q="q26" style="left:-20px;"></span>Ensuring that people have the latest information<br>
          <div class="company-option">
            <label><input type="radio" name="q26" value="A"> A</label>
            <label><input type="radio" name="q26" value="B"> B</label>
            <label><input type="radio" name="q26" value="C"> C</label>
          </div>
        </li>
      </ol>
    </div>

    <div class="bottom-bar">
      <button class="btn-primary" onclick="submitAnswers()">Êèê‰∫§</button>
      <button onclick="resetForm()">ÈáçÁΩÆ</button>
      <button onclick="openWrongBook()">Êú¨ÁØáÈîôÈ¢ò</button>
    </div>
  </section>
</div>

<div id="selbar">
  <button id="btnNote">Note</button>
  <button id="btnHL">Highlight</button>
  <button id="btnUH" style="display:none;">Clear Highlight</button>
</div>

<div class="modal" id="resultModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>ÊàêÁª©</h2>
      <span class="modal-close" onclick="closeModal('resultModal')">√ó</span>
    </div>
    <div id="resultContent"></div>
    <button class="btn-primary" style="width:100%; margin-top:16px;" onclick="addWrongToBook()">Âä†ÂÖ•ÈîôÈ¢òÊú¨</button>
  </div>
</div>

<div class="modal" id="wrongBookModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Êú¨ÁØáÈîôÈ¢ò</h2>
      <span class="modal-close" onclick="closeModal('wrongBookModal')">√ó</span>
    </div>
    <div id="wrongBookContent"></div>
  </div>
</div>

<div class="modal" id="resetModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>ÈáçÁΩÆÁªÉ‰π†</h2>
      <span class="modal-close" onclick="closeModal('resetModal')">√ó</span>
    </div>
    <div style="margin:16px 0;">
      <label style="display:block; margin-bottom:10px;">
        <input type="radio" name="resetType" value="answers" checked>
        Âè™Ê∏ÖÁ©∫Á≠îÊ°à
      </label>
      <label style="display:block;">
        <input type="radio" name="resetType" value="all">
        Ê∏ÖÁ©∫Á≠îÊ°àÂíåÊ†áËÆ∞
      </label>
    </div>
    <button class="btn-primary" style="width:100%;" onclick="confirmReset()">Á°ÆÂÆö</button>
  </div>
</div>

<script>
const PAPER_ID='P2_CSR';

let t=0;
const timerEl=document.getElementById('timer');
setInterval(()=>{ t++; timerEl.textContent=String(Math.floor(t/60)).padStart(2,'0')+':'+String(t%60).padStart(2,'0'); }, 1000);

const divider=document.getElementById('divider'), left=document.getElementById('left'), right=document.getElementById('right');
let dragging=false;
divider.onmousedown=()=>{ dragging=true; document.body.style.cursor='ew-resize'; };
window.onmousemove=(e)=>{ if(!dragging)return; const c=document.querySelector('.shell').getBoundingClientRect(); let x=e.clientX-c.left; x=Math.max(280,Math.min(c.width-280,x)); left.style.flex='0 0 '+x+'px'; right.style.flex='1 1 auto'; };
window.onmouseup=()=>{ dragging=false; document.body.style.cursor=''; };

const selbar=document.getElementById('selbar'), btnHL=document.getElementById('btnHL'), btnUH=document.getElementById('btnUH'), btnNote=document.getElementById('btnNote');
let lastRange=null, currentHlNode=null;

function posSelbar(r){ selbar.style.display='flex'; const t=window.scrollY+r.top-selbar.offsetHeight-8; const l=window.scrollX+r.left+r.width/2-selbar.offsetWidth/2; selbar.style.top=((t>0)?t:(window.scrollY+r.bottom+8))+'px'; selbar.style.left=Math.max(8,l)+'px'; }

function updSel(){ const s=window.getSelection(); if(!s||s.rangeCount===0||s.isCollapsed){ if(!currentHlNode)selbar.style.display='none'; return; } const r=s.getRangeAt(0); lastRange=r.cloneRange(); currentHlNode=null; btnNote.style.display='block'; btnHL.style.display='block'; btnUH.style.display='none'; posSelbar(r.getBoundingClientRect()); }

left.onmouseup=updSel; right.onmouseup=updSel;
document.onselectionchange=()=>{ const s=window.getSelection(); if((!s||s.rangeCount===0||s.isCollapsed)&&!currentHlNode)selbar.style.display='none'; };
document.addEventListener('click',(e)=>{ if(e.target.classList&&(e.target.classList.contains('hl')||e.target.classList.contains('note'))){ currentHlNode=e.target; lastRange=null; btnNote.style.display='none'; btnHL.style.display='none'; btnUH.style.display='block'; posSelbar(e.target.getBoundingClientRect()); const s=window.getSelection(); if(s)s.removeAllRanges(); }}, true);

btnHL.onclick=()=>{ if(currentHlNode||!lastRange||lastRange.collapsed)return; const s=document.createElement('span'); s.className='hl'; try{ lastRange.surroundContents(s); }catch(e){ const w=document.createElement('span'); w.className='hl'; w.appendChild(lastRange.cloneContents()); lastRange.deleteContents(); lastRange.insertNode(w); } selbar.style.display='none'; saveHighlights(); };

btnNote.onclick=()=>{ if(currentHlNode||!lastRange||lastRange.collapsed)return; const s=document.createElement('span'); s.className='note'; try{ lastRange.surroundContents(s); }catch(e){ const w=document.createElement('span'); w.className='note'; w.appendChild(lastRange.cloneContents()); lastRange.deleteContents(); lastRange.insertNode(w); } selbar.style.display='none'; saveHighlights(); };

btnUH.onclick=()=>{ if(currentHlNode){ const p=currentHlNode.parentNode; while(currentHlNode.firstChild)p.insertBefore(currentHlNode.firstChild,currentHlNode); p.removeChild(currentHlNode); p.normalize(); currentHlNode=null; selbar.style.display='none'; saveHighlights(); }else if(lastRange){ const sR=lastRange.getBoundingClientRect(); const w=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT); const tr=[]; while(w.nextNode()){ const n=w.currentNode; if(n.classList&&(n.classList.contains('hl')||n.classList.contains('note'))){ const r=n.getBoundingClientRect(); if(!(r.right<sR.left||r.left>sR.right||r.bottom<sR.top||r.top>sR.bottom))tr.push(n); }} tr.forEach(el=>{ const p=el.parentNode; while(el.firstChild)p.insertBefore(el.firstChild,el); p.removeChild(el); p.normalize(); }); selbar.style.display='none'; saveHighlights(); }};

document.querySelectorAll('.flag-btn').forEach(btn => {
  btn.onclick = e => {
    e.stopPropagation();
    btn.classList.toggle('active');
    saveFlags();
  };
});

const answerKey={q14:"v",q15:"viii",q16:"vi",q17:"vii",q18:"iii",q19:"i",q20:"ii",q21:"equal opportunity",q22:"internal costs",q23:"C",q24:"C",q25:"A",q26:"B"};
let lastResults=[];

function saveAnswers() {
  const data = {};
  Object.keys(answerKey).forEach(q => {
    if(q.startsWith('q21') || q.startsWith('q22')) {
      const input = document.getElementById(q);
      if(input && input.value.trim()) data[q] = input.value.trim();
    } else {
      const ch = document.querySelector(`input[name="${q}"]:checked`);
      if(ch) data[q] = ch.value;
    }
  });
  localStorage.setItem(`${PAPER_ID}_answers`, JSON.stringify(data));
}

function loadAnswers() {
  const data = JSON.parse(localStorage.getItem(`${PAPER_ID}_answers`) || '{}');
  Object.keys(data).forEach(q => {
    if(q.startsWith('q21') || q.startsWith('q22')) {
      const input = document.getElementById(q);
      if(input) input.value = data[q];
    } else {
      const radio = document.querySelector(`input[name="${q}"][value="${data[q]}"]`);
      if(radio) radio.checked = true;
    }
  });
}

function saveFlags() {
  const flags = [...document.querySelectorAll('.flag-btn.active')].map(b => b.dataset.q);
  localStorage.setItem(`${PAPER_ID}_flags`, JSON.stringify(flags));
}

function loadFlags() {
  const flags = JSON.parse(localStorage.getItem(`${PAPER_ID}_flags`) || '[]');
  flags.forEach(q => document.querySelector(`[data-q="${q}"]`)?.classList.add('active'));
}

function saveHighlights() {
        const highlights = { left: [], right: [] };

        document
          .querySelectorAll("#left .hl, #left .note")
          .forEach((el, idx) => {
            highlights.left.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });

        document
          .querySelectorAll("#right .hl, #right .note")
          .forEach((el, idx) => {
            highlights.right.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });

        localStorage.setItem(
          `${PAPER_ID}_highlights`,
          JSON.stringify(highlights)
        );
      }

      function loadHighlights() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_highlights`) ||
            '{"left":[],"right":[]}'
        );

        // Â∑¶ËæπÂÜÖÂÆπÊÅ¢Â§ç
        data.left.forEach((item) => restoreHighlight(left, item));

        // Âè≥ËæπÂÜÖÂÆπÊÅ¢Â§ç
        data.right.forEach((item) => restoreHighlight(right, item));
      }

      function restoreHighlight(container, item) {
        const walker = document.createTreeWalker(
          container,
          NodeFilter.SHOW_TEXT
        );
        let node;
        while ((node = walker.nextNode())) {
          if (node.textContent.includes(item.text)) {
            const span = document.createElement("span");
            span.className = item.type;

            const parent = node.parentNode;
            const text = node.textContent;
            const idx = text.indexOf(item.text);

            if (idx >= 0) {
              const before = text.substring(0, idx);
              const match = text.substring(idx, idx + item.text.length);
              const after = text.substring(idx + item.text.length);

              parent.insertBefore(document.createTextNode(before), node);
              span.textContent = match;
              parent.insertBefore(span, node);
              parent.insertBefore(document.createTextNode(after), node);
              parent.removeChild(node);
              break;
            }
          }
        }
      }

document.querySelectorAll('input[type="radio"]').forEach(radio => {
  radio.addEventListener('change', saveAnswers);
});

document.getElementById('q21').addEventListener('input', saveAnswers);
document.getElementById('q22').addEventListener('input', saveAnswers);

document.addEventListener('DOMContentLoaded', () => {
  loadAnswers();
  loadFlags();
  loadHighlights();
});

function submitAnswers(){ 
  const res=[]; 
  let cor=0; 
  Object.keys(answerKey).forEach(q=>{ 
    let uA = "";
    if(q === 'q21' || q === 'q22') {
      const input = document.getElementById(q);
      uA = input ? input.value.trim().toLowerCase() : "";
    } else {
      const ch = document.querySelector('input[name="'+q+'"]:checked'); 
      uA = ch ? ch.value : "";
    }
    const cA = answerKey[q];
    const iC = (q === 'q21' || q === 'q22') ? uA === cA.toLowerCase() : uA === cA;
    if(iC) cor++; 
    res.push({id:q,userAns:uA||'(Êú™‰ΩúÁ≠î)',correctAns:cA,isCorrect:iC}); 
  }); 
  lastResults=res; 
  const tot=Object.keys(answerKey).length; 
  const pct=((cor/tot)*100).toFixed(1); 
    localStorage.setItem(`ielts_score_${PAPER_ID}`, `${cor}/${tot}`);
  document.getElementById('resultContent').innerHTML=`<div class="result-summary"><div class="result-score">${cor} / ${tot}</div><div style="margin-top:8px;font-size:18px;">${pct}%</div></div>${res.map(r=>`<div class="result-item ${r.isCorrect?'correct':'incorrect'}"><div><strong>${r.id}</strong> ${r.isCorrect?'‚úì':'‚úó'}</div><div>‰Ω†ÁöÑÁ≠îÊ°à: ${r.userAns}</div>${!r.isCorrect?`<div>Ê≠£Á°ÆÁ≠îÊ°à: ${r.correctAns}</div>`:''}</div>`).join('')}`; 
  document.getElementById('resultModal').classList.add('active'); 
}

function resetForm(){ document.getElementById('resetModal').classList.add('active'); }

function confirmReset(){ 
  const tp=document.querySelector('input[name="resetType"]:checked').value; 
  document.querySelectorAll('input[type="radio"]').forEach(i=>i.checked=false); 
  document.getElementById('q21').value = '';
  document.getElementById('q22').value = '';
  localStorage.removeItem(`${PAPER_ID}_answers`);
  
  if(tp==='all'){ 
    document.querySelectorAll('.hl').forEach(el=>{ const p=el.parentNode; while(el.firstChild)p.insertBefore(el.firstChild,el); p.removeChild(el); p.normalize(); }); 
    document.querySelectorAll('.note').forEach(el=>{ const p=el.parentNode; while(el.firstChild)p.insertBefore(el.firstChild,el); p.removeChild(el); p.normalize(); }); 
    document.querySelectorAll('.flag-btn').forEach(b => b.classList.remove('active'));
    localStorage.removeItem(`${PAPER_ID}_highlights`);
    localStorage.removeItem(`${PAPER_ID}_flags`);
  } 
  closeModal('resetModal'); 
}

function addWrongToBook(){ const wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); const wr=lastResults.filter(r=>!r.isCorrect); wr.forEach(r=>{ const en={paperId:PAPER_ID,title:'Corporate Social Responsibility',questionId:r.id,correctAnswer:r.correctAns,myAnswer:r.userAns,date:new Date().toISOString().split('T')[0]}; const ix=wb.findIndex(i=>i.paperId===en.paperId&&i.questionId===en.questionId); if(ix>=0)wb[ix]=en; else wb.push(en); }); localStorage.setItem('ielts_wrong_book',JSON.stringify(wb)); alert(`Â∑≤Ê∑ªÂä† ${wr.length} ÈÅìÈîôÈ¢ò`); closeModal('resultModal'); }

function deleteWrongItem(pId,qId){ if(!confirm('Á°ÆÂÆöÂà†Èô§ËøôÈÅìÈîôÈ¢òÔºü'))return; let wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); wb=wb.filter(i=>!(i.paperId===pId&&i.questionId===qId)); localStorage.setItem('ielts_wrong_book',JSON.stringify(wb)); openWrongBook(); }

function clearCurrentWrongBook(){ if(!confirm('Á°ÆÂÆöÊ∏ÖÁ©∫Êú¨ÁØáÊâÄÊúâÈîôÈ¢òÔºü'))return; let wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); wb=wb.filter(i=>i.paperId!==PAPER_ID); localStorage.setItem('ielts_wrong_book',JSON.stringify(wb)); openWrongBook(); }

function openWrongBook(){ const wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); const cu=wb.filter(i=>i.paperId===PAPER_ID); const ct=document.getElementById('wrongBookContent'); if(cu.length===0)ct.innerHTML='<div style="text-align:center;padding:40px;color:#666;">ÊöÇÊó†ÈîôÈ¢ò</div>'; else ct.innerHTML=`<div class="modal-actions"><button class="btn-danger" onclick="clearCurrentWrongBook()" style="width:100%;">üóëÔ∏è Ê∏ÖÁ©∫Êú¨ÁØáÈîôÈ¢ò</button></div>${cu.map(i=>`<div class="wrong-item"><div class="wrong-item-content"><div style="font-weight:600;margin-bottom:8px;">${i.questionId}</div><div style="font-size:13px;color:#666;"><div>‚úì Ê≠£Á°Æ: ${i.correctAnswer}</div><div style="color:#d32f2f;">‚úó ÊàëÁöÑ: ${i.myAnswer}</div></div></div><button class="btn-delete" onclick="deleteWrongItem('${i.paperId}','${i.questionId}')">Âà†Èô§</button></div>`).join('')}`; document.getElementById('wrongBookModal').classList.add('active'); }

function closeModal(id){ document.getElementById(id).classList.remove('active'); }
</script>
</body>
</html>