<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>P2 ‚Äì The economic effect of climate change</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
      }
      #timer {
        position: fixed;
        top: 12px;
        right: 12px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 16px;
        font-weight: 600;
        color: #0066cc;
        z-index: 1000;
      }
      .shell {
        display: flex;
        height: 100vh;
        width: 100%;
      }
      .pane {
        background: #fff;
        overflow: auto;
        padding: 24px;
      }
      #left {
        flex: 0 0 50%;
        border-right: 1px solid #ddd;
      }
      #right {
        flex: 1 1 auto;
        background: #fafafa;
      }
      #divider {
        flex: 0 0 5px;
        background: #ddd;
        cursor: ew-resize;
      }
      #divider:hover {
        background: #999;
      }
      h2,
      h3,
      h4 {
        margin: 0 0 12px;
        color: #333;
      }
      h2 {
        font-size: 20px;
      }
      h3 {
        font-size: 18px;
        color: #0066cc;
      }
      h4 {
        font-size: 15px;
        font-weight: 600;
        margin-top: 20px;
      }
      #left p {
        margin: 0 0 14px;
        line-height: 1.7;
        text-align: justify;
      }
      .group {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .group h4 {
        margin-top: 0;
        color: #0066cc;
      }
      .group p {
        margin: 8px 0;
        font-size: 14px;
        line-height: 1.6;
      }
      .flag-btn {
        position: absolute;
        left: 2px;
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ddd;
        cursor: pointer;
        z-index: 10;
      }
      .flag-btn:hover {
        background: #999;
      }
      .flag-btn.active {
        background: #ff5722;
      }
      .group ol {
        margin-left: 20px;
      }
      .group ol li {
        margin: 12px 0;
        font-size: 14px;
        line-height: 1.6;
        position: relative;
      }
      .group ol li label {
        display: inline-block;
        margin-right: 8px;
      }
      input[type="text"] {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 14px;
        width: 160px;
        background: #fdfdfd;
      }
      input[type="text"]:focus {
        border-color: #0066cc;
        outline: none;
        background: #fff;
      }
      .bottom-bar {
        display: flex;
        gap: 10px;
        margin-top: 16px;
      }
      button {
        padding: 10px 20px;
        border: 1px solid #999;
        border-radius: 6px;
        background: #fff;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #f0f0f0;
      }
      .btn-primary {
        background: #0066cc;
        color: #fff;
        border-color: #0066cc;
      }
      .btn-primary:hover {
        background: #0052a3;
      }
      .btn-danger {
        background: #dc3545;
        color: #fff;
        border-color: #dc3545;
      }
      .btn-danger:hover {
        background: #c82333;
      }
      .hl {
        background: #fff59d;
        cursor: pointer;
      }
      .hl:hover {
        background: #ffeb3b;
      }
      .note {
        background: #b3d9ff;
        cursor: pointer;
      }
      .note:hover {
        background: #99ccff;
      }
      #selbar {
        position: fixed;
        display: none;
        z-index: 2000;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 8px;
        gap: 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        flex-direction: column;
        min-width: 120px;
      }
      #selbar button {
        background: #fff;
        color: #666;
        border: none;
        padding: 3px 0px;
        cursor: pointer;
        font-size: 14px;
        text-align: center;
        border-radius: 4px;
      }
      #selbar button:hover {
        background: #f5f5f5;
        color: #333;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 3000;
        align-items: center;
        justify-content: center;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: #fff;
        border-radius: 8px;
        padding: 24px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }
      .modal-header h2 {
        font-size: 28px;
        color: #333;
        margin: 0;
      }
      .modal-close {
        font-size: 32px;
        cursor: pointer;
        color: #999;
        line-height: 1;
      }
      .modal-close:hover {
        color: #333;
      }
      .result-summary {
        text-align: center;
        padding: 20px;
        background: #f0f0f0;
        margin-bottom: 16px;
        border-radius: 6px;
      }
      .result-score {
        font-size: 36px;
        font-weight: 600;
        color: #0066cc;
      }
      .result-item {
        padding: 10px;
        margin: 8px 0;
        border-left: 3px solid #ddd;
        background: #f9f9f9;
        font-size: 13px;
      }
      .result-item.correct {
        border-left-color: #28a745;
        background: #e8f5e9;
      }
      .result-item.incorrect {
        border-left-color: #dc3545;
        background: #ffebee;
      }
      .wrong-item {
        background: #fff3e0;
        padding: 16px;
        margin: 8px 0;
        border-radius: 8px;
        border-left: 4px solid #ff9800;
        display: flex;
        justify-content: space-between;
        align-items: start;
      }
      .wrong-item-content {
        flex: 1;
      }
      .btn-delete {
        background: #dc3545;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        margin-left: 12px;
      }
      .btn-delete:hover {
        background: #c82333;
      }
      .modal-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      .headings-box {
        background: #f9f9f9;
        padding: 12px;
        border: 1px solid #eee;
        border-radius: 4px;
        margin-bottom: 12px;
      }
      .headings-box h5 {
        margin: 0 0 8px;
        font-size: 14px;
        color: #333;
      }
      .headings-box ol {
        margin-left: 20px;
        font-size: 13px;
        line-height: 1.4;
      }
    </style>
  </head>
  <body>
    <div id="timer">00:00</div>
    <div class="shell">
      <section class="pane" id="left">
        <h2>READING PASSAGE 2</h2>
        <p>
          You should spend about 20 minutes on Questions 14‚Äì26, which are based
          on Reading Passage 2 below.
        </p>
        <h3>The economic effect of climate</h3>
        <h4>Latitude is crucial to a nation‚Äôs strength, says Anjana Ahuja</h4>
        <p>
          <strong>A</strong> Dr William Masters was reading a book about
          mosquitoes when an idea struck him. ‚ÄòThere was this anecdote about the
          yellow fever epidemic that hit Philadelphia in 1793,‚Äô Masters recalls.
          ‚ÄòThis epidemic decimated the city until the first frost came.‚Äô The
          sub-zero temperatures froze out the insects, allowing Philadelphia to
          recover. If weather could be the key to a city‚Äôs fortunes, Masters
          thought, then why not to the historical fortunes of nations? And could
          frost lie at the heart of one of the most enduring economic mysteries
          of all ‚Äì why are almost all the wealthy, industrialised nations to be
          found where the climate is cooler?
        </p>
        <p>
          <strong>B</strong> After two years of research, he thinks that he has
          found a piece of the puzzle. Masters, an agricultural economist from
          Purdue University in Indiana, and Margaret McMillan at Tufts
          University, Boston, show that annual frosts are among the factors that
          distinguish rich nations from poor ones. Their study is published this
          month in the Journal of Economic Growth. The pair speculate that cold
          snaps have two main benefits ‚Äì they freeze pests that would otherwise
          destroy crops, and also freeze organisms, such as those carried by
          mosquitoes, that carry disease. The result is agricultural abundance
          and a big workforce.
        </p>
        <p>
          <strong>C</strong> The academics took two sets of information. The
          first was average income for countries, the second was climate data
          provided by the University of East Anglia. They found a curious tally
          between the sets. Countries having five or more frosty days in the
          winter months are uniformly rich; those with fewer than five are
          impoverished. The authors speculate that the five-day figure is
          important: it could be the minimum time needed to kill pests in the
          soil. To illustrate this, Masters notes: ‚ÄòFinland is a small country
          that is growing quickly, but Bolivia is a small country that isn‚Äôt
          growing at all. Perhaps climate has something to do with that.‚Äô
        </p>
        <p>
          <strong>D</strong> Other minds have applied themselves to the split
          between poor and rich nations, citing anthropological, climatic and
          zoological reasons for why temperate nations are the most affluent.
          Jared Diamond, from the University of California at Los Angeles,
          pointed out in his book Guns, Germs and Steel that Eurasia is broadly
          aligned east-west, while Africa and the Americas are aligned
          north-south. So in Europe crops could move quickly across latitudes
          because climates are similar. One of the first domesticated crops,
          einkorn wheat, extended quickly from the Middle East into Europe; it
          took twice as long for it to get from Mexico to what is now the
          eastern United States. This easy movement along similar latitudes in
          Eurasia would also have meant a faster dissemination of other
          technologies, such as the wheel and writing, Diamond speculates.
        </p>
        <p>
          <strong>E</strong> There are exceptions to the ‚Äòcold equals rich‚Äô
          argument. There are well-heeled tropical countries such as Singapore,
          a result of its superior trading position. Likewise, not all European
          countries are moneyed. Masters stresses that climate will never be the
          overriding factor ‚Äì the wealth of nations is too complicated to be
          attributable to just one factor. Climate, he feels, somehow combines
          with other factors ‚Äì such as the presence of institutions, including
          governments, and access to trading routes ‚Äì to determine whether a
          country will do well.
        </p>
        <p>
          <strong>F</strong> In the past, Masters says, economists thought that
          institutions had the biggest effect on the economy, because they
          brought order to a country in the form of, for example, laws and
          property rights. With order, so the thinking went, came affluence.
          ‚ÄòBut there are some problems that even countries with institutions
          have not been able to get around,‚Äô he says. ‚ÄòMy feeling is that, as
          countries get richer, they get better institutions. And the
          accumulation of wealth and improvement in governing institutions are
          both helped by a favourable environment, including climate.‚Äô
        </p>
        <p>
          <strong>G</strong> This does not mean, he insists, that tropical
          countries are beyond economic help and destined to remain penniless.
          Instead of aid being geared towards improving administrative systems,
          it should be spent on technology to improve agriculture and to combat
          disease. Masters cites one example: ‚ÄòThere are regions in India that
          have been provided with irrigation ‚Äì agricultural productivity has
          gone up and there has been an improvement in health.‚Äô Supplying
          vaccines against tropical diseases and developing crop varieties that
          can grow in the tropics would break the poverty cycle.
        </p>
      </section>
      <div id="divider"></div>
      <section class="pane" id="right">
        <h3>Questions</h3>
        <div class="group">
          <h4>Questions 14‚Äì20</h4>
          <p>Reading Passage 2 has seven paragraphs, A‚ÄìG.</p>
          <p>
            Choose the correct heading for each paragraph from the list of
            headings below.
          </p>
          <div class="headings-box">
            <h5>List of Headings</h5>
            <ol type="i">
              <li>
                Levels of wealth affected by several other influences besides
                climate
              </li>
              <li>The failure of vaccination programmes</li>
              <li>The problems experienced by small countries</li>
              <li>The role of governments in creating wealth</li>
              <li>The best use of financial assistance</li>
              <li>The inspiration for Masters‚Äôs research</li>
              <li>The advantages of cold weather to people and agriculture</li>
              <li>Positive correlations between climate and economy</li>
              <li>Reflecting on the traditional view</li>
              <li>Crop spread in Europe and other continents</li>
            </ol>
          </div>
          <ol start="14">
            <li>
              <span class="flag-btn" data-q="q14" style="left: -20px"></span
              >Paragraph A<br />
              <label><input type="radio" name="q14" value="i" /> i</label>
              <label><input type="radio" name="q14" value="ii" /> ii</label>
              <label><input type="radio" name="q14" value="iii" /> iii</label>
              <label><input type="radio" name="q14" value="iv" /> iv</label>
              <label><input type="radio" name="q14" value="v" /> v</label>
              <label><input type="radio" name="q14" value="vi" /> vi</label>
              <label><input type="radio" name="q14" value="vii" /> vii</label>
              <label><input type="radio" name="q14" value="viii" /> viii</label>
              <label><input type="radio" name="q14" value="ix" /> ix</label>
              <label><input type="radio" name="q14" value="x" /> x</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q15" style="left: -20px"></span
              >Paragraph B<br />
              <label><input type="radio" name="q15" value="i" /> i</label>
              <label><input type="radio" name="q15" value="ii" /> ii</label>
              <label><input type="radio" name="q15" value="iii" /> iii</label>
              <label><input type="radio" name="q15" value="iv" /> iv</label>
              <label><input type="radio" name="q15" value="v" /> v</label>
              <label><input type="radio" name="q15" value="vi" /> vi</label>
              <label><input type="radio" name="q15" value="vii" /> vii</label>
              <label><input type="radio" name="q15" value="viii" /> viii</label>
              <label><input type="radio" name="q15" value="ix" /> ix</label>
              <label><input type="radio" name="q15" value="x" /> x</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q16" style="left: -20px"></span
              >Paragraph C<br />
              <label><input type="radio" name="q16" value="i" /> i</label>
              <label><input type="radio" name="q16" value="ii" /> ii</label>
              <label><input type="radio" name="q16" value="iii" /> iii</label>
              <label><input type="radio" name="q16" value="iv" /> iv</label>
              <label><input type="radio" name="q16" value="v" /> v</label>
              <label><input type="radio" name="q16" value="vi" /> vi</label>
              <label><input type="radio" name="q16" value="vii" /> vii</label>
              <label><input type="radio" name="q16" value="viii" /> viii</label>
              <label><input type="radio" name="q16" value="ix" /> ix</label>
              <label><input type="radio" name="q16" value="x" /> x</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q17" style="left: -20px"></span
              >Paragraph D<br />
              <label><input type="radio" name="q17" value="i" /> i</label>
              <label><input type="radio" name="q17" value="ii" /> ii</label>
              <label><input type="radio" name="q17" value="iii" /> iii</label>
              <label><input type="radio" name="q17" value="iv" /> iv</label>
              <label><input type="radio" name="q17" value="v" /> v</label>
              <label><input type="radio" name="q17" value="vi" /> vi</label>
              <label><input type="radio" name="q17" value="vii" /> vii</label>
              <label><input type="radio" name="q17" value="viii" /> viii</label>
              <label><input type="radio" name="q17" value="ix" /> ix</label>
              <label><input type="radio" name="q17" value="x" /> x</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q18" style="left: -20px"></span
              >Paragraph E<br />
              <label><input type="radio" name="q18" value="i" /> i</label>
              <label><input type="radio" name="q18" value="ii" /> ii</label>
              <label><input type="radio" name="q18" value="iii" /> iii</label>
              <label><input type="radio" name="q18" value="iv" /> iv</label>
              <label><input type="radio" name="q18" value="v" /> v</label>
              <label><input type="radio" name="q18" value="vi" /> vi</label>
              <label><input type="radio" name="q18" value="vii" /> vii</label>
              <label><input type="radio" name="q18" value="viii" /> viii</label>
              <label><input type="radio" name="q18" value="ix" /> ix</label>
              <label><input type="radio" name="q18" value="x" /> x</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q19" style="left: -20px"></span
              >Paragraph F<br />
              <label><input type="radio" name="q19" value="i" /> i</label>
              <label><input type="radio" name="q19" value="ii" /> ii</label>
              <label><input type="radio" name="q19" value="iii" /> iii</label>
              <label><input type="radio" name="q19" value="iv" /> iv</label>
              <label><input type="radio" name="q19" value="v" /> v</label>
              <label><input type="radio" name="q19" value="vi" /> vi</label>
              <label><input type="radio" name="q19" value="vii" /> vii</label>
              <label><input type="radio" name="q19" value="viii" /> viii</label>
              <label><input type="radio" name="q19" value="ix" /> ix</label>
              <label><input type="radio" name="q19" value="x" /> x</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q20" style="left: -20px"></span
              >Paragraph G<br />
              <label><input type="radio" name="q20" value="i" /> i</label>
              <label><input type="radio" name="q20" value="ii" /> ii</label>
              <label><input type="radio" name="q20" value="iii" /> iii</label>
              <label><input type="radio" name="q20" value="iv" /> iv</label>
              <label><input type="radio" name="q20" value="v" /> v</label>
              <label><input type="radio" name="q20" value="vi" /> vi</label>
              <label><input type="radio" name="q20" value="vii" /> vii</label>
              <label><input type="radio" name="q20" value="viii" /> viii</label>
              <label><input type="radio" name="q20" value="ix" /> ix</label>
              <label><input type="radio" name="q20" value="x" /> x</label>
            </li>
          </ol>
        </div>
        <div class="group">
          <h4>Questions 21‚Äì26</h4>
          <p>
            Complete the sentences below. Choose
            <strong>NO MORE THAN THREE WORDS</strong> from the passage for each
            answer.
          </p>
          <ol start="21">
            <li>
              <span class="flag-btn" data-q="q21" style="left: -20px"></span
              >Philadelphia recovered from its
              <input type="text" name="q21" /> when the temperature dropped
              dramatically.
            </li>
            <li>
              <span class="flag-btn" data-q="q22" style="left: -20px"></span
              ><input type="text" name="q22" /> is an example of a small country
              whose economy is expanding.
            </li>
            <li>
              <span class="flag-btn" data-q="q23" style="left: -20px"></span
              ><input type="text" name="q23" /> spread more slowly from Mexico
              than it did from the Middle East.
            </li>
            <li>
              <span class="flag-btn" data-q="q24" style="left: -20px"></span
              >Technology spread more quickly in
              <input type="text" name="q24" /> than in Africa.
            </li>
            <li>
              <span class="flag-btn" data-q="q25" style="left: -20px"></span
              ><input type="text" name="q25" /> is economically rich in spite of
              its tropical climate.
            </li>
            <li>
              <span class="flag-btn" data-q="q26" style="left: -20px"></span>Aid
              should be used to improve agriculture rather than to improve
              <input type="text" name="q26" />.
            </li>
          </ol>
        </div>
        <div class="bottom-bar">
          <button class="btn-primary" onclick="submitAnswers()">Êèê‰∫§</button>
          <button onclick="resetForm()">ÈáçÁΩÆ</button>
          <button onclick="openWrongBook()">Êú¨ÁØáÈîôÈ¢ò</button>
        </div>
      </section>
    </div>
    <div id="selbar">
      <button id="btnNote">Note</button>
      <button id="btnHL">Highlight</button>
      <button id="btnUH" style="display: none">Clear Highlight</button>
    </div>
    <div class="modal" id="resultModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÊàêÁª©</h2>
          <span class="modal-close" onclick="closeModal('resultModal')">√ó</span>
        </div>
        <div id="resultContent"></div>
        <button
          class="btn-primary"
          style="width: 100%; margin-top: 16px"
          onclick="addWrongToBook()"
        >
          Âä†ÂÖ•ÈîôÈ¢òÊú¨
        </button>
      </div>
    </div>
    <div class="modal" id="wrongBookModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Êú¨ÁØáÈîôÈ¢ò</h2>
          <span class="modal-close" onclick="closeModal('wrongBookModal')"
            >√ó</span
          >
        </div>
        <div id="wrongBookContent"></div>
      </div>
    </div>
    <div class="modal" id="resetModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÈáçÁΩÆÁªÉ‰π†</h2>
          <span class="modal-close" onclick="closeModal('resetModal')">√ó</span>
        </div>
        <div style="margin: 16px 0">
          <label style="display: block; margin-bottom: 10px"
            ><input type="radio" name="resetType" value="answers" checked />
            Âè™Ê∏ÖÁ©∫Á≠îÊ°à</label
          >
          <label style="display: block"
            ><input type="radio" name="resetType" value="all" />
            Ê∏ÖÁ©∫Á≠îÊ°àÂíåÊ†áËÆ∞</label
          >
        </div>
        <button
          class="btn-primary"
          style="width: 100%"
          onclick="confirmReset()"
        >
          Á°ÆÂÆö
        </button>
      </div>
    </div>
    <script>
      const PAPER_ID = "P2_CLIMATE_ECONOMY";
      let t = 0;
      const timerEl = document.getElementById("timer");
      setInterval(() => {
        t++;
        timerEl.textContent =
          String(Math.floor(t / 60)).padStart(2, "0") +
          ":" +
          String(t % 60).padStart(2, "0");
      }, 1000);
      const divider = document.getElementById("divider"),
        left = document.getElementById("left"),
        right = document.getElementById("right");
      let dragging = false;
      divider.onmousedown = () => {
        dragging = true;
        document.body.style.cursor = "ew-resize";
      };
      window.onmousemove = (e) => {
        if (!dragging) return;
        const c = document.querySelector(".shell").getBoundingClientRect();
        let x = e.clientX - c.left;
        x = Math.max(280, Math.min(c.width - 280, x));
        left.style.flex = "0 0 " + x + "px";
        right.style.flex = "1 1 auto";
      };
      window.onmouseup = () => {
        dragging = false;
        document.body.style.cursor = "";
      };
      const selbar = document.getElementById("selbar"),
        btnHL = document.getElementById("btnHL"),
        btnUH = document.getElementById("btnUH"),
        btnNote = document.getElementById("btnNote");
      let lastRange = null,
        currentHlNode = null;
      function posSelbar(r) {
        selbar.style.display = "flex";
        const t = window.scrollY + r.top - selbar.offsetHeight - 8;
        const l =
          window.scrollX + r.left + r.width / 2 - selbar.offsetWidth / 2;
        selbar.style.top = (t > 0 ? t : window.scrollY + r.bottom + 8) + "px";
        selbar.style.left = Math.max(8, l) + "px";
      }
      function updSel() {
        const s = window.getSelection();
        if (!s || s.rangeCount === 0 || s.isCollapsed) {
          if (!currentHlNode) selbar.style.display = "none";
          return;
        }
        const r = s.getRangeAt(0);
        lastRange = r.cloneRange();
        currentHlNode = null;
        btnNote.style.display = "block";
        btnHL.style.display = "block";
        btnUH.style.display = "none";
        posSelbar(r.getBoundingClientRect());
      }
      left.onmouseup = updSel;
      right.onmouseup = updSel;
      document.onselectionchange = () => {
        const s = window.getSelection();
        if ((!s || s.rangeCount === 0 || s.isCollapsed) && !currentHlNode)
          selbar.style.display = "none";
      };
      document.addEventListener(
        "click",
        (e) => {
          if (
            e.target.classList &&
            (e.target.classList.contains("hl") ||
              e.target.classList.contains("note"))
          ) {
            currentHlNode = e.target;
            lastRange = null;
            btnNote.style.display = "none";
            btnHL.style.display = "none";
            btnUH.style.display = "block";
            posSelbar(e.target.getBoundingClientRect());
            const s = window.getSelection();
            if (s) s.removeAllRanges();
          }
        },
        true
      );
      btnHL.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "hl";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "hl";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnNote.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "note";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "note";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnUH.onclick = () => {
        if (currentHlNode) {
          const p = currentHlNode.parentNode;
          while (currentHlNode.firstChild)
            p.insertBefore(currentHlNode.firstChild, currentHlNode);
          p.removeChild(currentHlNode);
          p.normalize();
          currentHlNode = null;
          selbar.style.display = "none";
          saveHighlights();
        } else if (lastRange) {
          const sR = lastRange.getBoundingClientRect();
          const w = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_ELEMENT
          );
          const tr = [];
          while (w.nextNode()) {
            const n = w.currentNode;
            if (
              n.classList &&
              (n.classList.contains("hl") || n.classList.contains("note"))
            ) {
              const r = n.getBoundingClientRect();
              if (
                !(
                  r.right < sR.left ||
                  r.left > sR.right ||
                  r.bottom < sR.top ||
                  r.top > sR.bottom
                )
              )
                tr.push(n);
            }
          }
          tr.forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          selbar.style.display = "none";
          saveHighlights();
        }
      };
      document.querySelectorAll(".flag-btn").forEach((btn) => {
        btn.onclick = (e) => {
          e.stopPropagation();
          btn.classList.toggle("active");
          saveFlags();
        };
      });
      const answerKey = {
        q14: "vi",
        q15: "vii",
        q16: "viii",
        q17: "x",
        q18: "i",
        q19: "ix",
        q20: "v",
        q21: "yellow fever epidemic",
        q22: "Finland",
        q23: "einkorn wheat",
        q24: "Eurasia",
        q25: "Singapore",
        q26: "administrative systems",
      };
      let lastResults = [];
      function saveAnswers() {
        const data = {};
        Object.keys(answerKey).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) data[q] = radio.value;
          else if (text) data[q] = text.value;
        });
        localStorage.setItem(`${PAPER_ID}_answers`, JSON.stringify(data));
      }
      function loadAnswers() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_answers`) || "{}"
        );
        Object.keys(data).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][value="${data[q]}"]`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) radio.checked = true;
          else if (text) text.value = data[q];
        });
      }
      function saveFlags() {
        const flags = [...document.querySelectorAll(".flag-btn.active")].map(
          (b) => b.dataset.q
        );
        localStorage.setItem(`${PAPER_ID}_flags`, JSON.stringify(flags));
      }
      function loadFlags() {
        const flags = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_flags`) || "[]"
        );
        flags.forEach((q) =>
          document.querySelector(`[data-q="${q}"]`)?.classList.add("active")
        );
      }
      function saveHighlights() {
        const highlights = { left: [], right: [] };
        document
          .querySelectorAll("#left .hl, #left .note")
          .forEach((el, idx) => {
            highlights.left.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        document
          .querySelectorAll("#right .hl, #right .note")
          .forEach((el, idx) => {
            highlights.right.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        localStorage.setItem(
          `${PAPER_ID}_highlights`,
          JSON.stringify(highlights)
        );
      }
      function loadHighlights() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_highlights`) ||
            '{"left":[],"right":[]}'
        );
        const restore = (pane, items) => {
          if (!items || items.length === 0) return;
          items.forEach((item) => {
            const walker = document.createTreeWalker(
              pane,
              NodeFilter.SHOW_TEXT
            );
            let node;
            while ((node = walker.nextNode())) {
              if (node.textContent.includes(item.text)) {
                const span = document.createElement("span");
                span.className = item.type;
                const parent = node.parentNode;
                const text = node.textContent;
                const idx = text.indexOf(item.text);
                if (idx >= 0) {
                  const before = text.substring(0, idx);
                  const match = text.substring(idx, idx + item.text.length);
                  const after = text.substring(idx + item.text.length);
                  parent.insertBefore(document.createTextNode(before), node);
                  span.textContent = match;
                  parent.insertBefore(span, node);
                  parent.insertBefore(document.createTextNode(after), node);
                  parent.removeChild(node);
                  break;
                }
              }
            }
          });
        };
        restore(left, data.left);
        restore(right, data.right);
      }
      document.querySelectorAll("input").forEach((inp) => {
        inp.addEventListener("change", saveAnswers);
        if (inp.type === "text") inp.addEventListener("input", saveAnswers);
      });
      document.addEventListener("DOMContentLoaded", () => {
        loadAnswers();
        loadFlags();
        loadHighlights();
      });
      function submitAnswers() {
        const res = [];
        let cor = 0;
        Object.keys(answerKey).forEach((q) => {
          let uA = "";
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) uA = radio.value;
          else if (text) uA = text.value.trim();
          const cA = answerKey[q];
          const iC = uA.toLowerCase() === cA.toLowerCase();
          if (iC) cor++;
          res.push({ id: q, userAns: uA, correctAns: cA, isCorrect: iC });
        });
        lastResults = res;
        const tot = Object.keys(answerKey).length;
        const pct = ((cor / tot) * 100).toFixed(1);
        localStorage.setItem(`ielts_score_${PAPER_ID}`, `${cor}/${tot}`);
        document.getElementById(
          "resultContent"
        ).innerHTML = `<div class="result-summary"><div class="result-score">${cor} / ${tot}</div><div style="margin-top:8px;font-size:18px;">${pct}%</div></div>${res
          .map(
            (r) =>
              `<div class="result-item ${
                r.isCorrect ? "correct" : "incorrect"
              }"><div><strong>${r.id}</strong> ${
                r.isCorrect ? "‚úì" : "‚úó"
              }</div><div>‰Ω†ÁöÑÁ≠îÊ°à: ${r.userAns || "(Êú™‰ΩúÁ≠î)"}</div>${
                !r.isCorrect ? `<div>Ê≠£Á°ÆÁ≠îÊ°à: ${r.correctAns}</div>` : ""
              }</div>`
          )
          .join("")}`;
        document.getElementById("resultModal").classList.add("active");
      }
      function resetForm() {
        document.getElementById("resetModal").classList.add("active");
      }
      function confirmReset() {
        const tp = document.querySelector(
          'input[name="resetType"]:checked'
        ).value;
        document.querySelectorAll("input").forEach((i) => {
          if (i.type === "radio") i.checked = false;
          if (i.type === "text") i.value = "";
        });
        localStorage.removeItem(`${PAPER_ID}_answers`);
        if (tp === "all") {
          document.querySelectorAll(".hl").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document.querySelectorAll(".note").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document
            .querySelectorAll(".flag-btn")
            .forEach((b) => b.classList.remove("active"));
          localStorage.removeItem(`${PAPER_ID}_highlights`);
          localStorage.removeItem(`${PAPER_ID}_flags`);
        }
        closeModal("resetModal");
      }
      function addWrongToBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const wr = lastResults.filter((r) => !r.isCorrect);
        wr.forEach((r) => {
          const en = {
            paperId: PAPER_ID,
            title: "The economic effect of climate change",
            questionId: r.id,
            correctAnswer: r.correctAns,
            myAnswer: r.userAns || "(Êú™‰ΩúÁ≠î)",
            date: new Date().toISOString().split("T")[0],
          };
          const ix = wb.findIndex(
            (i) => i.paperId === en.paperId && i.questionId === en.questionId
          );
          if (ix >= 0) wb[ix] = en;
          else wb.push(en);
        });
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        alert(`Â∑≤Ê∑ªÂä† ${wr.length} ÈÅìÈîôÈ¢ò`);
        closeModal("resultModal");
      }
      function deleteWrongItem(pId, qId) {
        if (!confirm("Á°ÆÂÆöÂà†Èô§ËøôÈÅìÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => !(i.paperId === pId && i.questionId === qId));
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function clearCurrentWrongBook() {
        if (!confirm("Á°ÆÂÆöÊ∏ÖÁ©∫Êú¨ÁØáÊâÄÊúâÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => i.paperId !== PAPER_ID);
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function openWrongBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const cu = wb.filter((i) => i.paperId === PAPER_ID);
        const ct = document.getElementById("wrongBookContent");
        if (cu.length === 0)
          ct.innerHTML =
            '<div style="text-align:center;padding:40px;color:#666;">ÊöÇÊó†ÈîôÈ¢ò</div>';
        else
          ct.innerHTML = `<div class="modal-actions"><button class="btn-danger" onclick="clearCurrentWrongBook()" stylewidth:100%;">üóëÔ∏è Ê∏ÖÁ©∫Êú¨ÁØáÈîôÈ¢ò</button></div>${cu
            .map(
              (i) =>
                `<div class="wrong-item"><div class="wrong-item-content"><div style="font-weight:600;margin-bottom:8px;">${i.questionId}</div><div style="font-size:13px;color:#666;"><div>‚úì Ê≠£Á°Æ: ${i.correctAnswer}</div><div style="color:#d32f2f;">‚úó ÊàëÁöÑ: ${i.myAnswer}</div></div></div><button class="btn-delete" onclick="deleteWrongItem('${i.paperId}','${i.questionId}')">Âà†Èô§</button></div>`
            )
            .join("")}`;
        document.getElementById("wrongBookModal").classList.add("active");
      }
      function closeModal(id) {
        document.getElementById(id).classList.remove("active");
      }
    </script>
  </body>
</html>
