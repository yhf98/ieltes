<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reading Passage 2 ‚Äì Early Approaches to Organisational Design</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
 * { box-sizing: border-box; margin:0; padding:0; }
 html,body { height:100%; }
 body { font-family: Arial, sans-serif; background:#f5f5f5; }
 
 #timer { position:fixed; top:12px; right:12px; background:#fff; border:1px solid #ddd; border-radius:6px; padding:8px 12px; font-size:16px; font-weight:600; color:#0066cc; z-index:1000; }
 
 .shell { display:flex; height:100vh; width:100%; }
 .pane { background:#fff; overflow:auto; padding:24px; }
 #left { flex: 0 0 50%; border-right:1px solid #ddd; }
 #right { flex: 1 1 auto; background:#fafafa; }
 #divider { flex: 0 0 5px; background:#ddd; cursor: ew-resize; }
 #divider:hover { background:#999; }
 
 h2,h3,h4 { margin:0 0 12px; color:#333; }
 h2 { font-size:20px; }
 h3 { font-size:18px; color:#0066cc; }
 h4 { font-size:15px; font-weight:600; margin-top:20px; }
 
 #left p { margin: 0 0 14px; line-height: 1.7; text-align:justify; }
 
 .group { background:#fff; border:1px solid #ddd; border-radius:6px; padding:16px; margin-bottom:16px; }
 .group h4 { margin-top:0; color:#0066cc; }
 .group p { margin:8px 0; font-size:14px; line-height:1.6; }
 
 .group ol { margin-left:20px; }
 .group ol li { margin:12px 0; font-size:14px; line-height:1.6; position:relative; }
 .group ol li label { display:inline-block; margin-right:8px; }
 
 .bottom-bar { display:flex; gap:10px; margin-top:16px; }
 button { padding:10px 20px; border:1px solid #999; border-radius:6px; background:#fff; cursor:pointer; font-size:14px; }
 button:hover { background:#f0f0f0; }
 .btn-primary { background:#0066cc; color:#fff; border-color:#0066cc; }
 .btn-primary:hover { background:#0052a3; }
 .btn-danger { background:#dc3545; color:#fff; border-color:#dc3545; }
 .btn-danger:hover { background:#c82333; }
 
 .hl { background:#fff59d; cursor:pointer; }
 .hl:hover { background:#ffeb3b; }
 .note { background:#b3d9ff; cursor:pointer; }
 .note:hover { background:#99ccff; }
 
 #selbar { position:fixed; display:none; z-index:2000; background:#fff; border:1px solid #ddd; border-radius:8px; padding:8px; gap:0; box-shadow:0 2px 8px rgba(0,0,0,0.15); flex-direction:column; min-width:120px; }
 #selbar button { background:#fff; color:#666; border:none; padding:3px 0px; cursor:pointer; font-size:14px; text-align:center; border-radius:4px; }
 #selbar button:hover { background:#f5f5f5; color:#333; }
 
 .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:3000; align-items:center; justify-content:center; }
 .modal.active { display:flex; }
 .modal-content { background:#fff; border-radius:8px; padding:24px; max-width:600px; width:90%; max-height:80vh; overflow-y:auto; }
 
 .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
 .modal-header h2 { font-size: 28px; color: #333; margin: 0; }
 .modal-close { font-size: 32px; cursor: pointer; color: #999; line-height: 1; }
 .modal-close:hover { color: #333; }
 
 .result-summary { text-align:center; padding:20px; background:#f0f0f0; margin-bottom:16px; border-radius:6px; }
 .result-score { font-size:36px; font-weight:600; color:#0066cc; }
 .result-item { padding:10px; margin:8px 0; border-left:3px solid #ddd; background:#f9f9f9; font-size:13px; }
 .result-item.correct { border-left-color:#28a745; background:#e8f5e9; }
 .result-item.incorrect { border-left-color:#dc3545; background:#ffebee; }
 
 .wrong-item { background:#fff3e0; padding:16px; margin:8px 0; border-radius:8px; border-left:4px solid #ff9800; display:flex; justify-content:space-between; align-items:start; }
 .wrong-item-content { flex:1; }
 .btn-delete { background:#dc3545; color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:13px; margin-left:12px; }
 .btn-delete:hover { background:#c82333; }
 .modal-actions { display:flex; gap:10px; margin-bottom:20px; }
 
 .flag-btn { 
   position:absolute; 
   left:-20px; 
   top:50%;
   transform:translateY(-50%);
   width:8px;
   height:8px;
   border-radius:50%;
   background:#ddd;
   cursor:pointer;
   z-index:10;
 }
 .flag-btn:hover { background:#999; }
 .flag-btn.active { background:#ff5722; }
 
 .select-box { display:inline-block; padding:4px 8px; border:1px solid #999; border-radius:4px; min-width:60px; background:#fff; margin:0 4px; cursor:pointer; }
 .select-box:hover { background:#f0f0f0; }
</style>
</head>
<body>
<div id="timer">00:00</div>

<div class="shell">
 <section class="pane" id="left">
   
<h2>READING PASSAGE 2</h2>
<p>You should spend about 20 minutes on Questions 14-26, which are based on Reading Passage 2 below.</p>
<h3>Early Approaches to Organisational Design</h3>
<p style="font-style:italic;">A review of the classical and neoclassical theories of organisational structures</p>

<p>Determining the 'best' type of organisational structure for a particular situation has long been an important task for managers in all types of organisations. All structures have advantages and disadvantages and managers face the challenge of developing the most appropriate design for changing circumstances.</p>

<h4>The Classical Approach</h4>
<p>Early management writers attempted to approach organisational design using a set of principles that would make an organisational structure perform efficiently in most situations, independent of external conditions and internal objectives. The sociologist Max Weber and management writers Frederick Taylor and Henri Fayol were major contributors to this so-called classical approach. They believed that the most efficient organisations had a legalised, formal and hierarchical structure called a 'bureaucracy'. Members of the organisation were guided by a sense of duty to the organisation and by a set of rational rules and regulations. According to Weber, such organisations were characterised by the specialisation of tasks, appointment by merit, and an impersonal climate.</p>

<p>Today the word 'bureaucracy' sometimes has negative connotations. Early management writers, however, commended bureaucracy as an organisational design for its rationality, rules for decision-making, clear chain of command, and promotion of people based on ability and experience, rather than favouritism or whim. Weber also believed that clearly specified authority and responsibility made performance easier to evaluate and reward.</p>

<h4>Criticism of the Classical Approach</h4>
<p>Weber, Taylor and Fayol developed their theories when organisations that resembled this bureaucratic model were modern and efficient. It became evident, however, that some of the major advantages of the bureaucratic structure could become disadvantages if the theory were applied dogmatically. For example, the safeguards against favouritism could be rigidly imposed by adhering excessively to rules, resulting in both managers and subordinates becoming depersonalised.</p>

<p>The classical approach has been criticised from two major perspectives. First, the theory may not have a basis in reality. Have organisations like those described by Weber and the others ever existed? Second, it claims that organisations designed and managed according to bureaucratic principles will enjoy the predicted benefits. But critics argue that the world no longer fits the assumptions in Weber's model (if it ever did), and so a bureaucracy might not yield beneficial results.</p>

<p>Early human relations researchers and behavioural scientists attempted to deal with the major inadequacy of the classical bureaucratic model: neglect of the human element. They argued that an industrial organisation has two objectives: economic effectiveness and employee satisfaction. They also wrote that the bureaucratic structure could be improved by permitting more subordinate participation in decision-making. Because these researchers tried to improve, and not reject, the classical model, they are sometimes called neoclassical theorists and include Douglas McGregor, Chris Argyris and Rensis Likert.</p>

<h4>The Neoclassical Approach</h4>
<p>McGregor believed that the vertical division of labour that characterised bureaucratic organisations was derived from negative and false assumptions about workers which he called Theory X. Managers assume lower-level employees lack ambition and need orders to work effectively. The rigid formal hierarchy is designed to maintain managers' power over subordinates. Decision-making takes place at upper levels of management while the decisions are carried out by people at lower levels. McGregor argued that organisations based instead on Theory Y assumptions use their members' potential. Theory Y assumes that most people find work satisfying, commit themselves willingly to organisational goals and seek responsibility. Members have more independence than in bureaucratic organisations and lower-level participation in decision-making is encouraged.</p>

<p>Argyris was concerned that managers in bureaucratic organisations had near-total responsibility for controlling their subordinates' work. He argued that managerial domination makes subordinates passive and dependent, and decreases their sense of responsibility and self-control. Argyris argued for an alternative organisational design that acknowledged human needs and feelings, and increased workers' satisfaction. Like McGregor, he favoured giving subordinates more independence and decision-making power to create a more informal organisational culture.</p>

<p>Likert shared the perspectives of McGregor and Argyris. In his research, he found that managers who encouraged their subordinates could motivate them more than traditional authoritarian managers. Likert based his model of four possible systems on these findings. In System 1, power and authority are distributed strictly according to the classical management subordinate relationship: a manager gives orders to lower-level members. In System 4 organisations, by contrast, there is extensive participation in decision-making and problem-solving groups. Some individuals in each group also belong to other work groups to ensure communication between them. System 4 represents Likert's view of an ideal organisation.</p>

<h4>Criticisms of the Neoclassical Approach</h4>
<p>The neoclassical approach to organisational design compensates for limitations in the traditional classical model, but it has also been criticised. First, the neoclassicists share the classical assumption that there is one best way to design an organisation. They overlook environmental, technological, and other variables that might affect an organisation's design, and overemphasise psychological and behavioural variables. Second, Theories X and Y oversimplify human motivation and neglect individual differences. Not everyone is motivated by the non-monetary aspects of work, nor is all work satisfying. Finally, the coordination of work groups to achieve organisational goals may be more difficult than the neoclassicists suggest, particularly when the objectives of lower-level employees are not consistent with those of upper-level managers.</p>

 </section>

 <div id="divider" title="Drag to resize"></div>

 <section class="pane" id="right">
   <h3>Questions</h3>

   <div class="group">
     <h4>Questions 14 and 15</h4>
     <p>Choose <strong>TWO</strong> letters, <strong>A‚ÄìE</strong>.</p>
     <p>Write the correct letters in boxes <strong>14 and 15</strong> on your answer sheet.</p>
     <p><strong>According to the writer, which TWO of the following are characteristics of the classical approach to organisational design?</strong></p>

     <div style="margin:16px 0;">
       <div style="margin:8px 0;"><label><input type="checkbox" name="q14" value="A"> <strong>A</strong> a marked ranking order for employees</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q14" value="B"> <strong>B</strong> giving importance to everyone's work</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q14" value="C"> <strong>C</strong> the advancement of older workers</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q14" value="D"> <strong>D</strong> a neutral working environment</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q14" value="E"> <strong>E</strong> increased benefits for workers</label></div>
     </div>
     <span class="flag-btn" data-q="q14" style="position:absolute; right:16px; top:16px;"></span>
   </div>

   <div class="group">
     <h4>Questions 16 and 17</h4>
     <p>Choose <strong>TWO</strong> letters, <strong>A‚ÄìE</strong>.</p>
     <p>Write the correct letters in boxes <strong>16 and 17</strong> on your answer sheet.</p>
     <p><strong>According to the writer, which TWO of the following are criticisms of the classical approach to organisational design?</strong></p>

     <div style="margin:16px 0;">
       <div style="margin:8px 0;"><label><input type="checkbox" name="q16" value="A"> <strong>A</strong> Too many guidelines are proposed</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q16" value="B"> <strong>B</strong> Certain practices become negative if they are implemented too strictly</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q16" value="C"> <strong>C</strong> Managers and workers are unable to co-operate with each other</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q16" value="D"> <strong>D</strong> The administrative standards are unsuited to some work environments</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q16" value="E"> <strong>E</strong> Positive outcomes which were expected in the past would be unlikely today</label></div>
     </div>
     <span class="flag-btn" data-q="q16" style="position:absolute; right:16px; top:16px;"></span>
   </div>

   <div class="group">
     <h4>Questions 18 and 19</h4>
     <p>Choose <strong>TWO</strong> letters, <strong>A‚ÄìE</strong>.</p>
     <p>Write the correct letters in boxes <strong>18 and 19</strong> on your answer sheet.</p>
     <p><strong>According to the writer, which TWO of the following are aims of the neoclassical approach to organisational design?</strong></p>

     <div style="margin:16px 0;">
       <div style="margin:8px 0;"><label><input type="checkbox" name="q18" value="A"> <strong>A</strong> to ensure workers are treated as individual people</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q18" value="B"> <strong>B</strong> to create a formal atmosphere in the workplace</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q18" value="C"> <strong>C</strong> to change the methods of production</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q18" value="D"> <strong>D</strong> to allow workers a greater say in what happens at the workplace</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q18" value="E"> <strong>E</strong> to standardise the procedures for promotion of workers</label></div>
     </div>
     <span class="flag-btn" data-q="q18" style="position:absolute; right:16px; top:16px;"></span>
   </div>

   <div class="group">
     <h4>Questions 20 and 21</h4>
     <p>Choose <strong>TWO</strong> letters, <strong>A‚ÄìE</strong>.</p>
     <p>Write the correct letters in boxes <strong>20 and 21</strong> on your answer sheet.</p>
     <p><strong>According to the writer, which TWO of the following are criticisms of the neoclassical approach to organisational design?</strong></p>

     <div style="margin:16px 0;">
       <div style="margin:8px 0;"><label><input type="checkbox" name="q20" value="A"> <strong>A</strong> It suggests that workers are involved in too many decisions</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q20" value="B"> <strong>B</strong> The effects of some psychological factors are given low importance</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q20" value="C"> <strong>C</strong> The effects of the workplace surroundings are ignored</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q20" value="D"> <strong>D</strong> It exaggerates the success of the organisations that use this approach</label></div>
       <div style="margin:8px 0;"><label><input type="checkbox" name="q20" value="E"> <strong>E</strong> It assumes that all people work for enjoyment rather than financial gain</label></div>
     </div>
     <span class="flag-btn" data-q="q20" style="position:absolute; right:16px; top:16px;"></span>
   </div>

   <div class="group">
     <h4>Questions 22‚Äì26</h4>
     <p>Look at the following beliefs (Questions 22‚Äì26) and the list of people below.</p>
     <p>Match each belief with the correct person, <strong>A‚ÄìD</strong>.</p>
     <p>Write the correct letter, <strong>A‚ÄìD</strong>, in boxes <strong>22‚Äì26</strong> on your answer sheet.</p>
     <p><strong>NB</strong> You may use any letter more than once.</p>

     <ol start="22">
       <li><span class="flag-btn" data-q="q22" style="left:-20px;"></span>The classical approach relied upon managers having incorrect views about workers.<br>
         <label><input type="radio" name="q22" value="A"> A</label>
         <label><input type="radio" name="q22" value="B"> B</label>
         <label><input type="radio" name="q22" value="C"> C</label>
         <label><input type="radio" name="q22" value="D"> D</label>
       </li>
       <li><span class="flag-btn" data-q="q23" style="left:-20px;"></span>In the best organisational model, there is shared decision-making and interaction between teams at work.<br>
         <label><input type="radio" name="q23" value="A"> A</label>
         <label><input type="radio" name="q23" value="B"> B</label>
         <label><input type="radio" name="q23" value="C"> C</label>
         <label><input type="radio" name="q23" value="D"> D</label>
       </li>
       <li><span class="flag-btn" data-q="q24" style="left:-20px;"></span>In an efficient organisation, workers develop expertise in particular areas.<br>
         <label><input type="radio" name="q24" value="A"> A</label>
         <label><input type="radio" name="q24" value="B"> B</label>
         <label><input type="radio" name="q24" value="C"> C</label>
         <label><input type="radio" name="q24" value="D"> D</label>
       </li>
       <li><span class="flag-btn" data-q="q25" style="left:-20px;"></span>An organisation must take into account the emotional demands of people.<br>
         <label><input type="radio" name="q25" value="A"> A</label>
         <label><input type="radio" name="q25" value="B"> B</label>
         <label><input type="radio" name="q25" value="C"> C</label>
         <label><input type="radio" name="q25" value="D"> D</label>
       </li>
       <li><span class="flag-btn" data-q="q26" style="left:-20px;"></span>The classical approach allowed workers' skills to be assessed in a straightforward way.<br>
         <label><input type="radio" name="q26" value="A"> A</label>
         <label><input type="radio" name="q26" value="B"> B</label>
         <label><input type="radio" name="q26" value="C"> C</label>
         <label><input type="radio" name="q26" value="D"> D</label>
       </li>
     </ol>

     <div style="margin-top:20px; padding:12px; background:#f9f9f9; border-radius:6px;">
       <h4 style="margin-bottom:12px;">List of people</h4>
       <div><strong>A</strong> Max Weber</div>
       <div><strong>B</strong> Douglas McGregor</div>
       <div><strong>C</strong> Chris Argyris</div>
       <div><strong>D</strong> Rensis Likert</div>
     </div>
   </div>

   <div class="bottom-bar">
     <button class="btn-primary" onclick="submitAnswers()">Êèê‰∫§</button>
     <button onclick="resetForm()">ÈáçÁΩÆ</button>
     <button onclick="openWrongBook()">Êú¨ÁØáÈîôÈ¢ò</button>
   </div>
 </section>
</div>

<div id="selbar">
 <button id="btnNote">Note</button>
 <button id="btnHL">Highlight</button>
 <button id="btnUH" style="display:none;">Clear Highlight</button>
</div>

<div class="modal" id="resultModal">
 <div class="modal-content">
   <div class="modal-header">
     <h2>ÊàêÁª©</h2>
     <span class="modal-close" onclick="closeModal('resultModal')">√ó</span>
   </div>
   <div id="resultContent"></div>
   <button class="btn-primary" style="width:100%; margin-top:16px;" onclick="addWrongToBook()">Âä†ÂÖ•ÈîôÈ¢òÊú¨</button>
 </div>
</div>

<div class="modal" id="wrongBookModal">
 <div class="modal-content">
   <div class="modal-header">
     <h2>Êú¨ÁØáÈîôÈ¢ò</h2>
     <span class="modal-close" onclick="closeModal('wrongBookModal')">√ó</span>
   </div>
   <div id="wrongBookContent"></div>
 </div>
</div>

<div class="modal" id="resetModal">
 <div class="modal-content">
   <div class="modal-header">
     <h2>ÈáçÁΩÆÁªÉ‰π†</h2>
     <span class="modal-close" onclick="closeModal('resetModal')">√ó</span>
   </div>
   <div style="margin:16px 0;">
     <label style="display:block; margin-bottom:10px;">
       <input type="radio" name="resetType" value="answers" checked>
       Âè™Ê∏ÖÁ©∫Á≠îÊ°à
     </label>
     <label style="display:block;">
       <input type="radio" name="resetType" value="all">
       Ê∏ÖÁ©∫Á≠îÊ°àÂíåÊ†áËÆ∞
     </label>
   </div>
   <button class="btn-primary" style="width:100%;" onclick="confirmReset()">Á°ÆÂÆö</button>
 </div>
</div>

<script>
const PAPER_ID='P2_ORG_DESIGN';

let t=0;
const timerEl=document.getElementById('timer');
setInterval(()=>{ t++; timerEl.textContent=String(Math.floor(t/60)).padStart(2,'0')+':'+String(t%60).padStart(2,'0'); }, 1000);

const divider=document.getElementById('divider'), left=document.getElementById('left'), right=document.getElementById('right');
let dragging=false;
divider.onmousedown=()=>{ dragging=true; document.body.style.cursor='ew-resize'; };
window.onmousemove=(e)=>{ if(!dragging)return; const c=document.querySelector('.shell').getBoundingClientRect(); let x=e.clientX-c.left; x=Math.max(280,Math.min(c.width-280,x)); left.style.flex='0 0 '+x+'px'; right.style.flex='1 1 auto'; };
window.onmouseup=()=>{ dragging=false; document.body.style.cursor=''; };

const selbar=document.getElementById('selbar'), btnHL=document.getElementById('btnHL'), btnUH=document.getElementById('btnUH'), btnNote=document.getElementById('btnNote');
let lastRange=null, currentHlNode=null;

function posSelbar(r){ selbar.style.display='flex'; const t=window.scrollY+r.top-selbar.offsetHeight-8; const l=window.scrollX+r.left+r.width/2-selbar.offsetWidth/2; selbar.style.top=((t>0)?t:(window.scrollY+r.bottom+8))+'px'; selbar.style.left=Math.max(8,l)+'px'; }

function updSel(){ const s=window.getSelection(); if(!s||s.rangeCount===0||s.isCollapsed){ if(!currentHlNode)selbar.style.display='none'; return; } const r=s.getRangeAt(0); lastRange=r.cloneRange(); currentHlNode=null; btnNote.style.display='block'; btnHL.style.display='block'; btnUH.style.display='none'; posSelbar(r.getBoundingClientRect()); }

left.onmouseup=updSel; right.onmouseup=updSel;
document.onselectionchange=()=>{ const s=window.getSelection(); if((!s||s.rangeCount===0||s.isCollapsed)&&!currentHlNode)selbar.style.display='none'; };
document.addEventListener('click',(e)=>{ if(e.target.classList&&(e.target.classList.contains('hl')||e.target.classList.contains('note'))){ currentHlNode=e.target; lastRange=null; btnNote.style.display='none'; btnHL.style.display='none'; btnUH.style.display='block'; posSelbar(e.target.getBoundingClientRect()); const s=window.getSelection(); if(s)s.removeAllRanges(); }}, true);

btnHL.onclick=()=>{ if(currentHlNode||!lastRange||lastRange.collapsed)return; const s=document.createElement('span'); s.className='hl'; try{ lastRange.surroundContents(s); }catch(e){ const w=document.createElement('span'); w.className='hl'; w.appendChild(lastRange.cloneContents()); lastRange.deleteContents(); lastRange.insertNode(w); } selbar.style.display='none'; saveHighlights(); };

btnNote.onclick=()=>{ if(currentHlNode||!lastRange||lastRange.collapsed)return; const s=document.createElement('span'); s.className='note'; try{ lastRange.surroundContents(s); }catch(e){ const w=document.createElement('span'); w.className='note'; w.appendChild(lastRange.cloneContents()); lastRange.deleteContents(); lastRange.insertNode(w); } selbar.style.display='none'; saveHighlights(); };

btnUH.onclick=()=>{ if(currentHlNode){ const p=currentHlNode.parentNode; while(currentHlNode.firstChild)p.insertBefore(currentHlNode.firstChild,currentHlNode); p.removeChild(currentHlNode); p.normalize(); currentHlNode=null; selbar.style.display='none'; saveHighlights(); }else if(lastRange){ const sR=lastRange.getBoundingClientRect(); const w=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT); const tr=[]; while(w.nextNode()){ const n=w.currentNode; if(n.classList&&(n.classList.contains('hl')||n.classList.contains('note'))){ const r=n.getBoundingClientRect(); if(!(r.right<sR.left||r.left>sR.right||r.bottom<sR.top||r.top>sR.bottom))tr.push(n); }} tr.forEach(el=>{ const p=el.parentNode; while(el.firstChild)p.insertBefore(el.firstChild,el); p.removeChild(el); p.normalize(); }); selbar.style.display='none'; saveHighlights(); }};

document.querySelectorAll('.flag-btn').forEach(btn => {
 btn.onclick = e => {
   e.stopPropagation();
   btn.classList.toggle('active');
   saveFlags();
 };
});

const answerKey={q14:["A","D"],q16:["B","E"],q18:["A","D"],q20:["C","E"],q22:"B",q23:"D",q24:"A",q25:"C",q26:"A"};
let lastResults=[];

function saveAnswers() {
 const data = {};
 // Multiple choice questions (q14, q16, q18, q20)
 ['q14','q16','q18','q20'].forEach(q => {
   const checked = [...document.querySelectorAll(`input[name="${q}"]:checked`)].map(cb => cb.value);
   if(checked.length > 0) data[q] = checked;
 });
 // Single choice questions (q22-q26)
 ['q22','q23','q24','q25','q26'].forEach(q => {
   const ch = document.querySelector(`input[name="${q}"]:checked`);
   if(ch) data[q] = ch.value;
 });
 localStorage.setItem(`${PAPER_ID}_answers`, JSON.stringify(data));
}

function loadAnswers() {
  const data = JSON.parse(localStorage.getItem(`${PAPER_ID}_answers`) || '{}');
  Object.keys(data).forEach(q => {
    // Â§öÈÄâÈ¢òÔºöq14„ÄÅq16„ÄÅq18„ÄÅq20
    if (Array.isArray(data[q])) {
      data[q].forEach(val => {
        const cb = document.querySelector(`input[name="${q}"][value="${val}"]`);
        if (cb) cb.checked = true;
      });
    } 
    // ÂçïÈÄâÈ¢òÔºöq22‚Äìq26
    else {
      const radio = document.querySelector(`input[name="${q}"][value="${data[q]}"]`);
      if (radio) radio.checked = true;
    }
  });
}


function saveFlags() {
const flags = [...document.querySelectorAll('.flag-btn.active')].map(b => b.dataset.q);
localStorage.setItem(`${PAPER_ID}_flags`, JSON.stringify(flags));
}

function loadFlags() {
const flags = JSON.parse(localStorage.getItem(`${PAPER_ID}_flags`) || '[]');
flags.forEach(q => document.querySelector(`[data-q="${q}"]`)?.classList.add('active'));
}
function saveHighlights() {
  const highlights = { left: [], right: [] };
  document.querySelectorAll('#left .hl, #left .note').forEach((el, idx) => {
    highlights.left.push({
      type: el.classList.contains('hl') ? 'hl' : 'note',
      text: el.textContent,
      index: idx
    });
  });
  document.querySelectorAll('#right .hl, #right .note').forEach((el, idx) => {
    highlights.right.push({
      type: el.classList.contains('hl') ? 'hl' : 'note',
      text: el.textContent,
      index: idx
    });
  });
  localStorage.setItem(`${PAPER_ID}_highlights`, JSON.stringify(highlights));
}

function loadHighlights() {
  const data = JSON.parse(localStorage.getItem(`${PAPER_ID}_highlights`) || '{"left":[],"right":[]}');
  
  // ÊÅ¢Â§çÂ∑¶‰æßÈ´ò‰∫Æ
  if(data.left && data.left.length > 0) {
    data.left.forEach(item => {
      const walker = document.createTreeWalker(left, NodeFilter.SHOW_TEXT);
      let node;
      while(node = walker.nextNode()) {
        if(node.textContent.includes(item.text)) {
          const span = document.createElement('span');
          span.className = item.type;
          const parent = node.parentNode;
          const text = node.textContent;
          const idx = text.indexOf(item.text);
          if(idx >= 0) {
            const before = text.substring(0, idx);
            const match = text.substring(idx, idx + item.text.length);
            const after = text.substring(idx + item.text.length);
            
            parent.insertBefore(document.createTextNode(before), node);
            span.textContent = match;
            parent.insertBefore(span, node);
            parent.insertBefore(document.createTextNode(after), node);
            parent.removeChild(node);
            break;
          }
        }
      }
    });
  }
  
  // ÊÅ¢Â§çÂè≥‰æßÈ´ò‰∫Æ
  if(data.right && data.right.length > 0) {
    data.right.forEach(item => {
      const walker = document.createTreeWalker(right, NodeFilter.SHOW_TEXT);
      let node;
      while(node = walker.nextNode()) {
        if(node.textContent.includes(item.text)) {
          const span = document.createElement('span');
          span.className = item.type;
          const parent = node.parentNode;
          const text = node.textContent;
          const idx = text.indexOf(item.text);
          if(idx >= 0) {
            const before = text.substring(0, idx);
            const match = text.substring(idx, idx + item.text.length);
            const after = text.substring(idx + item.text.length);
            
            parent.insertBefore(document.createTextNode(before), node);
            span.textContent = match;
            parent.insertBefore(span, node);
            parent.insertBefore(document.createTextNode(after), node);
            parent.removeChild(node);
            break;
          }
        }
      }
    });
  }
}

document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
  input.addEventListener('change', saveAnswers);
});


document.addEventListener('DOMContentLoaded', () => {
  loadAnswers();
  loadFlags();
  loadHighlights();
});

function submitAnswers(){ const res=[]; let cor=0; Object.keys(answerKey).forEach(q=>{ const ch=document.querySelector('input[name="'+q+'"]:checked'); const uA=ch?ch.value:""; const cA=answerKey[q]; const iC=uA===cA; if(iC)cor++; res.push({id:q,userAns:uA,correctAns:cA,isCorrect:iC}); }); lastResults=res; const tot=Object.keys(answerKey).length; const pct=((cor/tot)*100).toFixed(1); localStorage.setItem(`ielts_score_${PAPER_ID}`, `${cor}/${tot}`);document.getElementById('resultContent').innerHTML=`<div class="result-summary"><div class="result-score">${cor} / ${tot}</div><div style="margin-top:8px;font-size:18px;">${pct}%</div></div>${res.map(r=>`<div class="result-item ${r.isCorrect?'correct':'incorrect'}"><div><strong>${r.id}</strong> ${r.isCorrect?'‚úì':'‚úó'}</div><div>‰Ω†ÁöÑÁ≠îÊ°à: ${r.userAns||'(Êú™‰ΩúÁ≠î)'}</div>${!r.isCorrect?`<div>Ê≠£Á°ÆÁ≠îÊ°à: ${r.correctAns}</div>`:''}</div>`).join('')}`; document.getElementById('resultModal').classList.add('active'); }

function resetForm(){ document.getElementById('resetModal').classList.add('active'); }

function confirmReset(){ 
  const tp=document.querySelector('input[name="resetType"]:checked').value; 
  document.querySelectorAll('input[type="radio"]').forEach(i=>i.checked=false); 
  localStorage.removeItem(`${PAPER_ID}_answers`);
  
  if(tp==='all'){ 
    document.querySelectorAll('.hl').forEach(el=>{ const p=el.parentNode; while(el.firstChild)p.insertBefore(el.firstChild,el); p.removeChild(el); p.normalize(); }); 
    document.querySelectorAll('.note').forEach(el=>{ const p=el.parentNode; while(el.firstChild)p.insertBefore(el.firstChild,el); p.removeChild(el); p.normalize(); }); 
    document.querySelectorAll('.flag-btn').forEach(b => b.classList.remove('active'));
    localStorage.removeItem(`${PAPER_ID}_highlights`);
    localStorage.removeItem(`${PAPER_ID}_flags`);
  } 
  closeModal('resetModal'); 
}

function addWrongToBook(){ const wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); const wr=lastResults.filter(r=>!r.isCorrect); wr.forEach(r=>{ const en={paperId:PAPER_ID,title:'How are deserts formed',questionId:r.id,correctAnswer:r.correctAns,myAnswer:r.userAns||'(Êú™‰ΩúÁ≠î)',date:new Date().toISOString().split('T')[0]}; const ix=wb.findIndex(i=>i.paperId===en.paperId&&i.questionId===en.questionId); if(ix>=0)wb[ix]=en; else wb.push(en); }); localStorage.setItem('ielts_wrong_book',JSON.stringify(wb)); alert(`Â∑≤Ê∑ªÂä† ${wr.length} ÈÅìÈîôÈ¢ò`); closeModal('resultModal'); }

function deleteWrongItem(pId,qId){ if(!confirm('Á°ÆÂÆöÂà†Èô§ËøôÈÅìÈîôÈ¢òÔºü'))return; let wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); wb=wb.filter(i=>!(i.paperId===pId&&i.questionId===qId)); localStorage.setItem('ielts_wrong_book',JSON.stringify(wb)); openWrongBook(); }

function clearCurrentWrongBook(){ if(!confirm('Á°ÆÂÆöÊ∏ÖÁ©∫Êú¨ÁØáÊâÄÊúâÈîôÈ¢òÔºü'))return; let wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); wb=wb.filter(i=>i.paperId!==PAPER_ID); localStorage.setItem('ielts_wrong_book',JSON.stringify(wb)); openWrongBook(); }

function openWrongBook(){ const wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); const cu=wb.filter(i=>i.paperId===PAPER_ID); const ct=document.getElementById('wrongBookContent'); if(cu.length===0)ct.innerHTML='<div style="text-align:center;padding:40px;color:#666;">ÊöÇÊó†ÈîôÈ¢ò</div>'; else ct.innerHTML=`<div class="modal-actions"><button class="btn-danger" onclick="clearCurrentWrongBook()" style="width:100%;">üóëÔ∏è Ê∏ÖÁ©∫Êú¨ÁØáÈîôÈ¢ò</button></div>${cu.map(i=>`<div class="wrong-item"><div class="wrong-item-content"><div style="font-weight:600;margin-bottom:8px;">${i.questionId}</div><div style="font-size:13px;color:#666;"><div>‚úì Ê≠£Á°Æ: ${i.correctAnswer}</div><div style="color:#d32f2f;">‚úó ÊàëÁöÑ: ${i.myAnswer}</div></div></div><button class="btn-delete" onclick="deleteWrongItem('${i.paperId}','${i.questionId}')">Âà†Èô§</button></div>`).join('')}`; document.getElementById('wrongBookModal').classList.add('active'); }

function closeModal(id){ document.getElementById(id).classList.remove('active'); }
</script>
</body>
</html>
