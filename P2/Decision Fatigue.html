<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>P2 ‚Äì Decision Fatigue</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
      }
      #timer {
        position: fixed;
        top: 12px;
        right: 12px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 16px;
        font-weight: 600;
        color: #0066cc;
        z-index: 1000;
      }
      .shell {
        display: flex;
        height: 100vh;
        width: 100%;
      }
      .pane {
        background: #fff;
        overflow: auto;
        padding: 24px;
      }
      #left {
        flex: 0 0 50%;
        border-right: 1px solid #ddd;
      }
      #right {
        flex: 1 1 auto;
        background: #fafafa;
      }
      #divider {
        flex: 0 0 5px;
        background: #ddd;
        cursor: ew-resize;
      }
      #divider:hover {
        background: #999;
      }
      h2,
      h3,
      h4 {
        margin: 0 0 12px;
        color: #333;
      }
      h2 {
        font-size: 20px;
      }
      h3 {
        font-size: 18px;
        color: #0066cc;
      }
      h4 {
        font-size: 15px;
        font-weight: 600;
        margin-top: 20px;
      }
      #left p {
        margin: 0 0 14px;
        line-height: 1.7;
        text-align: justify;
      }
      .group {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .group h4 {
        margin-top: 0;
        color: #0066cc;
      }
      .group p {
        margin: 8px 0;
        font-size: 14px;
        line-height: 1.6;
      }
      .flag-btn {
        position: absolute;
        left: 2px;
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ddd;
        cursor: pointer;
        z-index: 10;
      }
      .flag-btn:hover {
        background: #999;
      }
      .flag-btn.active {
        background: #ff5722;
      }
      .group ol {
        margin-left: 20px;
      }
      .group ol li {
        margin: 12px 0;
        font-size: 14px;
        line-height: 1.6;
        position: relative;
      }
      .group ol li label {
        display: inline-block;
        margin-right: 8px;
      }
      input[type="text"] {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 14px;
        width: 160px;
        background: #fdfdfd;
      }
      input[type="text"]:focus {
        border-color: #0066cc;
        outline: none;
        background: #fff;
      }
      .bottom-bar {
        display: flex;
        gap: 10px;
        margin-top: 16px;
      }
      button {
        padding: 10px 20px;
        border: 1px solid #999;
        border-radius: 6px;
        background: #fff;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #f0f0f0;
      }
      .btn-primary {
        background: #0066cc;
        color: #fff;
        border-color: #0066cc;
      }
      .btn-primary:hover {
        background: #0052a3;
      }
      .btn-danger {
        background: #dc3545;
        color: #fff;
        border-color: #dc3545;
      }
      .btn-danger:hover {
        background: #c82333;
      }
      .hl {
        background: #fff59d;
        cursor: pointer;
      }
      .hl:hover {
        background: #ffeb3b;
      }
      .note {
        background: #b3d9ff;
        cursor: pointer;
      }
      .note:hover {
        background: #99ccff;
      }
      #selbar {
        position: fixed;
        display: none;
        z-index: 2000;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 8px;
        gap: 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        flex-direction: column;
        min-width: 120px;
      }
      #selbar button {
        background: #fff;
        color: #666;
        border: none;
        padding: 3px 0px;
        cursor: pointer;
        font-size: 14px;
        text-align: center;
        border-radius: 4px;
      }
      #selbar button:hover {
        background: #f5f5f5;
        color: #333;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 3000;
        align-items: center;
        justify-content: center;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: #fff;
        border-radius: 8px;
        padding: 24px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }
      .modal-header h2 {
        font-size: 28px;
        color: #333;
        margin: 0;
      }
      .modal-close {
        font-size: 32px;
        cursor: pointer;
        color: #999;
        line-height: 1;
      }
      .modal-close:hover {
        color: #333;
      }
      .result-summary {
        text-align: center;
        padding: 20px;
        background: #f0f0f0;
        margin-bottom: 16px;
        border-radius: 6px;
      }
      .result-score {
        font-size: 36px;
        font-weight: 600;
        color: #0066cc;
      }
      .result-item {
        padding: 10px;
        margin: 8px 0;
        border-left: 3px solid #ddd;
        background: #f9f9f9;
        font-size: 13px;
      }
      .result-item.correct {
        border-left-color: #28a745;
        background: #e8f5e9;
      }
      .result-item.incorrect {
        border-left-color: #dc3545;
        background: #ffebee;
      }
      .wrong-item {
        background: #fff3e0;
        padding: 16px;
        margin: 8px 0;
        border-radius: 8px;
        border-left: 4px solid #ff9800;
        display: flex;
        justify-content: space-between;
        align-items: start;
      }
      .wrong-item-content {
        flex: 1;
      }
      .btn-delete {
        background: #dc3545;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        margin-left: 12px;
      }
      .btn-delete:hover {
        background: #c82333;
      }
      .modal-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      .headings-box {
        background: #f9f9f9;
        padding: 12px;
        border: 1px solid #eee;
        border-radius: 4px;
        margin-bottom: 12px;
      }
      .headings-box h5 {
        margin: 0 0 8px;
        font-size: 14px;
        color: #333;
      }
    </style>
  </head>
  <body>
    <div id="timer">00:00</div>
    <div class="shell">
      <section class="pane" id="left">
        <h2>READING PASSAGE 2</h2>
        <p>
          You should spend about 20 minutes on Questions 14‚Äì26, which are based
          on Reading Passage 2 below.
        </p>
        <h3>Decision Fatigue</h3>
        <p>
          ‚ÄòDecision fatigue‚Äô helps explain why ordinarily sensible people avoid
          making decisions or are easily persuaded to make the wrong decisions
          when they are tired. Yet few people are conscious of it, and
          researchers are only beginning to understand why it happens.
        </p>
        <p>
          <strong>A</strong> No matter how rational people try to be, they can‚Äôt
          make decision after decision without paying a biological price. This
          ‚Äòdecision fatigue‚Äô is different from ordinary physical fatigue. People
          are not conscious of being tired, but nevertheless they are low on
          energy. The more choices one makes throughout the day, the harder it
          becomes for the brain, and eventually it looks for shortcuts: either
          to act impulsively instead of expending the energy to think through
          the possible results, or the ultimate energy saver: do nothing.
          Avoiding a decision often creates bigger problems in the long run, but
          for the moment it eases the mental strain.
        </p>
        <p>
          <strong>B</strong> Decision fatigue involves a phenomenon called ego
          depletion, a term coined by social psychologist Roy F. Baumeister. His
          research demonstrated that there is a finite store of mental stamina
          for exerting self-control. For example, when people fended off the
          temptation to eat freshly baked biscuits, they were then less able to
          resist other temptations. When they tried to resist the urge to cry
          during a sad movie, afterwards they gave up more quickly on tasks
          requiring self-discipline, such as working on a geometry puzzle. The
          experiments confirmed the 19th-century notion of willpower being like
          a muscle that became tired with use; something which could be
          conserved by avoiding temptation.
        </p>
        <p>
          <strong>C</strong> Decision fatigue leaves people vulnerable to
          marketers who know how to time their sales, as Jonathan Levav
          demonstrated. He visited a tailor to have a suit made for his wedding
          and began going through the choices of fabric, buttons, and so forth,
          and when he got through the third pile of fabric samples. Levav
          recalls, ‚ÄúI couldn‚Äôt tell the choices apart anymore. After a while my
          only response to the tailor became, ‚ÄòWhat do you recommend?‚Äô‚Äù Levav
          put the experience to use in an experiment conducted at German car
          dealerships, where real customers had to choose among four styles of
          gearshift knobs, 25 configurations of the engine and gearbox, and a
          palette of 56 colours for the interior. As they started picking
          features, customers would carefully weigh the choices, but as decision
          fatigue set in they would start settling for the default option. By
          manipulating the order of the car buyers‚Äô choices, the researchers
          found that customers would end up paying more.
        </p>
        <p>
          <strong>D</strong> Similarly, sweet snacks are featured prominently at
          cash registers at most supermarkets. With their willpower reduced
          after shopping, people are especially vulnerable to sweet drinks and
          snacks. While supermarkets figured this out a long time ago, only
          recently did researchers discover why. Baumeister‚Äôs research team
          tested the notion that people could build up willpower by first
          indulging in pleasure. They found that a delicious, thick milkshake
          strengthened willpower by helping people perform better than expected
          on their next task. However, the experiment also included a control
          group who drank a tasteless low-fat dairy beverage. It provided them
          with no pleasure, yet it produced similar improvements in
          self-control. Baumeister concluded that even the tasteless drink had
          worked because the brain, like the rest of the body, derived energy
          from glucose, the simple sugar manufactured from all kinds of foods,
          including milk.
        </p>
        <p>
          <strong>E</strong> To establish cause and effect, researchers at
          Baumeister‚Äôs lab tried refueling the brain in experiments involving
          lemonade mixed either with sugar or with a diet sweetener. The sugary
          lemonade provided a burst of glucose, the effects of which could be
          observed immediately in the lab; the sugarless sweeteners tasted
          similar but did not contain the glucose. Again and again, the sugar
          restored willpower, but the artificial sweetener had no effect. The
          glucose would mitigate the ego depletion and sometimes completely
          reverse it, improving self-control and the quality of decisions: the
          subjects resisted irrational bias when making choices and, when making
          financial decisions, they were more likely to choose the better
          long-term strategy instead of going for a quick payoff.
        </p>
        <p>
          <strong>F</strong> However, some brain researchers had reservations
          about the glucose connection. ‚ÄúTodd Heatherton, a pioneer of social
          neuroscience, believed in ego depletion but didn‚Äôt see how this
          process could be caused simply by variations in glucose levels.‚Äù To
          observe the process, and to see if it could be reversed by glucose,
          Heatherton‚Äôs team recorded images of the brains of 45 people who were
          on a low-calorie diet as they reacted to pictures of food. Next, these
          dieters watched a comedy video while forcing themselves to suppress
          their laughter‚Äîthereby draining mental energy and inducing ego
          depletion. When they were again shown pictures of food, further brain
          scans revealed more activity in the brain‚Äôs reward centre and a
          decrease in the amygdala, which helps control impulses. The food‚Äôs
          appeal, in other words, registered more strongly while impulse control
          weakened. What surprised Heatherton was that administering glucose
          completely reversed the brain changes brought about by ego depletion.
        </p>
        <p>
          <strong>G</strong> ‚ÄúGood decision-making is not a trait of the
          person,‚Äù Baumeister says. ‚ÄúIt‚Äôs a state that fluctuates.‚Äù His studies
          show that people with the best self-control are the ones who avoid
          temptations, and who establish habits that eliminate the mental effort
          of making choices. Instead of counting on willpower all day, they
          conserve it so that it‚Äôs available for important decisions. ‚ÄúEven the
          wisest people won‚Äôt make good choices when they‚Äôre not rested and
          their glucose is low,‚Äù Baumeister notes. If a decision must be made
          late in the afternoon or in the evening, they know not to do it on an
          empty stomach. The best decision-makers, according to Baumeister, ‚Äúare
          the ones who know when not to trust themselves.‚Äù
        </p>
      </section>
      <div id="divider"></div>
      <section class="pane" id="right">
        <h3>Questions</h3>
        <div class="group">
          <h4>Questions 14‚Äì19</h4>
          <p>Reading Passage 2 has seven sections, A‚ÄìG.</p>
          <p>Which section contains the following information?</p>
          <ol start="14">
            <li>
              <span class="flag-btn" data-q="q14" style="left: -20px"></span
              >research in which two substances that tasted alike had different
              effects on the subjects<br />
              <label><input type="radio" name="q14" value="A" /> A</label>
              <label><input type="radio" name="q14" value="B" /> B</label>
              <label><input type="radio" name="q14" value="C" /> C</label>
              <label><input type="radio" name="q14" value="D" /> D</label>
              <label><input type="radio" name="q14" value="E" /> E</label>
              <label><input type="radio" name="q14" value="F" /> F</label>
              <label><input type="radio" name="q14" value="G" /> G</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q15" style="left: -20px"></span>an
              instance where controlling emotions while viewing something
              upsetting led to a lack of perseverance in other activities<br />
              <label><input type="radio" name="q15" value="A" /> A</label>
              <label><input type="radio" name="q15" value="B" /> B</label>
              <label><input type="radio" name="q15" value="C" /> C</label>
              <label><input type="radio" name="q15" value="D" /> D</label>
              <label><input type="radio" name="q15" value="E" /> E</label>
              <label><input type="radio" name="q15" value="F" /> F</label>
              <label><input type="radio" name="q15" value="G" /> G</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q16" style="left: -20px"></span>an
              explanation of why it is important to eat something before making
              a decision at the end of the day<br />
              <label><input type="radio" name="q16" value="A" /> A</label>
              <label><input type="radio" name="q16" value="B" /> B</label>
              <label><input type="radio" name="q16" value="C" /> C</label>
              <label><input type="radio" name="q16" value="D" /> D</label>
              <label><input type="radio" name="q16" value="E" /> E</label>
              <label><input type="radio" name="q16" value="F" /> F</label>
              <label><input type="radio" name="q16" value="G" /> G</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q17" style="left: -20px"></span>a
              reference to a researcher who was not initially convinced of the
              effect of glucose<br />
              <label><input type="radio" name="q17" value="A" /> A</label>
              <label><input type="radio" name="q17" value="B" /> B</label>
              <label><input type="radio" name="q17" value="C" /> C</label>
              <label><input type="radio" name="q17" value="D" /> D</label>
              <label><input type="radio" name="q17" value="E" /> E</label>
              <label><input type="radio" name="q17" value="F" /> F</label>
              <label><input type="radio" name="q17" value="G" /> G</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q18" style="left: -20px"></span>an
              account of research that mirrored an experience the researcher had
              in his personal life<br />
              <label><input type="radio" name="q18" value="A" /> A</label>
              <label><input type="radio" name="q18" value="B" /> B</label>
              <label><input type="radio" name="q18" value="C" /> C</label>
              <label><input type="radio" name="q18" value="D" /> D</label>
              <label><input type="radio" name="q18" value="E" /> E</label>
              <label><input type="radio" name="q18" value="F" /> F</label>
              <label><input type="radio" name="q18" value="G" /> G</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q19" style="left: -20px"></span>an
              example of how the location of products in a shop can be used to
              take advantage of ‚Äòdecision fatigue‚Äô<br />
              <label><input type="radio" name="q19" value="A" /> A</label>
              <label><input type="radio" name="q19" value="B" /> B</label>
              <label><input type="radio" name="q19" value="C" /> C</label>
              <label><input type="radio" name="q19" value="D" /> D</label>
              <label><input type="radio" name="q19" value="E" /> E</label>
              <label><input type="radio" name="q19" value="F" /> F</label>
              <label><input type="radio" name="q19" value="G" /> G</label>
            </li>
          </ol>
        </div>
        <div class="group">
          <h4>Questions 20‚Äì22</h4>
          <p>
            Complete the summary below. Choose
            <strong>ONE WORD ONLY</strong> from the passage.
          </p>
          <div
            style="
              background: #f9f9f9;
              padding: 15px;
              border-radius: 4px;
              line-height: 2;
            "
          >
            <strong>The biological price of decision-making</strong><br />
            Even when people attempt to be <strong>20</strong>
            <span
              class="flag-btn"
              data-q="q20"
              style="
                left: inherit;
                display: inline-block;
                position: relative;
                vertical-align: middle;
                margin-left: 5px;
              "
            ></span>
            <input type="text" name="q20" />, they experience ‚Äòdecision fatigue‚Äô
            if they make several decisions in a row. They are not aware of how
            <strong>21</strong>
            <span
              class="flag-btn"
              data-q="q21"
              style="
                left: inherit;
                display: inline-block;
                position: relative;
                vertical-align: middle;
                margin-left: 5px;
              "
            ></span>
            <input type="text" name="q21" /> they are, but it is increasingly
            more difficult for their brains to make decisions as the day
            progresses. After making many decisions in one day, the brain seeks
            <strong>22</strong>
            <span
              class="flag-btn"
              data-q="q22"
              style="
                left: inherit;
                display: inline-block;
                position: relative;
                vertical-align: middle;
                margin-left: 5px;
              "
            ></span>
            <input type="text" name="q22" /> in order to conserve energy. The
            person may fail to consider the consequences of their decision or
            not make a decision at all. Avoiding decisions reduces the immediate
            strain but can cause difficulties later.
          </div>
        </div>
        <div class="group">
          <h4>Questions 23‚Äì26</h4>
          <p>
            Match each statement with the correct researcher,
            <strong>A, B or C</strong>.
          </p>
          <div class="headings-box">
            <h5>List of Researchers</h5>
            <div style="margin-left: 10px">
              <strong>A</strong> Roy F. Baumeister<br />
              <strong>B</strong> Jonathan Levav<br />
              <strong>C</strong> Todd Heatherton
            </div>
          </div>
          <ol start="23">
            <li>
              <span class="flag-btn" data-q="q23" style="left: -20px"></span>The
              energy people have for exercising willpower is limited.<br />
              <label><input type="radio" name="q23" value="A" /> A</label>
              <label><input type="radio" name="q23" value="B" /> B</label>
              <label><input type="radio" name="q23" value="C" /> C</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q24" style="left: -20px"></span
              >Even an unpleasant substance had a positive effect on
              willpower.<br />
              <label><input type="radio" name="q24" value="A" /> A</label>
              <label><input type="radio" name="q24" value="B" /> B</label>
              <label><input type="radio" name="q24" value="C" /> C</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q25" style="left: -20px"></span
              >People‚Äôs responses to images changed after having to exercise
              self-control.<br />
              <label><input type="radio" name="q25" value="A" /> A</label>
              <label><input type="radio" name="q25" value="B" /> B</label>
              <label><input type="radio" name="q25" value="C" /> C</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q26" style="left: -20px"></span>The
              sequence of options presented to consumers could be used to the
              consumers‚Äô disadvantage.<br />
              <label><input type="radio" name="q26" value="A" /> A</label>
              <label><input type="radio" name="q26" value="B" /> B</label>
              <label><input type="radio" name="q26" value="C" /> C</label>
            </li>
          </ol>
        </div>
        <div class="bottom-bar">
          <button class="btn-primary" onclick="submitAnswers()">Êèê‰∫§</button>
          <button onclick="resetForm()">ÈáçÁΩÆ</button>
          <button onclick="openWrongBook()">Êú¨ÁØáÈîôÈ¢ò</button>
        </div>
      </section>
    </div>
    <div id="selbar">
      <button id="btnNote">Note</button>
      <button id="btnHL">Highlight</button>
      <button id="btnUH" style="display: none">Clear Highlight</button>
    </div>
    <div class="modal" id="resultModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÊàêÁª©</h2>
          <span class="modal-close" onclick="closeModal('resultModal')">√ó</span>
        </div>
        <div id="resultContent"></div>
        <button
          class="btn-primary"
          style="width: 100%; margin-top: 16px"
          onclick="addWrongToBook()"
        >
          Âä†ÂÖ•ÈîôÈ¢òÊú¨
        </button>
      </div>
    </div>
    <div class="modal" id="wrongBookModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Êú¨ÁØáÈîôÈ¢ò</h2>
          <span class="modal-close" onclick="closeModal('wrongBookModal')"
            >√ó</span
          >
        </div>
        <div id="wrongBookContent"></div>
      </div>
    </div>
    <div class="modal" id="resetModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÈáçÁΩÆÁªÉ‰π†</h2>
          <span class="modal-close" onclick="closeModal('resetModal')">√ó</span>
        </div>
        <div style="margin: 16px 0">
          <label style="display: block; margin-bottom: 10px"
            ><input type="radio" name="resetType" value="answers" checked />
            Âè™Ê∏ÖÁ©∫Á≠îÊ°à</label
          >
          <label style="display: block"
            ><input type="radio" name="resetType" value="all" />
            Ê∏ÖÁ©∫Á≠îÊ°àÂíåÊ†áËÆ∞</label
          >
        </div>
        <button
          class="btn-primary"
          style="width: 100%"
          onclick="confirmReset()"
        >
          Á°ÆÂÆö
        </button>
      </div>
    </div>
    <script>
      const PAPER_ID = "P2_DECISION_FATIGUE";
      let t = 0;
      const timerEl = document.getElementById("timer");
      setInterval(() => {
        t++;
        timerEl.textContent =
          String(Math.floor(t / 60)).padStart(2, "0") +
          ":" +
          String(t % 60).padStart(2, "0");
      }, 1000);
      const divider = document.getElementById("divider"),
        left = document.getElementById("left"),
        right = document.getElementById("right");
      let dragging = false;
      divider.onmousedown = () => {
        dragging = true;
        document.body.style.cursor = "ew-resize";
      };
      window.onmousemove = (e) => {
        if (!dragging) return;
        const c = document.querySelector(".shell").getBoundingClientRect();
        let x = e.clientX - c.left;
        x = Math.max(280, Math.min(c.width - 280, x));
        left.style.flex = "0 0 " + x + "px";
        right.style.flex = "1 1 auto";
      };
      window.onmouseup = () => {
        dragging = false;
        document.body.style.cursor = "";
      };
      const selbar = document.getElementById("selbar"),
        btnHL = document.getElementById("btnHL"),
        btnUH = document.getElementById("btnUH"),
        btnNote = document.getElementById("btnNote");
      let lastRange = null,
        currentHlNode = null;
      function posSelbar(r) {
        selbar.style.display = "flex";
        const t = window.scrollY + r.top - selbar.offsetHeight - 8;
        const l =
          window.scrollX + r.left + r.width / 2 - selbar.offsetWidth / 2;
        selbar.style.top = (t > 0 ? t : window.scrollY + r.bottom + 8) + "px";
        selbar.style.left = Math.max(8, l) + "px";
      }
      function updSel() {
        const s = window.getSelection();
        if (!s || s.rangeCount === 0 || s.isCollapsed) {
          if (!currentHlNode) selbar.style.display = "none";
          return;
        }
        const r = s.getRangeAt(0);
        lastRange = r.cloneRange();
        currentHlNode = null;
        btnNote.style.display = "block";
        btnHL.style.display = "block";
        btnUH.style.display = "none";
        posSelbar(r.getBoundingClientRect());
      }
      left.onmouseup = updSel;
      right.onmouseup = updSel;
      document.onselectionchange = () => {
        const s = window.getSelection();
        if ((!s || s.rangeCount === 0 || s.isCollapsed) && !currentHlNode)
          selbar.style.display = "none";
      };
      document.addEventListener(
        "click",
        (e) => {
          if (
            e.target.classList &&
            (e.target.classList.contains("hl") ||
              e.target.classList.contains("note"))
          ) {
            currentHlNode = e.target;
            lastRange = null;
            btnNote.style.display = "none";
            btnHL.style.display = "none";
            btnUH.style.display = "block";
            posSelbar(e.target.getBoundingClientRect());
            const s = window.getSelection();
            if (s) s.removeAllRanges();
          }
        },
        true
      );
      btnHL.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "hl";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "hl";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnNote.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "note";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "note";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnUH.onclick = () => {
        if (currentHlNode) {
          const p = currentHlNode.parentNode;
          while (currentHlNode.firstChild)
            p.insertBefore(currentHlNode.firstChild, currentHlNode);
          p.removeChild(currentHlNode);
          p.normalize();
          currentHlNode = null;
          selbar.style.display = "none";
          saveHighlights();
        } else if (lastRange) {
          const sR = lastRange.getBoundingClientRect();
          const w = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_ELEMENT
          );
          const tr = [];
          while (w.nextNode()) {
            const n = w.currentNode;
            if (
              n.classList &&
              (n.classList.contains("hl") || n.classList.contains("note"))
            ) {
              const r = n.getBoundingClientRect();
              if (
                !(
                  r.right < sR.left ||
                  r.left > sR.right ||
                  r.bottom < sR.top ||
                  r.top > sR.bottom
                )
              )
                tr.push(n);
            }
          }
          tr.forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          selbar.style.display = "none";
          saveHighlights();
        }
      };
      document.querySelectorAll(".flag-btn").forEach((btn) => {
        btn.onclick = (e) => {
          e.stopPropagation();
          btn.classList.toggle("active");
          saveFlags();
        };
      });
      const answerKey = {
        q14: "E",
        q15: "B",
        q16: "G",
        q17: "F",
        q18: "C",
        q19: "D",
        q20: "rational",
        q21: "tired",
        q22: "shortcuts",
        q23: "A",
        q24: "A",
        q25: "C",
        q26: "B",
      };
      let lastResults = [];
      function saveAnswers() {
        const data = {};
        Object.keys(answerKey).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) data[q] = radio.value;
          else if (text) data[q] = text.value;
        });
        localStorage.setItem(`${PAPER_ID}_answers`, JSON.stringify(data));
      }
      function loadAnswers() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_answers`) || "{}"
        );
        Object.keys(data).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][value="${data[q]}"]`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) radio.checked = true;
          else if (text) text.value = data[q];
        });
      }
      function saveFlags() {
        const flags = [...document.querySelectorAll(".flag-btn.active")].map(
          (b) => b.dataset.q
        );
        localStorage.setItem(`${PAPER_ID}_flags`, JSON.stringify(flags));
      }
      function loadFlags() {
        const flags = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_flags`) || "[]"
        );
        flags.forEach((q) =>
          document.querySelector(`[data-q="${q}"]`)?.classList.add("active")
        );
      }
      function saveHighlights() {
        const highlights = { left: [], right: [] };
        document
          .querySelectorAll("#left .hl, #left .note")
          .forEach((el, idx) => {
            highlights.left.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        document
          .querySelectorAll("#right .hl, #right .note")
          .forEach((el, idx) => {
            highlights.right.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        localStorage.setItem(
          `${PAPER_ID}_highlights`,
          JSON.stringify(highlights)
        );
      }
      function loadHighlights() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_highlights`) ||
            '{"left":[],"right":[]}'
        );
        const restore = (pane, items) => {
          if (!items || items.length === 0) return;
          items.forEach((item) => {
            const walker = document.createTreeWalker(
              pane,
              NodeFilter.SHOW_TEXT
            );
            let node;
            while ((node = walker.nextNode())) {
              if (node.textContent.includes(item.text)) {
                const span = document.createElement("span");
                span.className = item.type;
                const parent = node.parentNode;
                const text = node.textContent;
                const idx = text.indexOf(item.text);
                if (idx >= 0) {
                  const before = text.substring(0, idx);
                  const match = text.substring(idx, idx + item.text.length);
                  const after = text.substring(idx + item.text.length);
                  parent.insertBefore(document.createTextNode(before), node);
                  span.textContent = match;
                  parent.insertBefore(span, node);
                  parent.insertBefore(document.createTextNode(after), node);
                  parent.removeChild(node);
                  break;
                }
              }
            }
          });
        };
        restore(left, data.left);
        restore(right, data.right);
      }
      document.querySelectorAll("input").forEach((inp) => {
        inp.addEventListener("change", saveAnswers);
        if (inp.type === "text") inp.addEventListener("input", saveAnswers);
      });
      document.addEventListener("DOMContentLoaded", () => {
        loadAnswers();
        loadFlags();
        loadHighlights();
      });
      function submitAnswers() {
        const res = [];
        let cor = 0;
        Object.keys(answerKey).forEach((q) => {
          let uA = "";
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) uA = radio.value;
          else if (text) uA = text.value.trim();
          const cA = answerKey[q];
          const iC = uA.toLowerCase() === cA.toLowerCase();
          if (iC) cor++;
          res.push({ id: q, userAns: uA, correctAns: cA, isCorrect: iC });
        });
        lastResults = res;
        const tot = Object.keys(answerKey).length;
        const pct = ((cor / tot) * 100).toFixed(1);
        localStorage.setItem(`ielts_score_${PAPER_ID}`, `${cor}/${tot}`);
        document.getElementById(
          "resultContent"
        ).innerHTML = `<div class="result-summary"><div class="result-score">${cor} / ${tot}</div><div style="margin-top:8px;font-size:18px;">${pct}%</div></div>${res
          .map(
            (r) =>
              `<div class="result-item ${
                r.isCorrect ? "correct" : "incorrect"
              }"><div><strong>${r.id}</strong> ${
                r.isCorrect ? "‚úì" : "‚úó"
              }</div><div>‰Ω†ÁöÑÁ≠îÊ°à: ${r.userAns || "(Êú™‰ΩúÁ≠î)"}</div>${
                !r.isCorrect ? `<div>Ê≠£Á°ÆÁ≠îÊ°à: ${r.correctAns}</div>` : ""
              }</div>`
          )
          .join("")}`;
        document.getElementById("resultModal").classList.add("active");
      }
      function resetForm() {
        document.getElementById("resetModal").classList.add("active");
      }
      function confirmReset() {
        const tp = document.querySelector(
          'input[name="resetType"]:checked'
        ).value;
        document.querySelectorAll("input").forEach((i) => {
          if (i.type === "radio") i.checked = false;
          if (i.type === "text") i.value = "";
        });
        localStorage.removeItem(`${PAPER_ID}_answers`);
        if (tp === "all") {
          document.querySelectorAll(".hl").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document.querySelectorAll(".note").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document
            .querySelectorAll(".flag-btn")
            .forEach((b) => b.classList.remove("active"));
          localStorage.removeItem(`${PAPER_ID}_highlights`);
          localStorage.removeItem(`${PAPER_ID}_flags`);
        }
        closeModal("resetModal");
      }
      function addWrongToBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const wr = lastResults.filter((r) => !r.isCorrect);
        wr.forEach((r) => {
          const en = {
            paperId: PAPER_ID,
            title: "Decision Fatigue",
            questionId: r.id,
            correctAnswer: r.correctAns,
            myAnswer: r.userAns || "(Êú™‰ΩúÁ≠î)",
            date: new Date().toISOString().split("T")[0],
          };
          const ix = wb.findIndex(
            (i) => i.paperId === en.paperId && i.questionId === en.questionId
          );
          if (ix >= 0) wb[ix] = en;
          else wb.push(en);
        });
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        alert(`Â∑≤Ê∑ªÂä† ${wr.length} ÈÅìÈîôÈ¢ò`);
        closeModal("resultModal");
      }
      function deleteWrongItem(pId, qId) {
        if (!confirm("Á°ÆÂÆöÂà†Èô§ËøôÈÅìÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => !(i.paperId === pId && i.questionId === qId));
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function clearCurrentWrongBook() {
        if (!confirm("Á°ÆÂÆöÊ∏ÖÁ©∫Êú¨ÁØáÊâÄÊúâÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => i.paperId !== PAPER_ID);
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function openWrongBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const cu = wb.filter((i) => i.paperId === PAPER_ID);
        const ct = document.getElementById("wrongBookContent");
        if (cu.length === 0)
          ct.innerHTML =
            '<div style="text-align:center;padding:40px;color:#666;">ÊöÇÊó†ÈîôÈ¢ò</div>';
        else
          ct.innerHTML = `<div class="modal-actions"><button class="btn-danger" onclick="clearCurrentWrongBook()" stylewidth:100%;">üóëÔ∏è Ê∏ÖÁ©∫Êú¨ÁØáÈîôÈ¢ò</button></div>${cu
            .map(
              (i) =>
                `<div class="wrong-item"><div class="wrong-item-content"><div style="font-weight:600;margin-bottom:8px;">${i.questionId}</div><div style="font-size:13px;color:#666;"><div>‚úì Ê≠£Á°Æ: ${i.correctAnswer}</div><div style="color:#d32f2f;">‚úó ÊàëÁöÑ: ${i.myAnswer}</div></div></div><button class="btn-delete" onclick="deleteWrongItem('${i.paperId}','${i.questionId}')">Âà†Èô§</button></div>`
            )
            .join("")}`;
        document.getElementById("wrongBookModal").classList.add("active");
      }
      function closeModal(id) {
        document.getElementById(id).classList.remove("active");
      }
    </script>
  </body>
</html>
