<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>P1 ‚Äì Thomas Young</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
      }
      #timer {
        position: fixed;
        top: 12px;
        right: 12px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 16px;
        font-weight: 600;
        color: #0066cc;
        z-index: 1000;
      }
      .shell {
        display: flex;
        height: 100vh;
        width: 100%;
      }
      .pane {
        background: #fff;
        overflow: auto;
        padding: 24px;
      }
      #left {
        flex: 0 0 50%;
        border-right: 1px solid #ddd;
      }
      #right {
        flex: 1 1 auto;
        background: #fafafa;
      }
      #divider {
        flex: 0 0 5px;
        background: #ddd;
        cursor: ew-resize;
      }
      #divider:hover {
        background: #999;
      }
      h2,
      h3,
      h4 {
        margin: 0 0 12px;
        color: #333;
      }
      h2 {
        font-size: 20px;
      }
      h3 {
        font-size: 18px;
        color: #0066cc;
      }
      h4 {
        font-size: 15px;
        font-weight: 600;
        margin-top: 20px;
      }
      #left p {
        margin: 0 0 14px;
        line-height: 1.7;
        text-align: justify;
      }
      .group {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .group h4 {
        margin-top: 0;
        color: #0066cc;
      }
      .group p {
        margin: 8px 0;
        font-size: 14px;
        line-height: 1.6;
      }
      .flag-btn {
        position: absolute;
        left: 2px;
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ddd;
        cursor: pointer;
        z-index: 10;
      }
      .flag-btn:hover {
        background: #999;
      }
      .flag-btn.active {
        background: #ff5722;
      }
      .group ol {
        margin-left: 20px;
      }
      .group ol li {
        margin: 12px 0;
        font-size: 14px;
        line-height: 1.6;
        position: relative;
      }
      .group ol li label {
        display: inline-block;
        margin-right: 8px;
      }
      input[type="text"] {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 14px;
        width: 160px;
        background: #fdfdfd;
      }
      input[type="text"]:focus {
        border-color: #0066cc;
        outline: none;
        background: #fff;
      }
      .bottom-bar {
        display: flex;
        gap: 10px;
        margin-top: 16px;
      }
      button {
        padding: 10px 20px;
        border: 1px solid #999;
        border-radius: 6px;
        background: #fff;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #f0f0f0;
      }
      .btn-primary {
        background: #0066cc;
        color: #fff;
        border-color: #0066cc;
      }
      .btn-primary:hover {
        background: #0052a3;
      }
      .btn-danger {
        background: #dc3545;
        color: #fff;
        border-color: #dc3545;
      }
      .btn-danger:hover {
        background: #c82333;
      }
      .hl {
        background: #fff59d;
        cursor: pointer;
      }
      .hl:hover {
        background: #ffeb3b;
      }
      .note {
        background: #b3d9ff;
        cursor: pointer;
      }
      .note:hover {
        background: #99ccff;
      }
      #selbar {
        position: fixed;
        display: none;
        z-index: 2000;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 8px;
        gap: 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        flex-direction: column;
        min-width: 120px;
      }
      #selbar button {
        background: #fff;
        color: #666;
        border: none;
        padding: 3px 0px;
        cursor: pointer;
        font-size: 14px;
        text-align: center;
        border-radius: 4px;
      }
      #selbar button:hover {
        background: #f5f5f5;
        color: #333;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 3000;
        align-items: center;
        justify-content: center;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: #fff;
        border-radius: 8px;
        padding: 24px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }
      .modal-header h2 {
        font-size: 28px;
        color: #333;
        margin: 0;
      }
      .modal-close {
        font-size: 32px;
        cursor: pointer;
        color: #999;
        line-height: 1;
      }
      .modal-close:hover {
        color: #333;
      }
      .result-summary {
        text-align: center;
        padding: 20px;
        background: #f0f0f0;
        margin-bottom: 16px;
        border-radius: 6px;
      }
      .result-score {
        font-size: 36px;
        font-weight: 600;
        color: #0066cc;
      }
      .result-item {
        padding: 10px;
        margin: 8px 0;
        border-left: 3px solid #ddd;
        background: #f9f9f9;
        font-size: 13px;
      }
      .result-item.correct {
        border-left-color: #28a745;
        background: #e8f5e9;
      }
      .result-item.incorrect {
        border-left-color: #dc3545;
        background: #ffebee;
      }
      .wrong-item {
        background: #fff3e0;
        padding: 16px;
        margin: 8px 0;
        border-radius: 8px;
        border-left: 4px solid #ff9800;
        display: flex;
        justify-content: space-between;
        align-items: start;
      }
      .wrong-item-content {
        flex: 1;
      }
      .btn-delete {
        background: #dc3545;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        margin-left: 12px;
      }
      .btn-delete:hover {
        background: #c82333;
      }
      .modal-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div id="timer">00:00</div>
    <div class="shell">
      <section class="pane" id="left">
        <h2>READING PASSAGE 1</h2>
        <p>
          You should spend about 20 minutes on Questions 1‚Äì13, which are based
          on Reading Passage 1 below.
        </p>
        <h3>Thomas Young: The last man who knew everything</h3>
        <p>
          In the 21st century, it would be quite impossible for even the most
          learned man to know everything. However, as recently as the 18th
          century, there were those whose knowledge encompassed most of the
          information available at that time. This is a review of a biography of
          one such man.
        </p>
        <p>
          Thomas Young (1773‚Äì1829) contributed 63 articles to the great British
          encyclopaedia, Encyclopaedia Britannica, including 46 biographical
          entries (mostly on scientists and classical scholars) and substantial
          essays on ‚ÄòBridge‚Äô (a card game), ‚ÄòEgypt‚Äô, ‚ÄòLanguages‚Äô and ‚ÄòTides‚Äô.
          Was someone who could write authoritatively about so many subjects a
          genius, or a dilettante? In an ambitious biography, Andrew Robinson
          argues that Young is a good contender to be described as ‚Äúthe last man
          who knew everything‚Äù. Young has competition, however: the phrase,
          which Robinson uses as the title of his biography of Young, also
          serves as the subtitle of two other recent biographies ‚Äì Leonard
          Warren‚Äôs 1998 life of palaeontologist Joseph Leidy (1823‚Äì1891) and
          Paula Findlen‚Äôs 2004 book on Athanasius Kircher (1602‚Äì1680).
        </p>
        <p>
          Young, of course, did more than write encyclopaedia entries. He
          presented his first paper, on the human eye, to the prestigious
          academic institution, the Royal Society of London, at the age of 20
          and was elected a Fellow of the Society shortly afterwards. In the
          paper, which sought to explain how the eye focuses on objects at
          varying distances, Young hypothesised that this was achieved by
          changes in the shape of the lens. He also theorised that light travels
          in waves and believed that, to be able to see in colour, there must be
          three receptors in the eye corresponding to the three principal
          colours (red, green and violet) to which the retina could respond. All
          these hypotheses were subsequently proved correct.
        </p>
        <p>
          Later in his life, when he was in his forties, Young was instrumental
          in cracking the code that unlocked the unknown script on the Rosetta
          Stone, a tablet found in Egypt by the Napoleonic army in 1799. The
          stone has text in three alphabets: Greek, Egyptian hieroglyphs and
          another script that was originally unrecognisable. The unrecognisable
          script is now known as demotic and, as Young deduced, is directly
          related to Egyptian hieroglyphs. His initial work on this appeared in
          the Britannica entry ‚ÄòEgypt‚Äô. In another entry, Young coined the term
          ‚ÄòIndo-European‚Äô to describe the family of languages spoken throughout
          most of Europe and northern India. These works are landmark
          achievements for a man who was a child prodigy but who, unlike many
          remarkable children, did not fade into obscurity as an adult.
        </p>
        <p>
          Born in 1773 in Somerset, England, Young lived with his maternal
          grandfather from an early age. He devoured books from the age of two
          and excelled at Latin, Greek, mathematics and natural philosophy (the
          18th-century term for science). After leaving school, he was greatly
          encouraged by Richard Brocklesby, a physician and Fellow of the Royal
          Society. Following Brocklesby‚Äôs lead, Young decided to pursue a career
          in medicine. He studied in London and then moved on to more formal
          education in Edinburgh, G√∂ttingen and Cambridge. After completing his
          medical training at the University of Cambridge in 1808, Young set up
          practice as a physician in London and, a few years later, was
          appointed physician at St George‚Äôs Hospital.
        </p>
        <p>
          Young‚Äôs skill as a physician, however, did not equal his talent as a
          scholar of natural philosophy or linguistics. In 1801, he had been
          appointed to a professorship of natural philosophy at the Royal
          Institution, where he delivered as many as 60 lectures a year. His
          opinions were sought by civic and national authorities on matters such
          as the introduction of gas lighting to London streets and methods of
          ship construction. From 1819, he was Superintendent of the Nautical
          Almanac and Secretary to the Board of Longitude. Between 1816 and
          1825, he contributed many entries to the Encyclopaedia Britannica, and
          throughout his career he authored numerous other essays, papers and
          books.
        </p>
        <p>
          Young is a perfect subject for a biography ‚Äì perfect, but daunting.
          Few men contributed so much to so many technical fields. Robinson‚Äôs
          aim is to introduce non-scientists to Young‚Äôs work and life. He
          succeeds, providing clear expositions of the technical material
          (especially that on optics and Egyptian hieroglyphs). Some readers of
          this book will, like Robinson, find Young‚Äôs accomplishments
          impressive; others will see him, as some historians have, as a
          dilettante. Yet despite the rich material presented in this book,
          readers will not end up knowing Young personally. We catch glimpses of
          a playful Young, doodling Greek and Latin phrases in his notes on
          medical lectures and translating the verses that a young lady had
          written on the walls of a summerhouse into Greek elegiacs. Young was
          introduced into elite society, attended the theatre and learned to
          dance and play the flute. In addition, he was an accomplished
          horseman. However, his personal life looks pale next to his vibrant
          career and studies.
        </p>
        <p>
          Young married Eliza Maxwell in 1804, and according to Robinson, ‚Äútheir
          marriage was happy and she appreciated his work‚Äù. Almost all we know
          about her is that she sustained her husband through some acrimonious
          disputes about optics and that she worried about money when his
          medical career was slow to take off. Little evidence survives
          concerning the complexities of Young‚Äôs relationships with his mother
          and father, and Robinson does not credit them with shaping Young‚Äôs
          extraordinary mind. Despite the lack of personal detail, anyone
          interested in what it means to be a genius should read this book.
        </p>
      </section>
      <div id="divider"></div>
      <section class="pane" id="right">
        <h3>Questions</h3>
        <div class="group">
          <h4>Questions 1‚Äì7</h4>
          <p>
            Do the following statements agree with the information given in
            Reading Passage 1?
          </p>
          <div style="margin: 8px 0 16px 20px">
            <div>
              <strong>TRUE</strong> if the statement agrees with the information
            </div>
            <div>
              <strong>FALSE</strong> if the statement contradicts the
              information
            </div>
            <div>
              <strong>NOT GIVEN</strong> if there is no information on this
            </div>
          </div>
          <ol start="1">
            <li>
              <span class="flag-btn" data-q="q1" style="left: -20px"></span
              >Other people have been referred to as ‚Äòthe last man who knew
              everything‚Äô.<br />
              <label><input type="radio" name="q1" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q1" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q1" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q2" style="left: -20px"></span>The
              fact that Young‚Äôs childhood brilliance continued into adulthood
              was normal.<br />
              <label><input type="radio" name="q2" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q2" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q2" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q3" style="left: -20px"></span
              >Young‚Äôs talents as a doctor are described as surpassing his other
              skills.<br />
              <label><input type="radio" name="q3" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q3" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q3" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q4" style="left: -20px"></span
              >Young‚Äôs advice was sought by several bodies responsible for local
              and national matters.<br />
              <label><input type="radio" name="q4" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q4" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q4" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q5" style="left: -20px"></span>All
              Young‚Äôs written works were published in the Encyclopaedia
              Britannica.<br />
              <label><input type="radio" name="q5" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q5" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q5" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q6" style="left: -20px"></span
              >Young was interested in a range of social pastimes.<br />
              <label><input type="radio" name="q6" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q6" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q6" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q7" style="left: -20px"></span
              >Young suffered from poor health in his later years.<br />
              <label><input type="radio" name="q7" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q7" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q7" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
          </ol>
        </div>
        <div class="group">
          <h4>Questions 8‚Äì13</h4>
          <p>Answer the questions below.</p>
          <p>
            Choose
            <strong>NO MORE THAN THREE WORDS AND/OR A NUMBER</strong> from the
            passage for each answer.
          </p>
          <div style="margin-left: 10px; line-height: 1.8; font-size: 14px">
            <p>
              <b>8</b> How many life stories did Thomas Young write for the
              Encyclopaedia Britannica?
              <span
                class="flag-btn"
                data-q="q8"
                style="
                  left: inherit;
                  display: inline-block;
                  position: relative;
                  vertical-align: middle;
                  margin-left: 5px;
                "
              ></span
              ><br /><input type="text" name="q8" style="margin-top: 5px" />
            </p>
            <p>
              <b>9</b> What was the subject of Thomas Young‚Äôs first academic
              paper?
              <span
                class="flag-btn"
                data-q="q9"
                style="
                  left: inherit;
                  display: inline-block;
                  position: relative;
                  vertical-align: middle;
                  margin-left: 5px;
                "
              ></span
              ><br /><input type="text" name="q9" style="margin-top: 5px" />
            </p>
            <p>
              <b>10</b> What name did Young give to a group of languages?
              <span
                class="flag-btn"
                data-q="q10"
                style="
                  left: inherit;
                  display: inline-block;
                  position: relative;
                  vertical-align: middle;
                  margin-left: 5px;
                "
              ></span
              ><br /><input type="text" name="q10" style="margin-top: 5px" />
            </p>
            <p>
              <b>11</b> Who inspired Young to enter the medical profession?
              <span
                class="flag-btn"
                data-q="q11"
                style="
                  left: inherit;
                  display: inline-block;
                  position: relative;
                  vertical-align: middle;
                  margin-left: 5px;
                "
              ></span
              ><br /><input type="text" name="q11" style="margin-top: 5px" />
            </p>
            <p>
              <b>12</b> At which place of higher learning did Young hold a
              teaching position?
              <span
                class="flag-btn"
                data-q="q12"
                style="
                  left: inherit;
                  display: inline-block;
                  position: relative;
                  vertical-align: middle;
                  margin-left: 5px;
                "
              ></span
              ><br /><input type="text" name="q12" style="margin-top: 5px" />
            </p>
            <p>
              <b>13</b> What was the improvement to London roads on which
              Young‚Äôs ideas were sought?
              <span
                class="flag-btn"
                data-q="q13"
                style="
                  left: inherit;
                  display: inline-block;
                  position: relative;
                  vertical-align: middle;
                  margin-left: 5px;
                "
              ></span
              ><br /><input type="text" name="q13" style="margin-top: 5px" />
            </p>
          </div>
        </div>
        <div class="bottom-bar">
          <button class="btn-primary" onclick="submitAnswers()">Êèê‰∫§</button>
          <button onclick="resetForm()">ÈáçÁΩÆ</button>
          <button onclick="openWrongBook()">Êú¨ÁØáÈîôÈ¢ò</button>
        </div>
      </section>
    </div>
    <div id="selbar">
      <button id="btnNote">Note</button>
      <button id="btnHL">Highlight</button>
      <button id="btnUH" style="display: none">Clear Highlight</button>
    </div>
    <div class="modal" id="resultModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÊàêÁª©</h2>
          <span class="modal-close" onclick="closeModal('resultModal')">√ó</span>
        </div>
        <div id="resultContent"></div>
        <button
          class="btn-primary"
          style="width: 100%; margin-top: 16px"
          onclick="addWrongToBook()"
        >
          Âä†ÂÖ•ÈîôÈ¢òÊú¨
        </button>
      </div>
    </div>
    <div class="modal" id="wrongBookModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Êú¨ÁØáÈîôÈ¢ò</h2>
          <span class="modal-close" onclick="closeModal('wrongBookModal')"
            >√ó</span
          >
        </div>
        <div id="wrongBookContent"></div>
      </div>
    </div>
    <div class="modal" id="resetModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÈáçÁΩÆÁªÉ‰π†</h2>
          <span class="modal-close" onclick="closeModal('resetModal')">√ó</span>
        </div>
        <div style="margin: 16px 0">
          <label style="display: block; margin-bottom: 10px"
            ><input type="radio" name="resetType" value="answers" checked />
            Âè™Ê∏ÖÁ©∫Á≠îÊ°à</label
          >
          <label style="display: block"
            ><input type="radio" name="resetType" value="all" />
            Ê∏ÖÁ©∫Á≠îÊ°àÂíåÊ†áËÆ∞</label
          >
        </div>
        <button
          class="btn-primary"
          style="width: 100%"
          onclick="confirmReset()"
        >
          Á°ÆÂÆö
        </button>
      </div>
    </div>
    <script>
      const PAPER_ID = "P1_THOMAS_YOUNG";
      let t = 0;
      const timerEl = document.getElementById("timer");
      setInterval(() => {
        t++;
        timerEl.textContent =
          String(Math.floor(t / 60)).padStart(2, "0") +
          ":" +
          String(t % 60).padStart(2, "0");
      }, 1000);
      const divider = document.getElementById("divider"),
        left = document.getElementById("left"),
        right = document.getElementById("right");
      let dragging = false;
      divider.onmousedown = () => {
        dragging = true;
        document.body.style.cursor = "ew-resize";
      };
      window.onmousemove = (e) => {
        if (!dragging) return;
        const c = document.querySelector(".shell").getBoundingClientRect();
        let x = e.clientX - c.left;
        x = Math.max(280, Math.min(c.width - 280, x));
        left.style.flex = "0 0 " + x + "px";
        right.style.flex = "1 1 auto";
      };
      window.onmouseup = () => {
        dragging = false;
        document.body.style.cursor = "";
      };
      const selbar = document.getElementById("selbar"),
        btnHL = document.getElementById("btnHL"),
        btnUH = document.getElementById("btnUH"),
        btnNote = document.getElementById("btnNote");
      let lastRange = null,
        currentHlNode = null;
      function posSelbar(r) {
        selbar.style.display = "flex";
        const t = window.scrollY + r.top - selbar.offsetHeight - 8;
        const l =
          window.scrollX + r.left + r.width / 2 - selbar.offsetWidth / 2;
        selbar.style.top = (t > 0 ? t : window.scrollY + r.bottom + 8) + "px";
        selbar.style.left = Math.max(8, l) + "px";
      }
      function updSel() {
        const s = window.getSelection();
        if (!s || s.rangeCount === 0 || s.isCollapsed) {
          if (!currentHlNode) selbar.style.display = "none";
          return;
        }
        const r = s.getRangeAt(0);
        lastRange = r.cloneRange();
        currentHlNode = null;
        btnNote.style.display = "block";
        btnHL.style.display = "block";
        btnUH.style.display = "none";
        posSelbar(r.getBoundingClientRect());
      }
      left.onmouseup = updSel;
      right.onmouseup = updSel;
      document.onselectionchange = () => {
        const s = window.getSelection();
        if ((!s || s.rangeCount === 0 || s.isCollapsed) && !currentHlNode)
          selbar.style.display = "none";
      };
      document.addEventListener(
        "click",
        (e) => {
          if (
            e.target.classList &&
            (e.target.classList.contains("hl") ||
              e.target.classList.contains("note"))
          ) {
            currentHlNode = e.target;
            lastRange = null;
            btnNote.style.display = "none";
            btnHL.style.display = "none";
            btnUH.style.display = "block";
            posSelbar(e.target.getBoundingClientRect());
            const s = window.getSelection();
            if (s) s.removeAllRanges();
          }
        },
        true
      );
      btnHL.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "hl";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "hl";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnNote.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "note";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "note";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnUH.onclick = () => {
        if (currentHlNode) {
          const p = currentHlNode.parentNode;
          while (currentHlNode.firstChild)
            p.insertBefore(currentHlNode.firstChild, currentHlNode);
          p.removeChild(currentHlNode);
          p.normalize();
          currentHlNode = null;
          selbar.style.display = "none";
          saveHighlights();
        } else if (lastRange) {
          const sR = lastRange.getBoundingClientRect();
          const w = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_ELEMENT
          );
          const tr = [];
          while (w.nextNode()) {
            const n = w.currentNode;
            if (
              n.classList &&
              (n.classList.contains("hl") || n.classList.contains("note"))
            ) {
              const r = n.getBoundingClientRect();
              if (
                !(
                  r.right < sR.left ||
                  r.left > sR.right ||
                  r.bottom < sR.top ||
                  r.top > sR.bottom
                )
              )
                tr.push(n);
            }
          }
          tr.forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          selbar.style.display = "none";
          saveHighlights();
        }
      };
      document.querySelectorAll(".flag-btn").forEach((btn) => {
        btn.onclick = (e) => {
          e.stopPropagation();
          btn.classList.toggle("active");
          saveFlags();
        };
      });
      const answerKey = {
        q1: "TRUE",
        q2: "FALSE",
        q3: "FALSE",
        q4: "TRUE",
        q5: "FALSE",
        q6: "TRUE",
        q7: "NOT GIVEN",
        q8: "46",
        q9: "the human eye",
        q10: "Indo-European",
        q11: "Richard Brocklesby",
        q12: "the Royal Institution",
        q13: "gas lighting",
      };
      let lastResults = [];
      function saveAnswers() {
        const data = {};
        Object.keys(answerKey).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) data[q] = radio.value;
          else if (text) data[q] = text.value;
        });
        localStorage.setItem(`${PAPER_ID}_answers`, JSON.stringify(data));
      }
      function loadAnswers() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_answers`) || "{}"
        );
        Object.keys(data).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][value="${data[q]}"]`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) radio.checked = true;
          else if (text) text.value = data[q];
        });
      }
      function saveFlags() {
        const flags = [...document.querySelectorAll(".flag-btn.active")].map(
          (b) => b.dataset.q
        );
        localStorage.setItem(`${PAPER_ID}_flags`, JSON.stringify(flags));
      }
      function loadFlags() {
        const flags = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_flags`) || "[]"
        );
        flags.forEach((q) =>
          document.querySelector(`[data-q="${q}"]`)?.classList.add("active")
        );
      }
      function saveHighlights() {
        const highlights = { left: [], right: [] };
        document
          .querySelectorAll("#left .hl, #left .note")
          .forEach((el, idx) => {
            highlights.left.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        document
          .querySelectorAll("#right .hl, #right .note")
          .forEach((el, idx) => {
            highlights.right.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        localStorage.setItem(
          `${PAPER_ID}_highlights`,
          JSON.stringify(highlights)
        );
      }
      function loadHighlights() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_highlights`) ||
            '{"left":[],"right":[]}'
        );
        const restore = (pane, items) => {
          if (!items || items.length === 0) return;
          items.forEach((item) => {
            const walker = document.createTreeWalker(
              pane,
              NodeFilter.SHOW_TEXT
            );
            let node;
            while ((node = walker.nextNode())) {
              if (node.textContent.includes(item.text)) {
                const span = document.createElement("span");
                span.className = item.type;
                const parent = node.parentNode;
                const text = node.textContent;
                const idx = text.indexOf(item.text);
                if (idx >= 0) {
                  const before = text.substring(0, idx);
                  const match = text.substring(idx, idx + item.text.length);
                  const after = text.substring(idx + item.text.length);
                  parent.insertBefore(document.createTextNode(before), node);
                  span.textContent = match;
                  parent.insertBefore(span, node);
                  parent.insertBefore(document.createTextNode(after), node);
                  parent.removeChild(node);
                  break;
                }
              }
            }
          });
        };
        restore(left, data.left);
        restore(right, data.right);
      }
      document.querySelectorAll("input").forEach((inp) => {
        inp.addEventListener("change", saveAnswers);
        if (inp.type === "text") inp.addEventListener("input", saveAnswers);
      });
      document.addEventListener("DOMContentLoaded", () => {
        loadAnswers();
        loadFlags();
        loadHighlights();
      });
      function submitAnswers() {
        const res = [];
        let cor = 0;
        Object.keys(answerKey).forEach((q) => {
          let uA = "";
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) uA = radio.value;
          else if (text) uA = text.value.trim();
          const cA = answerKey[q];
          let iC = false;
          if (cA.includes("/")) {
            const opts = cA.split("/").map((s) => s.trim().toLowerCase());
            iC = opts.includes(uA.toLowerCase());
          } else {
            iC = uA.toLowerCase() === cA.toLowerCase();
          }
          if (iC) cor++;
          res.push({ id: q, userAns: uA, correctAns: cA, isCorrect: iC });
        });
        lastResults = res;
        const tot = Object.keys(answerKey).length;
        const pct = ((cor / tot) * 100).toFixed(1);
        localStorage.setItem(`ielts_score_${PAPER_ID}`, `${cor}/${tot}`);
        document.getElementById(
          "resultContent"
        ).innerHTML = `<div class="result-summary"><div class="result-score">${cor} / ${tot}</div><div style="margin-top:8px;font-size:18px;">${pct}%</div></div>${res
          .map(
            (r) =>
              `<div class="result-item ${
                r.isCorrect ? "correct" : "incorrect"
              }"><div><strong>${r.id}</strong> ${
                r.isCorrect ? "‚úì" : "‚úó"
              }</div><div>‰Ω†ÁöÑÁ≠îÊ°à: ${r.userAns || "(Êú™‰ΩúÁ≠î)"}</div>${
                !r.isCorrect ? `<div>Ê≠£Á°ÆÁ≠îÊ°à: ${r.correctAns}</div>` : ""
              }</div>`
          )
          .join("")}`;
        document.getElementById("resultModal").classList.add("active");
      }
      function resetForm() {
        document.getElementById("resetModal").classList.add("active");
      }
      function confirmReset() {
        const tp = document.querySelector(
          'input[name="resetType"]:checked'
        ).value;
        document.querySelectorAll("input").forEach((i) => {
          if (i.type === "radio") i.checked = false;
          if (i.type === "text") i.value = "";
        });
        localStorage.removeItem(`${PAPER_ID}_answers`);
        if (tp === "all") {
          document.querySelectorAll(".hl").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document.querySelectorAll(".note").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document
            .querySelectorAll(".flag-btn")
            .forEach((b) => b.classList.remove("active"));
          localStorage.removeItem(`${PAPER_ID}_highlights`);
          localStorage.removeItem(`${PAPER_ID}_flags`);
        }
        closeModal("resetModal");
      }
      function addWrongToBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const wr = lastResults.filter((r) => !r.isCorrect);
        wr.forEach((r) => {
          const en = {
            paperId: PAPER_ID,
            title: "Thomas Young: The last man who knew everything",
            questionId: r.id,
            correctAnswer: r.correctAns,
            myAnswer: r.userAns || "(Êú™‰ΩúÁ≠î)",
            date: new Date().toISOString().split("T")[0],
          };
          const ix = wb.findIndex(
            (i) => i.paperId === en.paperId && i.questionId === en.questionId
          );
          if (ix >= 0) wb[ix] = en;
          else wb.push(en);
        });
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        alert(`Â∑≤Ê∑ªÂä† ${wr.length} ÈÅìÈîôÈ¢ò`);
        closeModal("resultModal");
      }
      function deleteWrongItem(pId, qId) {
        if (!confirm("Á°ÆÂÆöÂà†Èô§ËøôÈÅìÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => !(i.paperId === pId && i.questionId === qId));
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function clearCurrentWrongBook() {
        if (!confirm("Á°ÆÂÆöÊ∏ÖÁ©∫Êú¨ÁØáÊâÄÊúâÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => i.paperId !== PAPER_ID);
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function openWrongBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const cu = wb.filter((i) => i.paperId === PAPER_ID);
        const ct = document.getElementById("wrongBookContent");
        if (cu.length === 0)
          ct.innerHTML =
            '<div style="text-align:center;padding:40px;color:#666;">ÊöÇÊó†ÈîôÈ¢ò</div>';
        else
          ct.innerHTML = `<div class="modal-actions"><button class="btn-danger" onclick="clearCurrentWrongBook()" stylewidth:100%;">üóëÔ∏è Ê∏ÖÁ©∫Êú¨ÁØáÈîôÈ¢ò</button></div>${cu
            .map(
              (i) =>
                `<div class="wrong-item"><div class="wrong-item-content"><div style="font-weight:600;margin-bottom:8px;">${i.questionId}</div><div style="font-size:13px;color:#666;"><div>‚úì Ê≠£Á°Æ: ${i.correctAnswer}</div><div style="color:#d32f2f;">‚úó ÊàëÁöÑ: ${i.myAnswer}</div></div></div><button class="btn-delete" onclick="deleteWrongItem('${i.paperId}','${i.questionId}')">Âà†Èô§</button></div>`
            )
            .join("")}`;
        document.getElementById("wrongBookModal").classList.add("active");
      }
      function closeModal(id) {
        document.getElementById(id).classList.remove("active");
      }
    </script>
  </body>
</html>
