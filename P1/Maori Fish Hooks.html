<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>P1 ‚Äì Maori Fish Hooks</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  * { box-sizing: border-box; margin:0; padding:0; }
  html,body { height:100%; }
  body { font-family: Arial, sans-serif; background:#f5f5f5; }
  
  #timer { position:fixed; top:12px; right:12px; background:#fff; border:1px solid #ddd; border-radius:6px; padding:8px 12px; font-size:16px; font-weight:600; color:#0066cc; z-index:1000; }
  
  .shell { display:flex; height:100vh; width:100%; }
  .pane { background:#fff; overflow:auto; padding:24px; }
  #left { flex: 0 0 50%; border-right:1px solid #ddd; }
  #right { flex: 1 1 auto; background:#fafafa; }
  #divider { flex: 0 0 5px; background:#ddd; cursor: ew-resize; }
  #divider:hover { background:#999; }
  
  h2,h3,h4 { margin:0 0 12px; color:#333; }
  h2 { font-size:20px; }
  h3 { font-size:18px; color:#0066cc; }
  h4 { font-size:15px; font-weight:600; margin-top:20px; }
  
  #left p { margin: 0 0 14px; line-height: 1.7; text-align:justify; }
  
  .group { background:#fff; border:1px solid #ddd; border-radius:6px; padding:16px; margin-bottom:16px; }
  .group h4 { margin-top:0; color:#0066cc; }
  .group p { margin:8px 0; font-size:14px; line-height:1.6; }
  
  .flag-btn { 
    position:absolute; 
    left:2px; 
    top:50%;
    transform:translateY(-50%);
    width:8px;
    height:8px;
    border-radius:50%;
    background:#ddd;
    cursor:pointer;
    z-index:10;
  }
  .flag-btn:hover { background:#999; }
  .flag-btn.active { background:#ff5722; }
  
  .group ol { margin-left:20px; }
  .group ol li { margin:12px 0; font-size:14px; line-height:1.6; position:relative; }
  
  /* Styling for Paragraph Matching Radio Grid */
  .radio-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 5px;
  }
  .radio-grid label {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 13px;
      cursor: pointer;
  }

  .bottom-bar { display:flex; gap:10px; margin-top:16px; }
  button { padding:10px 20px; border:1px solid #999; border-radius:6px; background:#fff; cursor:pointer; font-size:14px; }
  button:hover { background:#f0f0f0; }
  .btn-primary { background:#0066cc; color:#fff; border-color:#0066cc; }
  .btn-primary:hover { background:#0052a3; }
  .btn-danger { background:#dc3545; color:#fff; border-color:#dc3545; }
  .btn-danger:hover { background:#c82333; }
  
  .hl { background:#fff59d; cursor:pointer; }
  .hl:hover { background:#ffeb3b; }
  .note { background:#b3d9ff; cursor:pointer; }
  .note:hover { background:#99ccff; }
  
  #selbar { position:fixed; display:none; z-index:2000; background:#fff; border:1px solid #ddd; border-radius:8px; padding:8px; gap:0; box-shadow:0 2px 8px rgba(0,0,0,0.15); flex-direction:column; min-width:120px; }
  #selbar button { background:#fff; color:#666; border:none; padding:3px 0px; cursor:pointer; font-size:14px; text-align:center; border-radius:4px; }
  #selbar button:hover { background:#f5f5f5; color:#333; }
  
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:3000; align-items:center; justify-content:center; }
  .modal.active { display:flex; }
  .modal-content { background:#fff; border-radius:8px; padding:24px; max-width:600px; width:90%; max-height:80vh; overflow-y:auto; }
  
  .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
  .modal-header h2 { font-size: 28px; color: #333; margin: 0; }
  .modal-close { font-size: 32px; cursor: pointer; color: #999; line-height: 1; }
  .modal-close:hover { color: #333; }
  
  .result-summary { text-align:center; padding:20px; background:#f0f0f0; margin-bottom:16px; border-radius:6px; }
  .result-score { font-size:36px; font-weight:600; color:#0066cc; }
  .result-item { padding:10px; margin:8px 0; border-left:3px solid #ddd; background:#f9f9f9; font-size:13px; }
  .result-item.correct { border-left-color:#28a745; background:#e8f5e9; }
  .result-item.incorrect { border-left-color:#dc3545; background:#ffebee; }
  
  .wrong-item { background:#fff3e0; padding:16px; margin:8px 0; border-radius:8px; border-left:4px solid #ff9800; display:flex; justify-content:space-between; align-items:start; }
  .wrong-item-content { flex:1; }
  .btn-delete { background:#dc3545; color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:13px; margin-left:12px; }
  .btn-delete:hover { background:#c82333; }
  .modal-actions { display:flex; gap:10px; margin-bottom:20px; }
</style>
</head>
<body>
<div id="timer">00:00</div>

<div class="shell">
  <section class="pane" id="left">
    
<h2>READING PASSAGE 1</h2>
<p>You should spend about 20 minutes on Questions 1‚Äì13, which are based on Reading Passage 1 below.</p>
<h3>Maori Fish Hooks</h3>

<h4>Paragraph A</h4>
<p>Maori fish hooks, made from wood, bone, stone and flax, are intended to have the best possible design and function. The hooks are designed to target specific species with precision. In the industry of commercial long-line fishing, there are some Maori hook designs that are making a splash.</p>

<h4>Paragraph B</h4>
<p>When Polynesians first came to New Zealand sometime between AD 1100‚Äì1300, they didn‚Äôt have the technology necessary to melt and manipulate metal from ore. Meanwhile, fish were the settlers‚Äô main food source, so fishermen made their hooks and fishing gear out of wood, bone, stone and shells. Other plants native to New Zealand, such as flax (harakeke), cabbage tree (ti), and astelia (kiekie), provided the necessary fibrous material to make fishing-lines and nets of greater or equal strength to the jute used by Europeans at the time. Metal is more malleable and can be shaped in various ways, whereas natural materials are limited in the forms they can take; the Maori fish hooks needed to be innovative in overcoming these limitations.</p>

<h4>Paragraph C</h4>
<p>Early European explorers who settled and explored New Zealand claimed that Maori hooks, known as matau, were ‚Äúodd‚Äù, ‚Äúof doubtful efficacy‚Äù, ‚Äúvery clumsy affairs‚Äù, or ‚Äúimpossible looking‚Äù. Archaeologists from recent times have also described the round hook as odd, with comments such as ‚Äúshaped in a manner which makes it very difficult to imagine could ever be effective in catching a fish‚Äù. William Anderson, who was aboard the Resolution during Cook‚Äôs third voyage in 1777 as the ship‚Äôs surgeon, remarked that the Maori ‚Äúlive chiefly by fishing, making use ‚Ä¶ of wooden fish hooks pointed with bone, but so oddly made that a stranger is at a loss to know how they can answer such a purpose.‚Äù</p>

<h4>Paragraph D</h4>
<p>The Museum of New Zealand Te Papa Tongarewa conducted a study on Maori fish hooks 230 years later and demonstrated that the unique hook design was a matter of function. The hook‚Äôs design allowed it to catch fish by spinning away from the direction of the point and catching their jaws, instead of poking a hole through the fish or being used as a lever, as some archaeologists had suggested. It appears that the design of the Maori fish hook is perhaps the world‚Äôs most efficiently and masterfully designed, likely superior to any modern metal fish hook today.</p>

<h4>Paragraph E</h4>
<p>To make larger hooks, Maori used shanks made of strong wood, with stout points made of bone or shell. They tied tree branches and saplings together to grow them into ideal shapes for building, then harvested the plants when they reached the appropriate size. They hardened wood by carefully drying it and burying it underground with fires lit above. Human bone was often used for bone points, which were securely lashed to a groove at the end of the shank using pre-made flax materials (muka). When they wanted to catch larger species like sharks, groper and ling, they used composite hooks. However, on average, the traditional hook was usually no longer than a three-finger breadth (128 mm in length).</p>

<h4>Paragraph F</h4>
<p>To capture seabirds for food and feathers, like albatross, the islanders used slender hooks that can be differentiated from other hooks intended for fish by their lighter build and lack of an in-turned point. Many of these hooks were collected by early explorers, suggesting that seabird catching with hook and line was an important source of food and feathers for the Maori (105 mm in length). Slender hooks with wide gaps were used to capture albatross and other seabirds and can be distinguished from fish hooks by their lighter construction and absence of an in-turned point. Early explorers collected many of these hooks, which could indicate that catching seabirds provided significant amounts of food and feathers for the Maori.</p>

<h4>Paragraph G</h4>
<p>The Maori quickly adopted new materials once they became available through European explorers, sealers and whalers who began arriving towards the end of the 1700s. At this point, the Maori were still making their fish hooks but were now using metals and imported materials. Wooden and flax components of old, abandoned fish hooks decomposed quickly as traditional hooks were discarded in favour of new ones. Tools made of luxury materials such as ivory or greenstone may have been kept as decorative items, with stylised Maori fish hooks today serving as a symbol of cultural revitalisation.</p>

<h4>Paragraph H</h4>
<p>The Maori continued to recreate traditional designs even as new materials became available, preferring hook shapes introduced by Pakeha in the 1800s. By maintaining the tradition of the rotating hook design, they remained connected to an essential part of their cultural heritage. In the end, however, mass-produced European metal hooks eventually dominated, making it difficult to continue crafting hooks from nails, horseshoes and other metal objects. Eventually, traditional designs fell out of favour.</p>

<h4>Paragraph I</h4>
<p>By the late 19th and early 20th centuries, tourist and collector demand for Maori artefacts had grown, leading manufacturers to produce large quantities of forged hooks. These replicas were then traded with both Maori and Europeans as forgeries of the real thing, sometimes directly commissioned by artefact dealers. Fake hooks can be identified by their cheap construction, inconsistent materials, rudimentary lashings, odd or overly elaborate decorative carvings, and the absence of in-turned points or angled grooves used to attach the fishing-line properly.</p>

<h4>Paragraph J</h4>
<p>The evolution of matau throughout history symbolises how the Maori have adapted to European tools, materials and technology over time. It also reflects how European influence contributed to, rather than completely replaced, traditional Maori skills, as native materials were replaced or complemented by metals and, more recently, artificial materials. Today, commercial long-line fishermen around the world have begun using the circle-hook design‚Äîone that is nearly identical in appearance and function to the traditional matau. It appears that the advantages and improved catch-rates of this Maori technology have once again been recognised.</p>

  </section>

  <div id="divider" title="Drag to resize"></div>

  <section class="pane" id="right">
    <h3>Questions</h3>

    <div class="group">
      <h4>Questions 1‚Äì8</h4>
      <p>The reading passage has ten paragraphs labelled <strong>A‚ÄìJ</strong>.</p>
      <p>Which paragraph contains the following information?</p>
      <p>Write the correct letter <strong>A‚ÄìJ</strong> in boxes <strong>1‚Äì8</strong> on your answer sheet.</p>

      <ol start="1">
        <li><span class="flag-btn" data-q="q1" style="left:-20px;"></span>Instruction on how to recognise authentic Maori hooks from counterfeit ones<br>
          <div class="radio-grid">
              <label><input type="radio" name="q1" value="A">A</label> <label><input type="radio" name="q1" value="B">B</label> <label><input type="radio" name="q1" value="C">C</label> <label><input type="radio" name="q1" value="D">D</label> <label><input type="radio" name="q1" value="E">E</label> <label><input type="radio" name="q1" value="F">F</label> <label><input type="radio" name="q1" value="G">G</label> <label><input type="radio" name="q1" value="H">H</label> <label><input type="radio" name="q1" value="I">I</label> <label><input type="radio" name="q1" value="J">J</label>
          </div>
        </li>
        <li><span class="flag-btn" data-q="q2" style="left:-20px;"></span>A description of a different type of hooks that are not used to catch fish<br>
          <div class="radio-grid">
              <label><input type="radio" name="q2" value="A">A</label> <label><input type="radio" name="q2" value="B">B</label> <label><input type="radio" name="q2" value="C">C</label> <label><input type="radio" name="q2" value="D">D</label> <label><input type="radio" name="q2" value="E">E</label> <label><input type="radio" name="q2" value="F">F</label> <label><input type="radio" name="q2" value="G">G</label> <label><input type="radio" name="q2" value="H">H</label> <label><input type="radio" name="q2" value="I">I</label> <label><input type="radio" name="q2" value="J">J</label>
          </div>
        </li>
        <li><span class="flag-btn" data-q="q3" style="left:-20px;"></span>An acknowledgement that Maori design and craftsmanship are still relevant in the modern world<br>
          <div class="radio-grid">
              <label><input type="radio" name="q3" value="A">A</label> <label><input type="radio" name="q3" value="B">B</label> <label><input type="radio" name="q3" value="C">C</label> <label><input type="radio" name="q3" value="D">D</label> <label><input type="radio" name="q3" value="E">E</label> <label><input type="radio" name="q3" value="F">F</label> <label><input type="radio" name="q3" value="G">G</label> <label><input type="radio" name="q3" value="H">H</label> <label><input type="radio" name="q3" value="I">I</label> <label><input type="radio" name="q3" value="J">J</label>
          </div>
        </li>
        <li><span class="flag-btn" data-q="q4" style="left:-20px;"></span>An investigation into how the hooks functioned so effectively<br>
          <div class="radio-grid">
              <label><input type="radio" name="q4" value="A">A</label> <label><input type="radio" name="q4" value="B">B</label> <label><input type="radio" name="q4" value="C">C</label> <label><input type="radio" name="q4" value="D">D</label> <label><input type="radio" name="q4" value="E">E</label> <label><input type="radio" name="q4" value="F">F</label> <label><input type="radio" name="q4" value="G">G</label> <label><input type="radio" name="q4" value="H">H</label> <label><input type="radio" name="q4" value="I">I</label> <label><input type="radio" name="q4" value="J">J</label>
          </div>
        </li>
        <li><span class="flag-btn" data-q="q5" style="left:-20px;"></span>A description of how modern technology began to dominate and eventually took over from traditional hook construction<br>
          <div class="radio-grid">
              <label><input type="radio" name="q5" value="A">A</label> <label><input type="radio" name="q5" value="B">B</label> <label><input type="radio" name="q5" value="C">C</label> <label><input type="radio" name="q5" value="D">D</label> <label><input type="radio" name="q5" value="E">E</label> <label><input type="radio" name="q5" value="F">F</label> <label><input type="radio" name="q5" value="G">G</label> <label><input type="radio" name="q5" value="H">H</label> <label><input type="radio" name="q5" value="I">I</label> <label><input type="radio" name="q5" value="J">J</label>
          </div>
        </li>
        <li><span class="flag-btn" data-q="q6" style="left:-20px;"></span>A list of raw materials used to construct hooks<br>
          <div class="radio-grid">
              <label><input type="radio" name="q6" value="A">A</label> <label><input type="radio" name="q6" value="B">B</label> <label><input type="radio" name="q6" value="C">C</label> <label><input type="radio" name="q6" value="D">D</label> <label><input type="radio" name="q6" value="E">E</label> <label><input type="radio" name="q6" value="F">F</label> <label><input type="radio" name="q6" value="G">G</label> <label><input type="radio" name="q6" value="H">H</label> <label><input type="radio" name="q6" value="I">I</label> <label><input type="radio" name="q6" value="J">J</label>
          </div>
        </li>
        <li><span class="flag-btn" data-q="q7" style="left:-20px;"></span>An outline of how different styles of hooks and types of materials were employed to catch larger fish<br>
          <div class="radio-grid">
              <label><input type="radio" name="q7" value="A">A</label> <label><input type="radio" name="q7" value="B">B</label> <label><input type="radio" name="q7" value="C">C</label> <label><input type="radio" name="q7" value="D">D</label> <label><input type="radio" name="q7" value="E">E</label> <label><input type="radio" name="q7" value="F">F</label> <label><input type="radio" name="q7" value="G">G</label> <label><input type="radio" name="q7" value="H">H</label> <label><input type="radio" name="q7" value="I">I</label> <label><input type="radio" name="q7" value="J">J</label>
          </div>
        </li>
        <li><span class="flag-btn" data-q="q8" style="left:-20px;"></span>An account of how the Maori employed new technology and adapted it<br>
          <div class="radio-grid">
              <label><input type="radio" name="q8" value="A">A</label> <label><input type="radio" name="q8" value="B">B</label> <label><input type="radio" name="q8" value="C">C</label> <label><input type="radio" name="q8" value="D">D</label> <label><input type="radio" name="q8" value="E">E</label> <label><input type="radio" name="q8" value="F">F</label> <label><input type="radio" name="q8" value="G">G</label> <label><input type="radio" name="q8" value="H">H</label> <label><input type="radio" name="q8" value="I">I</label> <label><input type="radio" name="q8" value="J">J</label>
          </div>
        </li>
      </ol>
    </div>

    <div class="group">
      <h4>Questions 9‚Äì13</h4>
      <p>Do the following statements agree with the information given in Reading Passage 1?</p>
      <p>In boxes <strong>9‚Äì13</strong> on your answer sheet, write</p>
      <div style="margin-left:20px; margin-top:8px;">
        <div><strong>TRUE</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if the statement agrees with the information</div>
        <div><strong>FALSE</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if the statement contradicts the information</div>
        <div><strong>NOT GIVEN</strong>&nbsp;&nbsp;if there is no information on this</div>
      </div>

      <ol start="9">
        <li><span class="flag-btn" data-q="q9" style="left:-20px;"></span>The early European settlers quickly understood how the Maori fish hook worked.<br>
          <label><input type="radio" name="q9" value="TRUE"> TRUE</label>
          <label><input type="radio" name="q9" value="FALSE"> FALSE</label>
          <label><input type="radio" name="q9" value="NOT GIVEN"> NOT GIVEN</label>
        </li>
        <li><span class="flag-btn" data-q="q10" style="left:-20px;"></span>The hook works by making a hole and embedding itself in the mouth of the fish.<br>
          <label><input type="radio" name="q10" value="TRUE"> TRUE</label>
          <label><input type="radio" name="q10" value="FALSE"> FALSE</label>
          <label><input type="radio" name="q10" value="NOT GIVEN"> NOT GIVEN</label>
        </li>
        <li><span class="flag-btn" data-q="q11" style="left:-20px;"></span>The Maoris catch seabirds by their feet.<br>
          <label><input type="radio" name="q11" value="TRUE"> TRUE</label>
          <label><input type="radio" name="q11" value="FALSE"> FALSE</label>
          <label><input type="radio" name="q11" value="NOT GIVEN"> NOT GIVEN</label>
        </li>
        <li><span class="flag-btn" data-q="q12" style="left:-20px;"></span>There used to be a demand for Maori fish hooks and many counterfeit ones were produced.<br>
          <label><input type="radio" name="q12" value="TRUE"> TRUE</label>
          <label><input type="radio" name="q12" value="FALSE"> FALSE</label>
          <label><input type="radio" name="q12" value="NOT GIVEN"> NOT GIVEN</label>
        </li>
        <li><span class="flag-btn" data-q="q13" style="left:-20px;"></span>Today European-style hooks have completely replaced the traditional styles used by the Maoris.<br>
          <label><input type="radio" name="q13" value="TRUE"> TRUE</label>
          <label><input type="radio" name="q13" value="FALSE"> FALSE</label>
          <label><input type="radio" name="q13" value="NOT GIVEN"> NOT GIVEN</label>
        </li>
      </ol>
    </div>

    <div class="bottom-bar">
      <button class="btn-primary" onclick="submitAnswers()">Êèê‰∫§</button>
      <button onclick="resetForm()">ÈáçÁΩÆ</button>
      <button onclick="openWrongBook()">Êú¨ÁØáÈîôÈ¢ò</button>
    </div>
  </section>
</div>

<div id="selbar">
  <button id="btnNote">Note</button>
  <button id="btnHL">Highlight</button>
  <button id="btnUH" style="display:none;">Clear Highlight</button>
</div>

<div class="modal" id="resultModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>ÊàêÁª©</h2>
      <span class="modal-close" onclick="closeModal('resultModal')">√ó</span>
    </div>
    <div id="resultContent"></div>
    <button class="btn-primary" style="width:100%; margin-top:16px;" onclick="addWrongToBook()">Âä†ÂÖ•ÈîôÈ¢òÊú¨</button>
  </div>
</div>

<div class="modal" id="wrongBookModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Êú¨ÁØáÈîôÈ¢ò</h2>
      <span class="modal-close" onclick="closeModal('wrongBookModal')">√ó</span>
    </div>
    <div id="wrongBookContent"></div>
  </div>
</div>

<div class="modal" id="resetModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>ÈáçÁΩÆÁªÉ‰π†</h2>
      <span class="modal-close" onclick="closeModal('resetModal')">√ó</span>
    </div>
    <div style="margin:16px 0;">
      <label style="display:block; margin-bottom:10px;">
        <input type="radio" name="resetType" value="answers" checked>
        Âè™Ê∏ÖÁ©∫Á≠îÊ°à
      </label>
      <label style="display:block;">
        <input type="radio" name="resetType" value="all">
        Ê∏ÖÁ©∫Á≠îÊ°àÂíåÊ†áËÆ∞
      </label>
    </div>
    <button class="btn-primary" style="width:100%;" onclick="confirmReset()">Á°ÆÂÆö</button>
  </div>
</div>

<script>
const PAPER_ID='P1_MAORI_HOOKS';

let t=0;
const timerEl=document.getElementById('timer');
setInterval(()=>{ t++; timerEl.textContent=String(Math.floor(t/60)).padStart(2,'0')+':'+String(t%60).padStart(2,'0'); }, 1000);

const divider=document.getElementById('divider'), left=document.getElementById('left'), right=document.getElementById('right');
let dragging=false;
divider.onmousedown=()=>{ dragging=true; document.body.style.cursor='ew-resize'; };
window.onmousemove=(e)=>{ if(!dragging)return; const c=document.querySelector('.shell').getBoundingClientRect(); let x=e.clientX-c.left; x=Math.max(280,Math.min(c.width-280,x)); left.style.flex='0 0 '+x+'px'; right.style.flex='1 1 auto'; };
window.onmouseup=()=>{ dragging=false; document.body.style.cursor=''; };

const selbar=document.getElementById('selbar'), btnHL=document.getElementById('btnHL'), btnUH=document.getElementById('btnUH'), btnNote=document.getElementById('btnNote');
let lastRange=null, currentHlNode=null;

function posSelbar(r){ selbar.style.display='flex'; const t=window.scrollY+r.top-selbar.offsetHeight-8; const l=window.scrollX+r.left+r.width/2-selbar.offsetWidth/2; selbar.style.top=((t>0)?t:(window.scrollY+r.bottom+8))+'px'; selbar.style.left=Math.max(8,l)+'px'; }

function updSel(){ const s=window.getSelection(); if(!s||s.rangeCount===0||s.isCollapsed){ if(!currentHlNode)selbar.style.display='none'; return; } const r=s.getRangeAt(0); lastRange=r.cloneRange(); currentHlNode=null; btnNote.style.display='block'; btnHL.style.display='block'; btnUH.style.display='none'; posSelbar(r.getBoundingClientRect()); }

left.onmouseup=updSel; right.onmouseup=updSel;
document.onselectionchange=()=>{ const s=window.getSelection(); if((!s||s.rangeCount===0||s.isCollapsed)&&!currentHlNode)selbar.style.display='none'; };
document.addEventListener('click',(e)=>{ if(e.target.classList&&(e.target.classList.contains('hl')||e.target.classList.contains('note'))){ currentHlNode=e.target; lastRange=null; btnNote.style.display='none'; btnHL.style.display='none'; btnUH.style.display='block'; posSelbar(e.target.getBoundingClientRect()); const s=window.getSelection(); if(s)s.removeAllRanges(); }}, true);

btnHL.onclick=()=>{ if(currentHlNode||!lastRange||lastRange.collapsed)return; const s=document.createElement('span'); s.className='hl'; try{ lastRange.surroundContents(s); }catch(e){ const w=document.createElement('span'); w.className='hl'; w.appendChild(lastRange.cloneContents()); lastRange.deleteContents(); lastRange.insertNode(w); } selbar.style.display='none'; saveHighlights(); };

btnNote.onclick=()=>{ if(currentHlNode||!lastRange||lastRange.collapsed)return; const s=document.createElement('span'); s.className='note'; try{ lastRange.surroundContents(s); }catch(e){ const w=document.createElement('span'); w.className='note'; w.appendChild(lastRange.cloneContents()); lastRange.deleteContents(); lastRange.insertNode(w); } selbar.style.display='none'; saveHighlights(); };

btnUH.onclick=()=>{ if(currentHlNode){ const p=currentHlNode.parentNode; while(currentHlNode.firstChild)p.insertBefore(currentHlNode.firstChild,currentHlNode); p.removeChild(currentHlNode); p.normalize(); currentHlNode=null; selbar.style.display='none'; saveHighlights(); }else if(lastRange){ const sR=lastRange.getBoundingClientRect(); const w=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT); const tr=[]; while(w.nextNode()){ const n=w.currentNode; if(n.classList&&(n.classList.contains('hl')||n.classList.contains('note'))){ const r=n.getBoundingClientRect(); if(!(r.right<sR.left||r.left>sR.right||r.bottom<sR.top||r.top>sR.bottom))tr.push(n); }} tr.forEach(el=>{ const p=el.parentNode; while(el.firstChild)p.insertBefore(el.firstChild,el); p.removeChild(el); p.normalize(); }); selbar.style.display='none'; saveHighlights(); }};

document.querySelectorAll('.flag-btn').forEach(btn => {
  btn.onclick = e => {
    e.stopPropagation();
    btn.classList.toggle('active');
    saveFlags();
  };
});

const answerKey = {
  q1: "I",
  q2: "F",
  q3: "J",
  q4: "D",
  q5: "H",
  q6: "B",
  q7: "E",
  q8: "G",
  q9: "FALSE",
  q10: "FALSE",
  q11: "NOT GIVEN",
  q12: "TRUE",
  q13: "FALSE"
};
let lastResults=[];

function saveAnswers() {
  const data = {};
  Object.keys(answerKey).forEach(q => {
    const el = document.querySelector(`[name="${q}"]`);
    if(el) {
        if(el.type === 'radio') {
            const checked = document.querySelector(`input[name="${q}"]:checked`);
            if(checked) data[q] = checked.value;
        } else {
            data[q] = el.value;
        }
    } else {
        // Handle grouped radios (like Q1-Q8 matching)
        const checked = document.querySelector(`input[name="${q}"]:checked`);
        if(checked) data[q] = checked.value;
    }
  });
  localStorage.setItem(`${PAPER_ID}_answers`, JSON.stringify(data));
}

function loadAnswers() {
  const data = JSON.parse(localStorage.getItem(`${PAPER_ID}_answers`) || '{}');
  Object.keys(data).forEach(q => {
    const val = data[q];
    const radio = document.querySelector(`input[name="${q}"][value="${val}"]`);
    if(radio) {
        radio.checked = true;
    } else {
        const text = document.querySelector(`input[name="${q}"]`);
        if(text && text.type === 'text') text.value = val;
    }
  });
}

function saveFlags() {
  const flags = [...document.querySelectorAll('.flag-btn.active')].map(b => b.dataset.q);
  localStorage.setItem(`${PAPER_ID}_flags`, JSON.stringify(flags));
}

function loadFlags() {
  const flags = JSON.parse(localStorage.getItem(`${PAPER_ID}_flags`) || '[]');
  flags.forEach(q => document.querySelector(`[data-q="${q}"]`)?.classList.add('active'));
}

function saveHighlights() {
  const highlights = { left: [], right: [] };
  document.querySelectorAll('#left .hl, #left .note').forEach((el, idx) => {
    highlights.left.push({
      type: el.classList.contains('hl') ? 'hl' : 'note',
      text: el.textContent,
      index: idx
    });
  });
  document.querySelectorAll('#right .hl, #right .note').forEach((el, idx) => {
    highlights.right.push({
      type: el.classList.contains('hl') ? 'hl' : 'note',
      text: el.textContent,
      index: idx
    });
  });
  localStorage.setItem(`${PAPER_ID}_highlights`, JSON.stringify(highlights));
}

function loadHighlights() {
  const data = JSON.parse(localStorage.getItem(`${PAPER_ID}_highlights`) || '{"left":[],"right":[]}');
  
  const restore = (pane, items) => {
      if(!items || items.length === 0) return;
      items.forEach(item => {
        const walker = document.createTreeWalker(pane, NodeFilter.SHOW_TEXT);
        let node;
        while(node = walker.nextNode()) {
          if(node.textContent.includes(item.text)) {
            const span = document.createElement('span');
            span.className = item.type;
            const parent = node.parentNode;
            const text = node.textContent;
            const idx = text.indexOf(item.text);
            if(idx >= 0) {
              const before = text.substring(0, idx);
              const match = text.substring(idx, idx + item.text.length);
              const after = text.substring(idx + item.text.length);
              
              parent.insertBefore(document.createTextNode(before), node);
              span.textContent = match;
              parent.insertBefore(span, node);
              parent.insertBefore(document.createTextNode(after), node);
              parent.removeChild(node);
              break;
            }
          }
        }
      });
  };

  restore(left, data.left);
  restore(right, data.right);
}

document.querySelectorAll('input').forEach(input => {
  input.addEventListener('change', saveAnswers);
  input.addEventListener('input', saveAnswers);
});

document.addEventListener('DOMContentLoaded', () => {
  loadAnswers();
  loadFlags();
  loadHighlights();
});

function submitAnswers(){ 
    const res=[]; 
    let cor=0; 
    Object.keys(answerKey).forEach(q=>{ 
        let uA = "";
        const checked = document.querySelector(`input[name="${q}"]:checked`);
        if(checked) {
            uA = checked.value;
        } else {
            const textEl = document.querySelector(`input[name="${q}"]`);
            if(textEl && textEl.type === 'text') uA = textEl.value.trim();
        }
        
        const cA=answerKey[q]; 
        const iC = uA.toLowerCase() === cA.toLowerCase(); 
        if(iC) cor++; 
        res.push({id:q,userAns:uA,correctAns:cA,isCorrect:iC}); 
    }); 
    lastResults=res; 
    const tot=Object.keys(answerKey).length; 
    const pct=((cor/tot)*100).toFixed(1); 
    localStorage.setItem(`ielts_score_${PAPER_ID}`, `${cor}/${tot}`);
    document.getElementById('resultContent').innerHTML=`<div class="result-summary"><div class="result-score">${cor} / ${tot}</div><div style="margin-top:8px;font-size:18px;">${pct}%</div></div>${res.map(r=>`<div class="result-item ${r.isCorrect?'correct':'incorrect'}"><div><strong>${r.id}</strong> ${r.isCorrect?'‚úì':'‚úó'}</div><div>‰Ω†ÁöÑÁ≠îÊ°à: ${r.userAns||'(Êú™‰ΩúÁ≠î)'}</div>${!r.isCorrect?`<div>Ê≠£Á°ÆÁ≠îÊ°à: ${r.correctAns}</div>`:''}</div>`).join('')}`; 
    document.getElementById('resultModal').classList.add('active'); 
}

function resetForm(){ document.getElementById('resetModal').classList.add('active'); }

function confirmReset(){ 
  const tp=document.querySelector('input[name="resetType"]:checked').value; 
  document.querySelectorAll('input[type="radio"]').forEach(i=>i.checked=false); 
  document.querySelectorAll('input[type="text"]').forEach(i=>i.value='');
  localStorage.removeItem(`${PAPER_ID}_answers`);
  
  if(tp==='all'){ 
    document.querySelectorAll('.hl').forEach(el=>{ const p=el.parentNode; while(el.firstChild)p.insertBefore(el.firstChild,el); p.removeChild(el); p.normalize(); }); 
    document.querySelectorAll('.note').forEach(el=>{ const p=el.parentNode; while(el.firstChild)p.insertBefore(el.firstChild,el); p.removeChild(el); p.normalize(); }); 
    document.querySelectorAll('.flag-btn').forEach(b => b.classList.remove('active'));
    localStorage.removeItem(`${PAPER_ID}_highlights`);
    localStorage.removeItem(`${PAPER_ID}_flags`);
  } 
  closeModal('resetModal'); 
}

function addWrongToBook(){ const wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); const wr=lastResults.filter(r=>!r.isCorrect); wr.forEach(r=>{ const en={paperId:PAPER_ID,title:'Maori Fish Hooks',questionId:r.id,correctAnswer:r.correctAns,myAnswer:r.userAns||'(Êú™‰ΩúÁ≠î)',date:new Date().toISOString().split('T')[0]}; const ix=wb.findIndex(i=>i.paperId===en.paperId&&i.questionId===en.questionId); if(ix>=0)wb[ix]=en; else wb.push(en); }); localStorage.setItem('ielts_wrong_book',JSON.stringify(wb)); alert(`Â∑≤Ê∑ªÂä† ${wr.length} ÈÅìÈîôÈ¢ò`); closeModal('resultModal'); }

function deleteWrongItem(pId,qId){ if(!confirm('Á°ÆÂÆöÂà†Èô§ËøôÈÅìÈîôÈ¢òÔºü'))return; let wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); wb=wb.filter(i=>!(i.paperId===pId&&i.questionId===qId)); localStorage.setItem('ielts_wrong_book',JSON.stringify(wb)); openWrongBook(); }

function clearCurrentWrongBook(){ if(!confirm('Á°ÆÂÆöÊ∏ÖÁ©∫Êú¨ÁØáÊâÄÊúâÈîôÈ¢òÔºü'))return; let wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); wb=wb.filter(i=>i.paperId!==PAPER_ID); localStorage.setItem('ielts_wrong_book',JSON.stringify(wb)); openWrongBook(); }

function openWrongBook(){ const wb=JSON.parse(localStorage.getItem('ielts_wrong_book')||'[]'); const cu=wb.filter(i=>i.paperId===PAPER_ID); const ct=document.getElementById('wrongBookContent'); if(cu.length===0)ct.innerHTML='<div style="text-align:center;padding:40px;color:#666;">ÊöÇÊó†ÈîôÈ¢ò</div>'; else ct.innerHTML=`<div class="modal-actions"><button class="btn-danger" onclick="clearCurrentWrongBook()" style="width:100%;">üóëÔ∏è Ê∏ÖÁ©∫Êú¨ÁØáÈîôÈ¢ò</button></div>${cu.map(i=>`<div class="wrong-item"><div class="wrong-item-content"><div style="font-weight:600;margin-bottom:8px;">${i.questionId}</div><div style="font-size:13px;color:#666;"><div>‚úì Ê≠£Á°Æ: ${i.correctAnswer}</div><div style="color:#d32f2f;">‚úó ÊàëÁöÑ: ${i.myAnswer}</div></div></div><button class="btn-delete" onclick="deleteWrongItem('${i.paperId}','${i.questionId}')">Âà†Èô§</button></div>`).join('')}`; document.getElementById('wrongBookModal').classList.add('active'); }

function closeModal(id){ document.getElementById(id).classList.remove('active'); }
</script>
</body>
</html>