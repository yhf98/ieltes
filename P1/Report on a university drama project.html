<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>P1 ‚Äì Report on a university drama project</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
      }
      #timer {
        position: fixed;
        top: 12px;
        right: 12px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 16px;
        font-weight: 600;
        color: #0066cc;
        z-index: 1000;
      }
      .shell {
        display: flex;
        height: 100vh;
        width: 100%;
      }
      .pane {
        background: #fff;
        overflow: auto;
        padding: 24px;
      }
      #left {
        flex: 0 0 50%;
        border-right: 1px solid #ddd;
      }
      #right {
        flex: 1 1 auto;
        background: #fafafa;
      }
      #divider {
        flex: 0 0 5px;
        background: #ddd;
        cursor: ew-resize;
      }
      #divider:hover {
        background: #999;
      }
      h2,
      h3,
      h4 {
        margin: 0 0 12px;
        color: #333;
      }
      h2 {
        font-size: 20px;
      }
      h3 {
        font-size: 18px;
        color: #0066cc;
      }
      h4 {
        font-size: 15px;
        font-weight: 600;
        margin-top: 20px;
      }
      #left p {
        margin: 0 0 14px;
        line-height: 1.7;
        text-align: justify;
      }
      .group {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .group h4 {
        margin-top: 0;
        color: #0066cc;
      }
      .group p {
        margin: 8px 0;
        font-size: 14px;
        line-height: 1.6;
      }
      .flag-btn {
        position: absolute;
        left: 2px;
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ddd;
        cursor: pointer;
        z-index: 10;
      }
      .flag-btn:hover {
        background: #999;
      }
      .flag-btn.active {
        background: #ff5722;
      }
      .group ol {
        margin-left: 20px;
      }
      .group ol li {
        margin: 12px 0;
        font-size: 14px;
        line-height: 1.6;
        position: relative;
      }
      .group ol li label {
        display: inline-block;
        margin-right: 8px;
      }
      input[type="text"] {
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 14px;
        width: 160px;
        background: #fdfdfd;
      }
      input[type="text"]:focus {
        border-color: #0066cc;
        outline: none;
        background: #fff;
      }
      .flow-box {
        border: 1px solid #333;
        padding: 10px;
        margin: 8px 0;
        text-align: center;
        background: #fff;
        position: relative;
      }
      .flow-arrow {
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        color: #333;
        margin: -4px 0;
      }
      .bottom-bar {
        display: flex;
        gap: 10px;
        margin-top: 16px;
      }
      button {
        padding: 10px 20px;
        border: 1px solid #999;
        border-radius: 6px;
        background: #fff;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #f0f0f0;
      }
      .btn-primary {
        background: #0066cc;
        color: #fff;
        border-color: #0066cc;
      }
      .btn-primary:hover {
        background: #0052a3;
      }
      .btn-danger {
        background: #dc3545;
        color: #fff;
        border-color: #dc3545;
      }
      .btn-danger:hover {
        background: #c82333;
      }
      .hl {
        background: #fff59d;
        cursor: pointer;
      }
      .hl:hover {
        background: #ffeb3b;
      }
      .note {
        background: #b3d9ff;
        cursor: pointer;
      }
      .note:hover {
        background: #99ccff;
      }
      #selbar {
        position: fixed;
        display: none;
        z-index: 2000;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 8px;
        gap: 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        flex-direction: column;
        min-width: 120px;
      }
      #selbar button {
        background: #fff;
        color: #666;
        border: none;
        padding: 3px 0px;
        cursor: pointer;
        font-size: 14px;
        text-align: center;
        border-radius: 4px;
      }
      #selbar button:hover {
        background: #f5f5f5;
        color: #333;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 3000;
        align-items: center;
        justify-content: center;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: #fff;
        border-radius: 8px;
        padding: 24px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }
      .modal-header h2 {
        font-size: 28px;
        color: #333;
        margin: 0;
      }
      .modal-close {
        font-size: 32px;
        cursor: pointer;
        color: #999;
        line-height: 1;
      }
      .modal-close:hover {
        color: #333;
      }
      .result-summary {
        text-align: center;
        padding: 20px;
        background: #f0f0f0;
        margin-bottom: 16px;
        border-radius: 6px;
      }
      .result-score {
        font-size: 36px;
        font-weight: 600;
        color: #0066cc;
      }
      .result-item {
        padding: 10px;
        margin: 8px 0;
        border-left: 3px solid #ddd;
        background: #f9f9f9;
        font-size: 13px;
      }
      .result-item.correct {
        border-left-color: #28a745;
        background: #e8f5e9;
      }
      .result-item.incorrect {
        border-left-color: #dc3545;
        background: #ffebee;
      }
      .wrong-item {
        background: #fff3e0;
        padding: 16px;
        margin: 8px 0;
        border-radius: 8px;
        border-left: 4px solid #ff9800;
        display: flex;
        justify-content: space-between;
        align-items: start;
      }
      .wrong-item-content {
        flex: 1;
      }
      .btn-delete {
        background: #dc3545;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        margin-left: 12px;
      }
      .btn-delete:hover {
        background: #c82333;
      }
      .modal-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div id="timer">00:00</div>
    <div class="shell">
      <section class="pane" id="left">
        <h2>READING PASSAGE 1</h2>
        <p>
          You should spend about 20 minutes on Questions 1‚Äì13, which are based
          on Reading Passage 1 below.
        </p>
        <h3>Report on a university drama project</h3>
        <p style="font-style: italic">
          Drama student Imogen Clare-Wood describes a collaborative theatre
          project she took part in
        </p>
        <p>
          This project was born from discussions I had with other drama students
          about the kind of theatre productions we‚Äôd like to create. Although we
          had previously been involved in various university productions where
          we took on specific roles, such as costume designer, producer,
          director and so on, we now wanted to take a collaborative approach
          that was new to all of us. We wanted a project in which every voice
          would carry equal weight and everyone would be able to contribute to
          every aspect of the show. We decided that the way to achieve this
          feeling of collaboration would be to concentrate on the process by
          which the work emerged during auditions and rehearsals. We chose a
          play that we felt allowed varied interpretations ‚Äì Harold Pinter‚Äôs The
          Lover, a modern one-act play with just two characters. We decided we
          would use six actors cast as three different couples, and each pair
          would have a turn to perform on one of the three nights that the play
          was to be staged.
        </p>
        <p>
          The next step was to hold auditions in order to find six actors who
          felt the same way about the project as we did. We were anxious not to
          create an ‚Äúus-and-them‚Äù feeling to the auditions, since collective
          ownership of the project was crucial to our ideas. So we ran the first
          round of auditions as a series of workshops, which we kept very
          informal and relaxed. Then we recalled fifteen actors for the second
          round of auditions. At this stage we wanted the reactions and ideas to
          flow and be explored by the group in the form of a discussion. We were
          looking for actors who could encourage other people‚Äôs ideas but who
          were also eager to input their own thoughts. Possibly the hardest part
          of the whole process was sitting down afterwards and deciding on the
          final six actors who would take part in the project.
        </p>
        <p>
          Our initial rehearsals were dedicated to creating a strong group
          dynamic and to exploring some of the themes of the play without
          explicit reference to the script. One of the strongest tools we used
          for this was freewriting ‚Äì an exercise in which one person would read
          out a list of unconnected words and the rest of the group would clear
          their minds and simply write something in response to those words. We
          found it helped us to gain insight into the different ways our minds
          work. It also meant that we got to know each other very well, very
          quickly!
        </p>
        <p>
          It was only during the next phase of rehearsals that we finally began
          to work with the script. We had not yet decided on the pairings for
          the six actors at this point, and we had the non-actors on the team
          reading in addition to the people who would be doing the final
          performances. The whole team finally decided on the pairings of the
          actors by a vote, and, miraculously, it was a unanimous decision. The
          casting of the roles worked well and felt more natural than it had in
          any other show I‚Äôve worked on. I think the dynamic that we developed
          over the early rehearsals was crucial in giving us three such strong
          onstage relationships.
        </p>
        <p>
          Other decisions were made in much the same way. The publicity was the
          responsibility of one member of the team, but she asked everyone what
          they thought would be effective. She then made several different
          versions, and from these we chose the design we liked the most. The
          stage set was left more to the individual pairs of actors, but since a
          large part of the later rehearsals was observing and feeding back on
          the individual performances being created by each pair, everyone was
          able to help with set design. We initially planned that each pair
          would use the same stage set. However, due to the different ways they
          interpreted the script, it became important for the set to be adapted
          for each couple.
        </p>
        <p>
          In the final performances, it was surprising that despite the
          collaborative nature of the project, a range of very different
          interpretations emerged. This is, of course, partly due to the
          tragicomic nature of Pinter‚Äôs text, which allowed the pairs of actors
          to exploit these two disparate elements, tragedy and comedy, to
          different degrees.
        </p>
        <p>
          The question-and-answer session held after the show was perhaps the
          most rewarding part of the project. The questions that the audience
          asked were interesting and insightful, and certainly made everyone in
          the team think about what we‚Äôd been doing, what we‚Äôd wanted to achieve
          and whether we‚Äôd achieved it. We were asked, among other things, about
          how successful our collaborative ethic had been, how we‚Äôd ended up
          with three such different shows, how we‚Äôd overcome the initial
          ‚Äúproduction-team-versus-cast‚Äù divide, and how we would continue in the
          future.
        </p>
      </section>
      <div id="divider"></div>
      <section class="pane" id="right">
        <h3>Questions</h3>
        <div class="group">
          <h4>Questions 1‚Äì6</h4>
          <p>Complete the flow-chart below.</p>
          <p>
            Choose <strong>ONE WORD ONLY</strong> from the passage for each
            answer.
          </p>
          <h4 style="text-align: center">
            Stages in collaborative drama project
          </h4>
          <div class="flow-box">
            <strong>Origin of project</strong><br />
            Started with the wish for a collaborative project focusing on the
            <b>1</b> <input type="text" name="q1" /> of producing a play
            <span class="flag-btn" data-q="q1"></span>
          </div>
          <div class="flow-arrow">‚Üì</div>
          <div class="flow-box">
            <strong>Auditions</strong><br />
            first round: organised as several workshops ‚Äì fifteen actors were
            then selected<br />
            second round: organised as a <b>2</b>
            <input type="text" name="q2" /> ‚Äì the final six actors were then
            selected
            <span class="flag-btn" data-q="q2"></span>
          </div>
          <div class="flow-arrow">‚Üì</div>
          <div class="flow-box">
            <strong>Preparation</strong><br />
            in early rehearsals, <b>3</b> <input type="text" name="q3" /> was
            found to be an effective technique
            <span class="flag-btn" data-q="q3"></span><br />
            the <b>4</b> <input type="text" name="q4" /> was only used in later
            rehearsals <span class="flag-btn" data-q="q4"></span><br />
            everyone had a <b>5</b> <input type="text" name="q5" /> to decide
            which actor would play each part
            <span class="flag-btn" data-q="q5"></span><br />
            everyone was shown different designs for the publicity and the best
            one was chosen
          </div>
          <div class="flow-arrow">‚Üì</div>
          <div class="flow-box">
            <strong>Performance</strong><br />
            the variety of <b>6</b> <input type="text" name="q6" /> was
            surprising
            <span class="flag-btn" data-q="q6"></span>
          </div>
          <div class="flow-arrow">‚Üì</div>
          <div class="flow-box">
            <strong>After-show question-and-answer session</strong><br />
            this resulted in some interesting comments
          </div>
        </div>
        <div class="group">
          <h4>Questions 7‚Äì13</h4>
          <p>
            Do the following statements agree with the information given in
            Reading Passage 1?
          </p>
          <div style="margin: 8px 0 16px 20px">
            <div>
              <strong>TRUE</strong> if the statement agrees with the information
            </div>
            <div>
              <strong>FALSE</strong> if the statement contradicts the
              information
            </div>
            <div>
              <strong>NOT GIVEN</strong> if there is no information on this
            </div>
          </div>
          <ol start="7">
            <li>
              <span class="flag-btn" data-q="q7" style="left: -20px"></span>The
              writer had been involved in other collaborative theatre
              productions at university.<br />
              <label><input type="radio" name="q7" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q7" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q7" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q8" style="left: -20px"></span>Each
              actor chosen for the project would play one role for three
              nights.<br />
              <label><input type="radio" name="q8" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q8" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q8" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q9" style="left: -20px"></span>The
              early rehearsals took place at the university theatre.<br />
              <label><input type="radio" name="q9" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q9" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q9" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q10" style="left: -20px"></span>The
              writer felt satisfied that all the actors were paired with the
              right partner.<br />
              <label><input type="radio" name="q10" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q10" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q10" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q11" style="left: -20px"></span
              >Some team members discovered an unexpected talent for set
              design.<br />
              <label><input type="radio" name="q11" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q11" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q11" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q12" style="left: -20px"></span>The
              original intention was to use a different stage set for each
              performance.<br />
              <label><input type="radio" name="q12" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q12" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q12" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q13" style="left: -20px"></span>The
              question-and-answer session encouraged the team to think about
              their aims.<br />
              <label><input type="radio" name="q13" value="TRUE" /> TRUE</label>
              <label
                ><input type="radio" name="q13" value="FALSE" /> FALSE</label
              >
              <label
                ><input type="radio" name="q13" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
          </ol>
        </div>
        <div class="bottom-bar">
          <button class="btn-primary" onclick="submitAnswers()">Êèê‰∫§</button>
          <button onclick="resetForm()">ÈáçÁΩÆ</button>
          <button onclick="openWrongBook()">Êú¨ÁØáÈîôÈ¢ò</button>
        </div>
      </section>
    </div>
    <div id="selbar">
      <button id="btnNote">Note</button>
      <button id="btnHL">Highlight</button>
      <button id="btnUH" style="display: none">Clear Highlight</button>
    </div>
    <div class="modal" id="resultModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÊàêÁª©</h2>
          <span class="modal-close" onclick="closeModal('resultModal')">√ó</span>
        </div>
        <div id="resultContent"></div>
        <button
          class="btn-primary"
          style="width: 100%; margin-top: 16px"
          onclick="addWrongToBook()"
        >
          Âä†ÂÖ•ÈîôÈ¢òÊú¨
        </button>
      </div>
    </div>
    <div class="modal" id="wrongBookModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Êú¨ÁØáÈîôÈ¢ò</h2>
          <span class="modal-close" onclick="closeModal('wrongBookModal')"
            >√ó</span
          >
        </div>
        <div id="wrongBookContent"></div>
      </div>
    </div>
    <div class="modal" id="resetModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÈáçÁΩÆÁªÉ‰π†</h2>
          <span class="modal-close" onclick="closeModal('resetModal')">√ó</span>
        </div>
        <div style="margin: 16px 0">
          <label style="display: block; margin-bottom: 10px"
            ><input type="radio" name="resetType" value="answers" checked />
            Âè™Ê∏ÖÁ©∫Á≠îÊ°à</label
          >
          <label style="display: block"
            ><input type="radio" name="resetType" value="all" />
            Ê∏ÖÁ©∫Á≠îÊ°àÂíåÊ†áËÆ∞</label
          >
        </div>
        <button
          class="btn-primary"
          style="width: 100%"
          onclick="confirmReset()"
        >
          Á°ÆÂÆö
        </button>
      </div>
    </div>
    <script>
      const PAPER_ID = "P1_UNIVERSITY_DRAMA";
      let t = 0;
      const timerEl = document.getElementById("timer");
      setInterval(() => {
        t++;
        timerEl.textContent =
          String(Math.floor(t / 60)).padStart(2, "0") +
          ":" +
          String(t % 60).padStart(2, "0");
      }, 1000);
      const divider = document.getElementById("divider"),
        left = document.getElementById("left"),
        right = document.getElementById("right");
      let dragging = false;
      divider.onmousedown = () => {
        dragging = true;
        document.body.style.cursor = "ew-resize";
      };
      window.onmousemove = (e) => {
        if (!dragging) return;
        const c = document.querySelector(".shell").getBoundingClientRect();
        let x = e.clientX - c.left;
        x = Math.max(280, Math.min(c.width - 280, x));
        left.style.flex = "0 0 " + x + "px";
        right.style.flex = "1 1 auto";
      };
      window.onmouseup = () => {
        dragging = false;
        document.body.style.cursor = "";
      };
      const selbar = document.getElementById("selbar"),
        btnHL = document.getElementById("btnHL"),
        btnUH = document.getElementById("btnUH"),
        btnNote = document.getElementById("btnNote");
      let lastRange = null,
        currentHlNode = null;
      function posSelbar(r) {
        selbar.style.display = "flex";
        const t = window.scrollY + r.top - selbar.offsetHeight - 8;
        const l =
          window.scrollX + r.left + r.width / 2 - selbar.offsetWidth / 2;
        selbar.style.top = (t > 0 ? t : window.scrollY + r.bottom + 8) + "px";
        selbar.style.left = Math.max(8, l) + "px";
      }
      function updSel() {
        const s = window.getSelection();
        if (!s || s.rangeCount === 0 || s.isCollapsed) {
          if (!currentHlNode) selbar.style.display = "none";
          return;
        }
        const r = s.getRangeAt(0);
        lastRange = r.cloneRange();
        currentHlNode = null;
        btnNote.style.display = "block";
        btnHL.style.display = "block";
        btnUH.style.display = "none";
        posSelbar(r.getBoundingClientRect());
      }
      left.onmouseup = updSel;
      right.onmouseup = updSel;
      document.onselectionchange = () => {
        const s = window.getSelection();
        if ((!s || s.rangeCount === 0 || s.isCollapsed) && !currentHlNode)
          selbar.style.display = "none";
      };
      document.addEventListener(
        "click",
        (e) => {
          if (
            e.target.classList &&
            (e.target.classList.contains("hl") ||
              e.target.classList.contains("note"))
          ) {
            currentHlNode = e.target;
            lastRange = null;
            btnNote.style.display = "none";
            btnHL.style.display = "none";
            btnUH.style.display = "block";
            posSelbar(e.target.getBoundingClientRect());
            const s = window.getSelection();
            if (s) s.removeAllRanges();
          }
        },
        true
      );
      btnHL.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "hl";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "hl";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnNote.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "note";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "note";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };
      btnUH.onclick = () => {
        if (currentHlNode) {
          const p = currentHlNode.parentNode;
          while (currentHlNode.firstChild)
            p.insertBefore(currentHlNode.firstChild, currentHlNode);
          p.removeChild(currentHlNode);
          p.normalize();
          currentHlNode = null;
          selbar.style.display = "none";
          saveHighlights();
        } else if (lastRange) {
          const sR = lastRange.getBoundingClientRect();
          const w = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_ELEMENT
          );
          const tr = [];
          while (w.nextNode()) {
            const n = w.currentNode;
            if (
              n.classList &&
              (n.classList.contains("hl") || n.classList.contains("note"))
            ) {
              const r = n.getBoundingClientRect();
              if (
                !(
                  r.right < sR.left ||
                  r.left > sR.right ||
                  r.bottom < sR.top ||
                  r.top > sR.bottom
                )
              )
                tr.push(n);
            }
          }
          tr.forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          selbar.style.display = "none";
          saveHighlights();
        }
      };
      document.querySelectorAll(".flag-btn").forEach((btn) => {
        btn.onclick = (e) => {
          e.stopPropagation();
          btn.classList.toggle("active");
          saveFlags();
        };
      });
      const answerKey = {
        q1: "process",
        q2: "discussion",
        q3: "freewriting",
        q4: "script",
        q5: "vote",
        q6: "interpretations",
        q7: "FALSE",
        q8: "FALSE",
        q9: "NOT GIVEN",
        q10: "TRUE",
        q11: "NOT GIVEN",
        q12: "FALSE",
        q13: "TRUE",
      };
      let lastResults = [];
      function saveAnswers() {
        const data = {};
        Object.keys(answerKey).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) data[q] = radio.value;
          else if (text) data[q] = text.value;
        });
        localStorage.setItem(`${PAPER_ID}_answers`, JSON.stringify(data));
      }
      function loadAnswers() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_answers`) || "{}"
        );
        Object.keys(data).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][value="${data[q]}"]`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) radio.checked = true;
          else if (text) text.value = data[q];
        });
      }
      function saveFlags() {
        const flags = [...document.querySelectorAll(".flag-btn.active")].map(
          (b) => b.dataset.q
        );
        localStorage.setItem(`${PAPER_ID}_flags`, JSON.stringify(flags));
      }
      function loadFlags() {
        const flags = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_flags`) || "[]"
        );
        flags.forEach((q) =>
          document.querySelector(`[data-q="${q}"]`)?.classList.add("active")
        );
      }
      function saveHighlights() {
        const highlights = { left: [], right: [] };
        document
          .querySelectorAll("#left .hl, #left .note")
          .forEach((el, idx) => {
            highlights.left.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        document
          .querySelectorAll("#right .hl, #right .note")
          .forEach((el, idx) => {
            highlights.right.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        localStorage.setItem(
          `${PAPER_ID}_highlights`,
          JSON.stringify(highlights)
        );
      }
      function loadHighlights() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_highlights`) ||
            '{"left":[],"right":[]}'
        );
        const restore = (pane, items) => {
          if (!items || items.length === 0) return;
          items.forEach((item) => {
            const walker = document.createTreeWalker(
              pane,
              NodeFilter.SHOW_TEXT
            );
            let node;
            while ((node = walker.nextNode())) {
              if (node.textContent.includes(item.text)) {
                const span = document.createElement("span");
                span.className = item.type;
                const parent = node.parentNode;
                const text = node.textContent;
                const idx = text.indexOf(item.text);
                if (idx >= 0) {
                  const before = text.substring(0, idx);
                  const match = text.substring(idx, idx + item.text.length);
                  const after = text.substring(idx + item.text.length);
                  parent.insertBefore(document.createTextNode(before), node);
                  span.textContent = match;
                  parent.insertBefore(span, node);
                  parent.insertBefore(document.createTextNode(after), node);
                  parent.removeChild(node);
                  break;
                }
              }
            }
          });
        };
        restore(left, data.left);
        restore(right, data.right);
      }
      document.querySelectorAll("input").forEach((inp) => {
        inp.addEventListener("change", saveAnswers);
        if (inp.type === "text") inp.addEventListener("input", saveAnswers);
      });
      document.addEventListener("DOMContentLoaded", () => {
        loadAnswers();
        loadFlags();
        loadHighlights();
      });
      function submitAnswers() {
        const res = [];
        let cor = 0;
        Object.keys(answerKey).forEach((q) => {
          let uA = "";
          const radio = document.querySelector(
            `input[name="${q}"][type="radio"]:checked`
          );
          const text = document.querySelector(
            `input[name="${q}"][type="text"]`
          );
          if (radio) uA = radio.value;
          else if (text) uA = text.value.trim();
          const cA = answerKey[q];
          const iC = uA.toLowerCase() === cA.toLowerCase();
          if (iC) cor++;
          res.push({ id: q, userAns: uA, correctAns: cA, isCorrect: iC });
        });
        lastResults = res;
        const tot = Object.keys(answerKey).length;
        const pct = ((cor / tot) * 100).toFixed(1);
        localStorage.setItem(`ielts_score_${PAPER_ID}`, `${cor}/${tot}`);
        document.getElementById(
          "resultContent"
        ).innerHTML = `<div class="result-summary"><div class="result-score">${cor} / ${tot}</div><div style="margin-top:8px;font-size:18px;">${pct}%</div></div>${res
          .map(
            (r) =>
              `<div class="result-item ${
                r.isCorrect ? "correct" : "incorrect"
              }"><div><strong>${r.id}</strong> ${
                r.isCorrect ? "‚úì" : "‚úó"
              }</div><div>‰Ω†ÁöÑÁ≠îÊ°à: ${r.userAns || "(Êú™‰ΩúÁ≠î)"}</div>${
                !r.isCorrect ? `<div>Ê≠£Á°ÆÁ≠îÊ°à: ${r.correctAns}</div>` : ""
              }</div>`
          )
          .join("")}`;
        document.getElementById("resultModal").classList.add("active");
      }
      function resetForm() {
        document.getElementById("resetModal").classList.add("active");
      }
      function confirmReset() {
        const tp = document.querySelector(
          'input[name="resetType"]:checked'
        ).value;
        document.querySelectorAll("input").forEach((i) => {
          if (i.type === "radio") i.checked = false;
          if (i.type === "text") i.value = "";
        });
        localStorage.removeItem(`${PAPER_ID}_answers`);
        if (tp === "all") {
          document.querySelectorAll(".hl").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document.querySelectorAll(".note").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document
            .querySelectorAll(".flag-btn")
            .forEach((b) => b.classList.remove("active"));
          localStorage.removeItem(`${PAPER_ID}_highlights`);
          localStorage.removeItem(`${PAPER_ID}_flags`);
        }
        closeModal("resetModal");
      }
      function addWrongToBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const wr = lastResults.filter((r) => !r.isCorrect);
        wr.forEach((r) => {
          const en = {
            paperId: PAPER_ID,
            title: "Report on a university drama project",
            questionId: r.id,
            correctAnswer: r.correctAns,
            myAnswer: r.userAns || "(Êú™‰ΩúÁ≠î)",
            date: new Date().toISOString().split("T")[0],
          };
          const ix = wb.findIndex(
            (i) => i.paperId === en.paperId && i.questionId === en.questionId
          );
          if (ix >= 0) wb[ix] = en;
          else wb.push(en);
        });
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        alert(`Â∑≤Ê∑ªÂä† ${wr.length} ÈÅìÈîôÈ¢ò`);
        closeModal("resultModal");
      }
      function deleteWrongItem(pId, qId) {
        if (!confirm("Á°ÆÂÆöÂà†Èô§ËøôÈÅìÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => !(i.paperId === pId && i.questionId === qId));
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function clearCurrentWrongBook() {
        if (!confirm("Á°ÆÂÆöÊ∏ÖÁ©∫Êú¨ÁØáÊâÄÊúâÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => i.paperId !== PAPER_ID);
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }
      function openWrongBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const cu = wb.filter((i) => i.paperId === PAPER_ID);
        const ct = document.getElementById("wrongBookContent");
        if (cu.length === 0)
          ct.innerHTML =
            '<div style="text-align:center;padding:40px;color:#666;">ÊöÇÊó†ÈîôÈ¢ò</div>';
        else
          ct.innerHTML = `<div class="modal-actions"><button class="btn-danger" onclick="clearCurrentWrongBook()" stylewidth:100%;">üóëÔ∏è Ê∏ÖÁ©∫Êú¨ÁØáÈîôÈ¢ò</button></div>${cu
            .map(
              (i) =>
                `<div class="wrong-item"><div class="wrong-item-content"><div style="font-weight:600;margin-bottom:8px;">${i.questionId}</div><div style="font-size:13px;color:#666;"><div>‚úì Ê≠£Á°Æ: ${i.correctAnswer}</div><div style="color:#d32f2f;">‚úó ÊàëÁöÑ: ${i.myAnswer}</div></div></div><button class="btn-delete" onclick="deleteWrongItem('${i.paperId}','${i.questionId}')">Âà†Èô§</button></div>`
            )
            .join("")}`;
        document.getElementById("wrongBookModal").classList.add("active");
      }
      function closeModal(id) {
        document.getElementById(id).classList.remove("active");
      }
    </script>
  </body>
</html>
