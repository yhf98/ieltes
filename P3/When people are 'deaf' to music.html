<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>P3 ‚Äì When people are ‚Äòdeaf‚Äô to music</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
      }
      #timer {
        position: fixed;
        top: 12px;
        right: 12px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 16px;
        font-weight: 600;
        color: #0066cc;
        z-index: 1000;
      }
      .shell {
        display: flex;
        height: 100vh;
        width: 100%;
      }
      .pane {
        background: #fff;
        overflow: auto;
        padding: 24px;
      }
      #left {
        flex: 0 0 50%;
        border-right: 1px solid #ddd;
      }
      #right {
        flex: 1 1 auto;
        background: #fafafa;
      }
      #divider {
        flex: 0 0 5px;
        background: #ddd;
        cursor: ew-resize;
      }
      #divider:hover {
        background: #999;
      }
      h2,
      h3,
      h4 {
        margin: 0 0 12px;
        color: #333;
      }
      h2 {
        font-size: 20px;
      }
      h3 {
        font-size: 18px;
        color: #0066cc;
      }
      h4 {
        font-size: 15px;
        font-weight: 600;
        margin-top: 20px;
      }
      #left p {
        margin: 0 0 14px;
        line-height: 1.7;
        text-align: justify;
      }
      .group {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 16px;
        margin-bottom: 16px;
      }
      .group h4 {
        margin-top: 0;
        color: #0066cc;
      }
      .group p {
        margin: 8px 0;
        font-size: 14px;
        line-height: 1.6;
      }
      .headings {
        background: #f9f9f9;
        padding: 12px;
        margin: 12px 0;
        border-radius: 4px;
      }
      .headings ol {
        margin-left: 20px;
      }
      .headings li {
        margin: 4px 0;
        font-size: 13px;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        margin: 12px 0;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 6px;
        text-align: center;
        font-size: 13px;
        position: relative;
      }
      th {
        background: #f5f5f5;
        font-weight: 600;
      }
      .flag-btn {
        position: absolute;
        left: 2px;
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #ddd;
        cursor: pointer;
        z-index: 10;
      }
      .flag-btn:hover {
        background: #999;
      }
      .flag-btn.active {
        background: #ff5722;
      }
      tr td:first-child {
        padding-left: 16px;
      }
      .group ol {
        margin-left: 20px;
      }
      .group ol li {
        margin: 12px 0;
        font-size: 14px;
        line-height: 1.6;
        position: relative;
      }
      .group ol li label {
        display: inline-block;
        margin-right: 8px;
      }
      .bottom-bar {
        display: flex;
        gap: 10px;
        margin-top: 16px;
      }
      button {
        padding: 10px 20px;
        border: 1px solid #999;
        border-radius: 6px;
        background: #fff;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #f0f0f0;
      }
      .btn-primary {
        background: #0066cc;
        color: #fff;
        border-color: #0066cc;
      }
      .btn-primary:hover {
        background: #0052a3;
      }
      .btn-danger {
        background: #dc3545;
        color: #fff;
        border-color: #dc3545;
      }
      .btn-danger:hover {
        background: #c82333;
      }
      .hl {
        background: #fff59d;
        cursor: pointer;
      }
      .hl:hover {
        background: #ffeb3b;
      }
      .note {
        background: #b3d9ff;
        cursor: pointer;
      }
      .note:hover {
        background: #99ccff;
      }
      #selbar {
        position: fixed;
        display: none;
        z-index: 2000;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 8px;
        gap: 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        flex-direction: column;
        min-width: 120px;
      }
      #selbar button {
        background: #fff;
        color: #666;
        border: none;
        padding: 3px 0px;
        cursor: pointer;
        font-size: 14px;
        text-align: center;
        border-radius: 4px;
      }
      #selbar button:hover {
        background: #f5f5f5;
        color: #333;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 3000;
        align-items: center;
        justify-content: center;
      }
      .modal.active {
        display: flex;
      }
      .modal-content {
        background: #fff;
        border-radius: 8px;
        padding: 24px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }
      .modal-header h2 {
        font-size: 28px;
        color: #333;
        margin: 0;
      }
      .modal-close {
        font-size: 32px;
        cursor: pointer;
        color: #999;
        line-height: 1;
      }
      .modal-close:hover {
        color: #333;
      }
      .result-summary {
        text-align: center;
        padding: 20px;
        background: #f0f0f0;
        margin-bottom: 16px;
        border-radius: 6px;
      }
      .result-score {
        font-size: 36px;
        font-weight: 600;
        color: #0066cc;
      }
      .result-item {
        padding: 10px;
        margin: 8px 0;
        border-left: 3px solid #ddd;
        background: #f9f9f9;
        font-size: 13px;
      }
      .result-item.correct {
        border-left-color: #28a745;
        background: #e8f5e9;
      }
      .result-item.incorrect {
        border-left-color: #dc3545;
        background: #ffebee;
      }
      .wrong-item {
        background: #fff3e0;
        padding: 16px;
        margin: 8px 0;
        border-radius: 8px;
        border-left: 4px solid #ff9800;
        display: flex;
        justify-content: space-between;
        align-items: start;
      }
      .wrong-item-content {
        flex: 1;
      }
      .btn-delete {
        background: #dc3545;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        margin-left: 12px;
      }
      .btn-delete:hover {
        background: #c82333;
      }
      .modal-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      /* Extra style for matching options box */
      .options-box {
        border: 1px solid #ccc;
        padding: 10px;
        background: #fafafa;
        margin-bottom: 15px;
        border-radius: 4px;
        font-size: 13px;
      }
      .options-box ul {
        list-style: none;
        padding-left: 5px;
      }
      .options-box li {
        margin-bottom: 4px;
      }
      .options-box strong {
        display: inline-block;
        width: 20px;
        color: #0066cc;
      }
    </style>
  </head>
  <body>
    <div id="timer">00:00</div>
    <div class="shell">
      <section class="pane" id="left">
        <h2>READING PASSAGE 3</h2>
        <p>
          You should spend about 20 minutes on Questions 27‚Äì40, which are based
          on Reading Passage 3 below.
        </p>
        <h3>When people are ‚Äòdeaf‚Äô to music</h3>
        <p>
          Music has long been considered a uniquely human concept. In fact, most
          psychologists agree that music is a universal human instinct. Like any
          ability, however, there is great variation in people‚Äôs musical
          competence. For every brilliant pianist in the world, there are
          several people we refer to as ‚Äòtone deaf‚Äô. It is not simply that
          people with tone deafness (or ‚Äòamusia‚Äô) are unable to sing in tune,
          they are also unable to discriminate between tones or recognize
          familiar melodies. Such a ‚Äòdisorder‚Äô can occur after some sort of
          brain damage, but recently research has been undertaken in an attempt
          to discover the cause of congenital amusia (when people are born with
          the condition), which is not associated with any brain damage, hearing
          problems, or lack of exposure to music.
        </p>
        <p>
          According to the research of Dr. Isabelle Peretz of the University of
          Montreal, amusia is more complicated than the inability to distinguish
          pitches. An amusic (a person who has the condition of amusia) can
          distinguish between two pitches that are far apart, but cannot tell
          the difference between intervals smaller than a half step on the
          Western diatonic scale, while most people can easily distinguish
          differences smaller than that. When listening to melodies which have
          had a single note altered so that it is out of key with the rest of
          the melody, they do not notice a problem. As would be expected,
          amusics perform significantly worse at singing and tapping a rhythm
          along with a melody than do non-amusics.
        </p>
        <p>
          The most fascinating aspect of amusia is how specific to music it is.
          Because of music‚Äôs close ties to language, it might be expected that a
          musical impairment may be caused by a language impairment. Studies
          suggest, however, that language and music ability are independent of
          one another. People with brain damage in areas critical to language
          are often still able to sing, despite being unable to communicate
          through speech. Moreover, while amusics show deficiencies in their
          recognition of pitch differences in melodies, they show no such
          deficiencies in tonal languages. Amusics who speak tonal languages,
          such as Chinese, do not report having any difficulty discriminating
          between words that differ only in their intonation. The linguistic
          cues inherent in speech make discrimination of meaning much easier for
          amusics. Amusics are also successful most of the time at detecting the
          mood of a melody, can identify a speaker based on his or her voice and
          can discriminate and identify environmental sounds.
        </p>
        <p>
          Recent work has been focused on locating the part of the brain that is
          responsible for amusia. The temporal lobes of the brain, the location
          of the primary auditory cortex, have been considered. It has long been
          believed that the temporal lobes, especially the right temporal lobe,
          are most active when engaged in musical activity, so any musical
          disability should logically stem from here as well. Because it has
          been shown that there is no hearing deficit in amusia, researchers
          moved on to the temporal neocortex, which is where more sophisticated
          processing of musical cues was thought to take place. New studies,
          however, have suggested that the deficits in amusics are located
          outside the auditory cortex. Brain scans of amusics do not show any
          reaction at all to differences smaller than a half step. When changes
          in tones are large, their brains overreact, showing twice as much
          activity on the right side of the brain as a normal brain hearing the
          same thing. These differences do not occur in the auditory cortex,
          indicating again that the deficits of amusia lie not in hearing
          impairment, but in higher processing of melodies.
        </p>
        <p>
          So what does this all mean? Looking only at the research of Peretz in
          the field of neuropsychology of music, it would appear that amusia is
          some sort of disorder. As a student of neurobiology, however, I am
          skeptical. Certainly the studies by Peretz that have found significant
          differences between the brains of so-called amusics and normal brains
          are legitimate. The more important question now becomes one of
          normality. Every trait from skin color to intelligence to mood exists
          on a continuum‚Äîthere is a great deal of variation from one extreme to
          the other. Just because we recognize that basic musical ability is
          something that the vast majority of people have, this doesn‚Äôt mean
          that the lack of it is abnormal.
        </p>
        <p>
          What makes an amusic worse off than a musical prodigy? Musical ability
          is culturally valued, and may have been a factor in survival at one
          point in human history, but it does not seem likely that it is being
          selected for on an evolutionary scale any longer. Darwin believed that
          music was adaptive as a way of finding a mate, but who needs to be
          able to sing to find a partner in an age when it is possible to
          express your emotions through a song on your iPod?
        </p>
        <p>
          While the idea of amusia is interesting, it seems to be just one end
          of the continuum of innate musical ability. Comparing this ‚Äòdisorder‚Äô
          to learning disorders like a specific language impairment seems to be
          going too far. Before amusia can be declared a disability, further
          research must be done to determine whether lack of musical ability is
          actually detrimental in any way. If no disadvantages can be found of
          having amusia, then it is no more a disability than having poor
          fashion sense or bad handwriting.
        </p>
      </section>
      <div id="divider" title="Drag to resize"></div>
      <section class="pane" id="right">
        <h3>Questions</h3>
        <div class="group">
          <h4>Questions 27‚Äì31</h4>
          <p>
            Choose the correct letter, <strong>A, B, C</strong> or
            <strong>D</strong>.
          </p>
          <p>
            Write the correct letter in boxes <strong>27‚Äì31</strong> on your
            answer sheet.
          </p>

          <ol start="27">
            <li>
              <span class="flag-btn" data-q="q27" style="left: -20px"></span
              >What does the writer tell us about people with tone deafness
              (amusia) in the first paragraph?<br />
              <label><input type="radio" name="q27" value="A" /> A</label> They
              usually have hearing problems<br />
              <label><input type="radio" name="q27" value="B" /> B</label> Some
              can play a musical instrument very well<br />
              <label><input type="radio" name="q27" value="C" /> C</label> Some
              may be able to sing well-known melodies<br />
              <label><input type="radio" name="q27" value="D" /> D</label> They
              have several inabilities in regard to music
            </li>
            <li>
              <span class="flag-btn" data-q="q28" style="left: -20px"></span
              >What is the writer doing in the second paragraph?<br />
              <label><input type="radio" name="q28" value="A" /> A</label>
              outlining some of the factors that cause amusia<br />
              <label><input type="radio" name="q28" value="B" /> B</label>
              summarising some findings about people with amusia<br />
              <label><input type="radio" name="q28" value="C" /> C</label>
              suggesting that people with amusia are disadvantaged<br />
              <label><input type="radio" name="q28" value="D" /> D</label>
              comparing the singing ability of amusics with their sense
            </li>
            <li>
              <span class="flag-btn" data-q="q29" style="left: -20px"></span
              >What does the writer say about the relationship between language
              ability and musical ability?<br />
              <label><input type="radio" name="q29" value="A" /> A</label>
              People who are unable to speak can sometimes sing<br />
              <label><input type="radio" name="q29" value="B" /> B</label>
              People with amusia usually have language problems too<br />
              <label><input type="radio" name="q29" value="C" /> C</label>
              Speakers of tonal languages like Chinese rarely have amusia<br />
              <label><input type="radio" name="q29" value="D" /> D</label>
              People with amusia have difficulty recognizing people by their
              voices
            </li>
            <li>
              <span class="flag-btn" data-q="q30" style="left: -20px"></span>In
              the third paragraph, the writer notes that most amusics are able
              to<br />
              <label><input type="radio" name="q30" value="A" /> A</label> learn
              how to sing in tune<br />
              <label><input type="radio" name="q30" value="B" /> B</label>
              identify a song by its tune<br />
              <label><input type="radio" name="q30" value="C" /> C</label>
              distinguish a sad tone from a happy tune<br />
              <label><input type="radio" name="q30" value="D" /> D</label>
              recognise when a singer is not singing in tune
            </li>
            <li>
              <span class="flag-btn" data-q="q31" style="left: -20px"></span
              >What is the writer doing in the fourth paragraph?<br />
              <label><input type="radio" name="q31" value="A" /> A</label>
              claiming that amusics have problems in the auditory cortex<br />
              <label><input type="radio" name="q31" value="B" /> B</label>
              outlining progress in understanding the brains of amusics<br />
              <label><input type="radio" name="q31" value="C" /> C</label>
              proving that amusia is located in the temporal lobes<br />
              <label><input type="radio" name="q31" value="D" /> D</label>
              explaining why studies of hearing are difficult
            </li>
          </ol>
        </div>

        <div class="group">
          <h4>Questions 32‚Äì35</h4>
          <p>
            Do the following statements agree with the views of the writer in
            Reading Passage 3?
          </p>
          <p>In boxes <strong>32‚Äì35</strong> on your answer sheet, write</p>
          <div style="margin-left: 20px; margin-top: 8px">
            <div>
              <strong>YES</strong
              >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if
              the statement agrees with the views of the writer
            </div>
            <div>
              <strong>NO</strong
              >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if
              the statement contradicts the views of the writer
            </div>
            <div>
              <strong>NOT GIVEN</strong>&nbsp;&nbsp;if it is impossible to say
              what the writer thinks about this
            </div>
          </div>

          <ol start="32">
            <li>
              <span class="flag-btn" data-q="q32" style="left: -20px"></span
              >Peretz‚Äôs research suggesting that amusia is a disorder is
              convincing.<br />
              <label><input type="radio" name="q32" value="YES" /> YES</label>
              <label><input type="radio" name="q32" value="NO" /> NO</label>
              <label
                ><input type="radio" name="q32" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q33" style="left: -20px"></span
              >People with musical ability are happier than those without this
              ability.<br />
              <label><input type="radio" name="q33" value="YES" /> YES</label>
              <label><input type="radio" name="q33" value="NO" /> NO</label>
              <label
                ><input type="radio" name="q33" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q34" style="left: -20px"></span>It
              is inappropriate to consider amusia as a real disorder.<br />
              <label><input type="radio" name="q34" value="YES" /> YES</label>
              <label><input type="radio" name="q34" value="NO" /> NO</label>
              <label
                ><input type="radio" name="q34" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
            <li>
              <span class="flag-btn" data-q="q35" style="left: -20px"></span
              >People with amusia often have bad handwriting.<br />
              <label><input type="radio" name="q35" value="YES" /> YES</label>
              <label><input type="radio" name="q35" value="NO" /> NO</label>
              <label
                ><input type="radio" name="q35" value="NOT GIVEN" /> NOT
                GIVEN</label
              >
            </li>
          </ol>
        </div>

        <div class="group">
          <h4>Questions 36‚Äì40</h4>
          <p>
            Complete each sentence with the correct ending,
            <strong>A‚ÄìH</strong>, below.
          </p>
          <p>
            Write the correct letter, <strong>A‚ÄìH</strong>, in boxes
            <strong>36‚Äì40</strong> on your answer sheet.
          </p>

          <div class="options-box">
            <ul>
              <li>
                <strong>A</strong> an inability to hear when spoken language
                rises and falls.
              </li>
              <li><strong>B</strong> considered to be desirable.</li>
              <li>
                <strong>C</strong> an inability to follow the beat of music.
              </li>
              <li><strong>D</strong> not a problem.</li>
              <li><strong>E</strong> not yet well understood.</li>
              <li><strong>F</strong> a result of injury to the mother.</li>
              <li><strong>G</strong> more marked than with other people.</li>
              <li><strong>H</strong> associated with intelligence.</li>
            </ul>
          </div>

          <ol start="36">
            <li>
              <span class="flag-btn" data-q="q36" style="left: -20px"></span>The
              reason why some people are born with amusia is<br />
              <label><input type="radio" name="q36" value="A" /> A</label>
              <label><input type="radio" name="q36" value="B" /> B</label>
              <label><input type="radio" name="q36" value="C" /> C</label>
              <label><input type="radio" name="q36" value="D" /> D</label>
              <label><input type="radio" name="q36" value="E" /> E</label>
              <label><input type="radio" name="q36" value="F" /> F</label>
              <label><input type="radio" name="q36" value="G" /> G</label>
              <label><input type="radio" name="q36" value="H" /> H</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q37" style="left: -20px"></span>One
              of the difficulties amusics experience is<br />
              <label><input type="radio" name="q37" value="A" /> A</label>
              <label><input type="radio" name="q37" value="B" /> B</label>
              <label><input type="radio" name="q37" value="C" /> C</label>
              <label><input type="radio" name="q37" value="D" /> D</label>
              <label><input type="radio" name="q37" value="E" /> E</label>
              <label><input type="radio" name="q37" value="F" /> F</label>
              <label><input type="radio" name="q37" value="G" /> G</label>
              <label><input type="radio" name="q37" value="H" /> H</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q38" style="left: -20px"></span>For
              amusics, discrimination of meaning in speech is<br />
              <label><input type="radio" name="q38" value="A" /> A</label>
              <label><input type="radio" name="q38" value="B" /> B</label>
              <label><input type="radio" name="q38" value="C" /> C</label>
              <label><input type="radio" name="q38" value="D" /> D</label>
              <label><input type="radio" name="q38" value="E" /> E</label>
              <label><input type="radio" name="q38" value="F" /> F</label>
              <label><input type="radio" name="q38" value="G" /> G</label>
              <label><input type="radio" name="q38" value="H" /> H</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q39" style="left: -20px"></span
              >Certain reactions in the brain of an amusic are<br />
              <label><input type="radio" name="q39" value="A" /> A</label>
              <label><input type="radio" name="q39" value="B" /> B</label>
              <label><input type="radio" name="q39" value="C" /> C</label>
              <label><input type="radio" name="q39" value="D" /> D</label>
              <label><input type="radio" name="q39" value="E" /> E</label>
              <label><input type="radio" name="q39" value="F" /> F</label>
              <label><input type="radio" name="q39" value="G" /> G</label>
              <label><input type="radio" name="q39" value="H" /> H</label>
            </li>
            <li>
              <span class="flag-btn" data-q="q40" style="left: -20px"></span>In
              most cultures, musical ability is<br />
              <label><input type="radio" name="q40" value="A" /> A</label>
              <label><input type="radio" name="q40" value="B" /> B</label>
              <label><input type="radio" name="q40" value="C" /> C</label>
              <label><input type="radio" name="q40" value="D" /> D</label>
              <label><input type="radio" name="q40" value="E" /> E</label>
              <label><input type="radio" name="q40" value="F" /> F</label>
              <label><input type="radio" name="q40" value="G" /> G</label>
              <label><input type="radio" name="q40" value="H" /> H</label>
            </li>
          </ol>
        </div>

        <div class="bottom-bar">
          <button class="btn-primary" onclick="submitAnswers()">Êèê‰∫§</button>
          <button onclick="resetForm()">ÈáçÁΩÆ</button>
          <button onclick="openWrongBook()">Êú¨ÁØáÈîôÈ¢ò</button>
        </div>
      </section>
    </div>
    <div id="selbar">
      <button id="btnNote">Note</button>
      <button id="btnHL">Highlight</button>
      <button id="btnUH" style="display: none">Clear Highlight</button>
    </div>
    <div class="modal" id="resultModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÊàêÁª©</h2>
          <span class="modal-close" onclick="closeModal('resultModal')">√ó</span>
        </div>
        <div id="resultContent"></div>
        <button
          class="btn-primary"
          style="width: 100%; margin-top: 16px"
          onclick="addWrongToBook()"
        >
          Âä†ÂÖ•ÈîôÈ¢òÊú¨
        </button>
      </div>
    </div>
    <div class="modal" id="wrongBookModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Êú¨ÁØáÈîôÈ¢ò</h2>
          <span class="modal-close" onclick="closeModal('wrongBookModal')"
            >√ó</span
          >
        </div>
        <div id="wrongBookContent"></div>
      </div>
    </div>
    <div class="modal" id="resetModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ÈáçÁΩÆÁªÉ‰π†</h2>
          <span class="modal-close" onclick="closeModal('resetModal')">√ó</span>
        </div>
        <div style="margin: 16px 0">
          <label style="display: block; margin-bottom: 10px">
            <input type="radio" name="resetType" value="answers" checked />
            Âè™Ê∏ÖÁ©∫Á≠îÊ°à
          </label>
          <label style="display: block">
            <input type="radio" name="resetType" value="all" />
            Ê∏ÖÁ©∫Á≠îÊ°àÂíåÊ†áËÆ∞
          </label>
        </div>
        <button
          class="btn-primary"
          style="width: 100%"
          onclick="confirmReset()"
        >
          Á°ÆÂÆö
        </button>
      </div>
    </div>
    <script>
      const PAPER_ID = "P3_DEAF_TO_MUSIC";

      let t = 0;
      const timerEl = document.getElementById("timer");
      setInterval(() => {
        t++;
        timerEl.textContent =
          String(Math.floor(t / 60)).padStart(2, "0") +
          ":" +
          String(t % 60).padStart(2, "0");
      }, 1000);

      const divider = document.getElementById("divider"),
        left = document.getElementById("left"),
        right = document.getElementById("right");
      let dragging = false;
      divider.onmousedown = () => {
        dragging = true;
        document.body.style.cursor = "ew-resize";
      };
      window.onmousemove = (e) => {
        if (!dragging) return;
        const c = document.querySelector(".shell").getBoundingClientRect();
        let x = e.clientX - c.left;
        x = Math.max(280, Math.min(c.width - 280, x));
        left.style.flex = "0 0 " + x + "px";
        right.style.flex = "1 1 auto";
      };
      window.onmouseup = () => {
        dragging = false;
        document.body.style.cursor = "";
      };

      const selbar = document.getElementById("selbar"),
        btnHL = document.getElementById("btnHL"),
        btnUH = document.getElementById("btnUH"),
        btnNote = document.getElementById("btnNote");
      let lastRange = null,
        currentHlNode = null;

      function posSelbar(r) {
        selbar.style.display = "flex";
        const t = window.scrollY + r.top - selbar.offsetHeight - 8;
        const l =
          window.scrollX + r.left + r.width / 2 - selbar.offsetWidth / 2;
        selbar.style.top = (t > 0 ? t : window.scrollY + r.bottom + 8) + "px";
        selbar.style.left = Math.max(8, l) + "px";
      }

      function updSel() {
        const s = window.getSelection();
        if (!s || s.rangeCount === 0 || s.isCollapsed) {
          if (!currentHlNode) selbar.style.display = "none";
          return;
        }
        const r = s.getRangeAt(0);
        lastRange = r.cloneRange();
        currentHlNode = null;
        btnNote.style.display = "block";
        btnHL.style.display = "block";
        btnUH.style.display = "none";
        posSelbar(r.getBoundingClientRect());
      }

      left.onmouseup = updSel;
      right.onmouseup = updSel;
      document.onselectionchange = () => {
        const s = window.getSelection();
        if ((!s || s.rangeCount === 0 || s.isCollapsed) && !currentHlNode)
          selbar.style.display = "none";
      };
      document.addEventListener(
        "click",
        (e) => {
          if (
            e.target.classList &&
            (e.target.classList.contains("hl") ||
              e.target.classList.contains("note"))
          ) {
            currentHlNode = e.target;
            lastRange = null;
            btnNote.style.display = "none";
            btnHL.style.display = "none";
            btnUH.style.display = "block";
            posSelbar(e.target.getBoundingClientRect());
            const s = window.getSelection();
            if (s) s.removeAllRanges();
          }
        },
        true,
      );

      btnHL.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "hl";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "hl";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };

      btnNote.onclick = () => {
        if (currentHlNode || !lastRange || lastRange.collapsed) return;
        const s = document.createElement("span");
        s.className = "note";
        try {
          lastRange.surroundContents(s);
        } catch (e) {
          const w = document.createElement("span");
          w.className = "note";
          w.appendChild(lastRange.cloneContents());
          lastRange.deleteContents();
          lastRange.insertNode(w);
        }
        selbar.style.display = "none";
        saveHighlights();
      };

      btnUH.onclick = () => {
        if (currentHlNode) {
          const p = currentHlNode.parentNode;
          while (currentHlNode.firstChild)
            p.insertBefore(currentHlNode.firstChild, currentHlNode);
          p.removeChild(currentHlNode);
          p.normalize();
          currentHlNode = null;
          selbar.style.display = "none";
          saveHighlights();
        } else if (lastRange) {
          const sR = lastRange.getBoundingClientRect();
          const w = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_ELEMENT,
          );
          const tr = [];
          while (w.nextNode()) {
            const n = w.currentNode;
            if (
              n.classList &&
              (n.classList.contains("hl") || n.classList.contains("note"))
            ) {
              const r = n.getBoundingClientRect();
              if (
                !(
                  r.right < sR.left ||
                  r.left > sR.right ||
                  r.bottom < sR.top ||
                  r.top > sR.bottom
                )
              )
                tr.push(n);
            }
          }
          tr.forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          selbar.style.display = "none";
          saveHighlights();
        }
      };

      document.querySelectorAll(".flag-btn").forEach((btn) => {
        btn.onclick = (e) => {
          e.stopPropagation();
          btn.classList.toggle("active");
          saveFlags();
        };
      });

      const answerKey = {
        q27: "D",
        q28: "B",
        q29: "A",
        q30: "C",
        q31: "B",
        q32: "NO",
        q33: "NOT GIVEN",
        q34: "YES",
        q35: "NOT GIVEN",
        q36: "E",
        q37: "C",
        q38: "D",
        q39: "G",
        q40: "B",
      };
      let lastResults = [];

      function saveAnswers() {
        const data = {};
        Object.keys(answerKey).forEach((q) => {
          const ch = document.querySelector(`input[name="${q}"]:checked`);
          if (ch) data[q] = ch.value;
        });
        localStorage.setItem(`${PAPER_ID}_answers`, JSON.stringify(data));
      }

      function loadAnswers() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_answers`) || "{}",
        );
        Object.keys(data).forEach((q) => {
          const radio = document.querySelector(
            `input[name="${q}"][value="${data[q]}"]`,
          );
          if (radio) radio.checked = true;
        });
      }

      function saveFlags() {
        const flags = [...document.querySelectorAll(".flag-btn.active")].map(
          (b) => b.dataset.q,
        );
        localStorage.setItem(`${PAPER_ID}_flags`, JSON.stringify(flags));
      }

      function loadFlags() {
        const flags = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_flags`) || "[]",
        );
        flags.forEach((q) =>
          document.querySelector(`[data-q="${q}"]`)?.classList.add("active"),
        );
      }

      function saveHighlights() {
        const highlights = { left: [], right: [] };
        document
          .querySelectorAll("#left .hl, #left .note")
          .forEach((el, idx) => {
            highlights.left.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        document
          .querySelectorAll("#right .hl, #right .note")
          .forEach((el, idx) => {
            highlights.right.push({
              type: el.classList.contains("hl") ? "hl" : "note",
              text: el.textContent,
              index: idx,
            });
          });
        localStorage.setItem(
          `${PAPER_ID}_highlights`,
          JSON.stringify(highlights),
        );
      }

      function loadHighlights() {
        const data = JSON.parse(
          localStorage.getItem(`${PAPER_ID}_highlights`) ||
            '{"left":[],"right":[]}',
        );

        // ÊÅ¢Â§çÂ∑¶‰æßÈ´ò‰∫Æ
        if (data.left && data.left.length > 0) {
          data.left.forEach((item) => {
            const walker = document.createTreeWalker(
              left,
              NodeFilter.SHOW_TEXT,
            );
            let node;
            while ((node = walker.nextNode())) {
              if (node.textContent.includes(item.text)) {
                const span = document.createElement("span");
                span.className = item.type;
                const parent = node.parentNode;
                const text = node.textContent;
                const idx = text.indexOf(item.text);
                if (idx >= 0) {
                  const before = text.substring(0, idx);
                  const match = text.substring(idx, idx + item.text.length);
                  const after = text.substring(idx + item.text.length);

                  parent.insertBefore(document.createTextNode(before), node);
                  span.textContent = match;
                  parent.insertBefore(span, node);
                  parent.insertBefore(document.createTextNode(after), node);
                  parent.removeChild(node);
                  break;
                }
              }
            }
          });
        }

        // ÊÅ¢Â§çÂè≥‰æßÈ´ò‰∫Æ
        if (data.right && data.right.length > 0) {
          data.right.forEach((item) => {
            const walker = document.createTreeWalker(
              right,
              NodeFilter.SHOW_TEXT,
            );
            let node;
            while ((node = walker.nextNode())) {
              if (node.textContent.includes(item.text)) {
                const span = document.createElement("span");
                span.className = item.type;
                const parent = node.parentNode;
                const text = node.textContent;
                const idx = text.indexOf(item.text);
                if (idx >= 0) {
                  const before = text.substring(0, idx);
                  const match = text.substring(idx, idx + item.text.length);
                  const after = text.substring(idx + item.text.length);

                  parent.insertBefore(document.createTextNode(before), node);
                  span.textContent = match;
                  parent.insertBefore(span, node);
                  parent.insertBefore(document.createTextNode(after), node);
                  parent.removeChild(node);
                  break;
                }
              }
            }
          });
        }
      }

      document.querySelectorAll('input[type="radio"]').forEach((radio) => {
        radio.addEventListener("change", saveAnswers);
      });

      document.addEventListener("DOMContentLoaded", () => {
        loadAnswers();
        loadFlags();
        loadHighlights();
      });

      function submitAnswers() {
        const res = [];
        let cor = 0;
        Object.keys(answerKey).forEach((q) => {
          const ch = document.querySelector('input[name="' + q + '"]:checked');
          const uA = ch ? ch.value : "";
          const cA = answerKey[q];
          const iC = uA === cA;
          if (iC) cor++;
          res.push({ id: q, userAns: uA, correctAns: cA, isCorrect: iC });
        });
        lastResults = res;
        const tot = Object.keys(answerKey).length;
        const pct = ((cor / tot) * 100).toFixed(1);
        localStorage.setItem(`ielts_score_${PAPER_ID}`, `${cor}/${tot}`);
        document.getElementById("resultContent").innerHTML =
          `<div class="result-summary"><div class="result-score">${cor} / ${tot}</div><div style="margin-top:8px;font-size:18px;">${pct}%</div></div>${res.map((r) => `<div class="result-item ${r.isCorrect ? "correct" : "incorrect"}"><div><strong>${r.id}</strong> ${r.isCorrect ? "‚úì" : "‚úó"}</div><div>‰Ω†ÁöÑÁ≠îÊ°à: ${r.userAns || "(Êú™‰ΩúÁ≠î)"}</div>${!r.isCorrect ? `<div>Ê≠£Á°ÆÁ≠îÊ°à: ${r.correctAns}</div>` : ""}</div>`).join("")}`;
        document.getElementById("resultModal").classList.add("active");
      }

      function resetForm() {
        document.getElementById("resetModal").classList.add("active");
      }

      function confirmReset() {
        const tp = document.querySelector(
          'input[name="resetType"]:checked',
        ).value;
        document
          .querySelectorAll('input[type="radio"]')
          .forEach((i) => (i.checked = false));
        localStorage.removeItem(`${PAPER_ID}_answers`);

        if (tp === "all") {
          document.querySelectorAll(".hl").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document.querySelectorAll(".note").forEach((el) => {
            const p = el.parentNode;
            while (el.firstChild) p.insertBefore(el.firstChild, el);
            p.removeChild(el);
            p.normalize();
          });
          document
            .querySelectorAll(".flag-btn")
            .forEach((b) => b.classList.remove("active"));
          localStorage.removeItem(`${PAPER_ID}_highlights`);
          localStorage.removeItem(`${PAPER_ID}_flags`);
        }
        closeModal("resetModal");
      }

      function addWrongToBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const wr = lastResults.filter((r) => !r.isCorrect);
        wr.forEach((r) => {
          const en = {
            paperId: PAPER_ID,
            title: "When people are ‚Äòdeaf‚Äô to music",
            questionId: r.id,
            correctAnswer: r.correctAns,
            myAnswer: r.userAns || "(Êú™‰ΩúÁ≠î)",
            date: new Date().toISOString().split("T")[0],
          };
          const ix = wb.findIndex(
            (i) => i.paperId === en.paperId && i.questionId === en.questionId,
          );
          if (ix >= 0) wb[ix] = en;
          else wb.push(en);
        });
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        alert(`Â∑≤Ê∑ªÂä† ${wr.length} ÈÅìÈîôÈ¢ò`);
        closeModal("resultModal");
      }

      function deleteWrongItem(pId, qId) {
        if (!confirm("Á°ÆÂÆöÂà†Èô§ËøôÈÅìÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => !(i.paperId === pId && i.questionId === qId));
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }

      function clearCurrentWrongBook() {
        if (!confirm("Á°ÆÂÆöÊ∏ÖÁ©∫Êú¨ÁØáÊâÄÊúâÈîôÈ¢òÔºü")) return;
        let wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        wb = wb.filter((i) => i.paperId !== PAPER_ID);
        localStorage.setItem("ielts_wrong_book", JSON.stringify(wb));
        openWrongBook();
      }

      function openWrongBook() {
        const wb = JSON.parse(localStorage.getItem("ielts_wrong_book") || "[]");
        const cu = wb.filter((i) => i.paperId === PAPER_ID);
        const ct = document.getElementById("wrongBookContent");
        if (cu.length === 0)
          ct.innerHTML =
            '<div style="text-align:center;padding:40px;color:#666;">ÊöÇÊó†ÈîôÈ¢ò</div>';
        else
          ct.innerHTML = `<div class="modal-actions"><button class="btn-danger" onclick="clearCurrentWrongBook()" stylewidth:100%;">üóëÔ∏è Ê∏ÖÁ©∫Êú¨ÁØáÈîôÈ¢ò</button></div>${cu.map((i) => `<div class="wrong-item"><div class="wrong-item-content"><div style="font-weight:600;margin-bottom:8px;">${i.questionId}</div><div style="font-size:13px;color:#666;"><div>‚úì Ê≠£Á°Æ: ${i.correctAnswer}</div><div style="color:#d32f2f;">‚úó ÊàëÁöÑ: ${i.myAnswer}</div></div></div><button class="btn-delete" onclick="deleteWrongItem('${i.paperId}','${i.questionId}')">Âà†Èô§</button></div>`).join("")}`;
        document.getElementById("wrongBookModal").classList.add("active");
      }

      function closeModal(id) {
        document.getElementById(id).classList.remove("active");
      }
    </script>
  </body>
</html>
